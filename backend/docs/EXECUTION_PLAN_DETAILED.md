# –§–∏–Ω–∞–ª—å–Ω—ã–π –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —É–ª—É—á—à–µ–Ω–∏–π –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤

**–î–∞—Ç–∞:** 2025-01-XX  
**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é  
**–û—Å–Ω–æ–≤–∞–Ω –Ω–∞:** `diagnostic.md`

---

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–ª–∞–Ω–∞

–ü–ª–∞–Ω —Ä–∞–∑–±–∏—Ç –Ω–∞ 4 —ç—Ç–∞–ø–∞, –∫–∞–∂–¥—ã–π —ç—Ç–∞–ø —Å–æ–¥–µ—Ä–∂–∏—Ç:
- –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è
- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–∏—è/–¥–æ–±–∞–≤–ª–µ–Ω–∏—è
- –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –¢–µ—Å—Ç—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

---

## üî¥ –≠–¢–ê–ü 1: –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

**–¶–µ–ª—å:** –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö, —É—Å—Ç—Ä–∞–Ω–∏—Ç—å –±–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ—à–∏–±–∫–∏  
**–í—Ä–µ–º—è:** 2-3 –¥–Ω—è

### 1.1 –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è

#### –§–∞–π–ª 1: `backend/data/reference/airports-reference.json`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∞—ç—Ä–æ–ø–æ—Ä—Ç–æ–≤ –∏ –∏—Ö –≥–æ—Ä–æ–¥–æ–≤ –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏  
**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- –ú–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ —Å –ø–æ–ª—è–º–∏: `name`, `city`, `aliases`, `normalizedName`
- –í–∫–ª—é—á–∏—Ç—å –∞—ç—Ä–æ–ø–æ—Ä—Ç—ã: –¢—É–π–º–∞–∞–¥–∞, –®–µ—Ä–µ–º–µ—Ç—å–µ–≤–æ, –î–æ–º–æ–¥–µ–¥–æ–≤–æ, –í–Ω—É–∫–æ–≤–æ, –ü—É–ª–∫–æ–≤–æ, –¢–æ–ª–º–∞—á—ë–≤–æ, –ï–º–µ–ª—å—è–Ω–æ–≤–æ, –ö–æ–ª—å—Ü–æ–≤–æ

#### –§–∞–π–ª 2: `backend/data/reference/suburbs-reference.json`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ø—Ä–∏–≥–æ—Ä–æ–¥–æ–≤ –∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤  
**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- –ú–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ —Å –ø–æ–ª—è–º–∏: `name`, `mainCity`, `type`, `normalizedName`
- –í–∫–ª—é—á–∏—Ç—å: –ù–∏–∂–Ω–∏–π –ë–µ—Å—Ç—è—Ö ‚Üí –Ø–∫—É—Ç—Å–∫, –ë–µ—Ä–∫–∞–∫–∏—Ç ‚Üí –ù–µ—Ä—é–Ω–≥—Ä–∏

#### –§–∞–π–ª 3: `backend/src/shared/utils/airports-loader.ts`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ó–∞–≥—Ä—É–∑–∫–∞ –∏ —Ä–∞–±–æ—Ç–∞ —Å–æ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–º –∞—ç—Ä–æ–ø–æ—Ä—Ç–æ–≤  
**–§—É–Ω–∫—Ü–∏–∏:**
- `loadAirportsReference(): Map<string, string>` - –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –≤ Map (–∫–ª—é—á: –Ω–∞–∑–≤–∞–Ω–∏–µ –∞—ç—Ä–æ–ø–æ—Ä—Ç–∞, –∑–Ω–∞—á–µ–Ω–∏–µ: –≥–æ—Ä–æ–¥)
- `getCityByAirportName(airportName: string): string | undefined` - –ø–æ–ª—É—á–∞–µ—Ç –≥–æ—Ä–æ–¥ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∞—ç—Ä–æ–ø–æ—Ä—Ç–∞

#### –§–∞–π–ª 4: `backend/src/shared/utils/suburbs-loader.ts`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ó–∞–≥—Ä—É–∑–∫–∞ –∏ —Ä–∞–±–æ—Ç–∞ —Å–æ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–º –ø—Ä–∏–≥–æ—Ä–æ–¥–æ–≤  
**–§—É–Ω–∫—Ü–∏–∏:**
- `loadSuburbsReference(): Map<string, string>` - –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –≤ Map (–∫–ª—é—á: –ø—Ä–∏–≥–æ—Ä–æ–¥, –∑–Ω–∞—á–µ–Ω–∏–µ: –æ—Å–Ω–æ–≤–Ω–æ–π –≥–æ—Ä–æ–¥)
- `getMainCityBySuburb(suburbName: string): string | undefined` - –ø–æ–ª—É—á–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –≥–æ—Ä–æ–¥ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –ø—Ä–∏–≥–æ—Ä–æ–¥–∞

#### –§–∞–π–ª 5: `backend/src/shared/validators/stop-validator.ts`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –æ—Å—Ç–∞–Ω–æ–≤–æ–∫ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º  
**–§—É–Ω–∫—Ü–∏–∏:**
- `validateStopData(stopData: any): ValidationResult` - –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
  - –ü—Ä–æ–≤–µ—Ä–∫–∞: `name` –Ω–µ –ø—É—Å—Ç–æ–π, –¥–ª–∏–Ω–∞ >= 3 —Å–∏–º–≤–æ–ª–æ–≤
  - –ü—Ä–æ–≤–µ—Ä–∫–∞: `latitude` –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ [-90, 90], –Ω–µ NaN, –Ω–µ Infinity
  - –ü—Ä–æ–≤–µ—Ä–∫–∞: `longitude` –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ [-180, 180], –Ω–µ NaN, –Ω–µ Infinity
  - –ü—Ä–æ–≤–µ—Ä–∫–∞: `cityId` –Ω–µ —Å–ª—É–∂–µ–±–Ω–æ–µ —Å–ª–æ–≤–æ (—Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è, –≥–ª–∞–≤–Ω—ã–π, —Ç—É–π–º–∞–∞–¥–∞ –∏ —Ç.–¥.)
- –¢–∏–ø: `ValidationResult { isValid: boolean, errors: string[] }`

### 1.2 –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

#### –§–∞–π–ª 1: `backend/src/shared/utils/city-normalizer.ts`
**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- **–ò–º–ø–æ—Ä—Ç—ã:** –î–æ–±–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç `getCityByAirportName` –∏–∑ `airports-loader.ts`
- **–§—É–Ω–∫—Ü–∏—è `extractCityFromStopName()` (—Å—Ç—Ä–æ–∫–∏ 121-180):**
  - –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–∞—Ç—Ç–µ—Ä–Ω–∞ "–ê—ç—Ä–æ–ø–æ—Ä—Ç [–ì–æ—Ä–æ–¥] ([–ê—ç—Ä–æ–ø–æ—Ä—Ç])"
    - –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ: `/–ê—ç—Ä–æ–ø–æ—Ä—Ç\s+([–ê-–Ø–∞-—è–Å—ë\-\s]+)\s*\(([^)]+)\)/i`
    - –ò–∑–≤–ª–µ—á—å –Ω–∞–∑–≤–∞–Ω–∏–µ –∞—ç—Ä–æ–ø–æ—Ä—Ç–∞ –∏–∑ —Å–∫–æ–±–æ–∫
    - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ `getCityByAirportName()` - –µ—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ, –≤–µ—Ä–Ω—É—Ç—å –≥–æ—Ä–æ–¥ –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞
    - –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –∏–∑–≤–ª–µ—á—å –≥–æ—Ä–æ–¥ –∏–∑ —á–∞—Å—Ç–∏ –î–û —Å–∫–æ–±–æ–∫
  - –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–∞—Ç—Ç–µ—Ä–Ω–∞ "–ê—ç—Ä–æ–ø–æ—Ä—Ç [–ì–æ—Ä–æ–¥]" (–±–µ–∑ —Å–∫–æ–±–æ–∫)
    - –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ: `/–ê—ç—Ä–æ–ø–æ—Ä—Ç\s+([–ê-–Ø–∞-—è–Å—ë\-\s]+)/i`
    - –ò–∑–≤–ª–µ—á—å –≥–æ—Ä–æ–¥ –∏–∑ —á–∞—Å—Ç–∏ –ø–æ—Å–ª–µ —Å–ª–æ–≤–∞ "–ê—ç—Ä–æ–ø–æ—Ä—Ç"
  - –û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ª–æ–≥–∏–∫—É –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ (–æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ fallback)

#### –§–∞–π–ª 2: `backend/src/application/workers/ODataSyncWorker.ts`
**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- **–ò–º–ø–æ—Ä—Ç—ã:** 
  - –î–æ–±–∞–≤–∏—Ç—å `getCityByAirportName` –∏–∑ `airports-loader.ts`
  - –î–æ–±–∞–≤–∏—Ç—å `getMainCityBySuburb` –∏–∑ `suburbs-loader.ts`
  - –î–æ–±–∞–≤–∏—Ç—å `validateStopData` –∏–∑ `stop-validator.ts`
  - –î–æ–±–∞–≤–∏—Ç—å `isCityInUnifiedReference` –∏–∑ `unified-cities-loader.ts` (–ø–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ yakutia, –ø–æ—Ç–æ–º –æ–±–Ω–æ–≤–∏–º)
- **–ú–µ—Ç–æ–¥ `parseODataResponse()` (—Å—Ç—Ä–æ–∫–∏ 252-284):**
  - –ü–æ—Å–ª–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è `cityName` —á–µ—Ä–µ–∑ `extractCityFromStopName()`:
    1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ `getMainCityBySuburb(cityName)` ‚Üí –µ—Å–ª–∏ –ø—Ä–∏–≥–æ—Ä–æ–¥, –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ `mainCity`
    2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ `getCityByAirportName(cityName)` ‚Üí –µ—Å–ª–∏ –∞—ç—Ä–æ–ø–æ—Ä—Ç, –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –≥–æ—Ä–æ–¥
    3. –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å `cityName` —á–µ—Ä–µ–∑ `normalizeCityName()`
    4. –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ `validateStopData(stopData)` ‚Üí –µ—Å–ª–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ, –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
    5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π `cityName` –µ—Å—Ç—å –≤ unified-reference (–ø–æ–∫–∞ —Ç–æ–ª—å–∫–æ yakutia)
  - –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:
    - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∞–ª–∏–¥–Ω—ã—Ö/–Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –æ—Å—Ç–∞–Ω–æ–≤–æ–∫
    - –°–ø–∏—Å–æ–∫ –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

### 1.3 –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è

**–ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ**

### 1.4 –¢–µ—Å—Ç—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

#### –ù–æ–≤—ã–π —Ñ–∞–π–ª: `backend/src/__tests__/unit/utils/airports-loader.test.ts`
- –¢–µ—Å—Ç—ã –¥–ª—è `loadAirportsReference()`
- –¢–µ—Å—Ç—ã –¥–ª—è `getCityByAirportName()`

#### –ù–æ–≤—ã–π —Ñ–∞–π–ª: `backend/src/__tests__/unit/utils/suburbs-loader.test.ts`
- –¢–µ—Å—Ç—ã –¥–ª—è `loadSuburbsReference()`
- –¢–µ—Å—Ç—ã –¥–ª—è `getMainCityBySuburb()`

#### –ù–æ–≤—ã–π —Ñ–∞–π–ª: `backend/src/__tests__/unit/validators/stop-validator.test.ts`
- –¢–µ—Å—Ç—ã –¥–ª—è `validateStopData()` —Å–æ –≤—Å–µ–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏

#### –û–±–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª: `backend/src/__tests__/unit/utils/city-normalizer.test.ts`
- –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –ø–∞—Ç—Ç–µ—Ä–Ω–∞ "–ê—ç—Ä–æ–ø–æ—Ä—Ç –Ø–∫—É—Ç—Å–∫ (–¢—É–π–º–∞–∞–¥–∞)" ‚Üí "–Ø–∫—É—Ç—Å–∫"
- –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –ø–∞—Ç—Ç–µ—Ä–Ω–∞ "–ê—ç—Ä–æ–ø–æ—Ä—Ç –ú–æ—Å–∫–≤–∞ –®–µ—Ä–µ–º–µ—Ç—å–µ–≤–æ" ‚Üí "–ú–æ—Å–∫–≤–∞"
- –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –∞—ç—Ä–æ–ø–æ—Ä—Ç–æ–≤

#### –û–±–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª: `backend/src/__tests__/unit/workers/ODataSyncWorker.test.ts`
- –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏
- –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –æ—Å—Ç–∞–Ω–æ–≤–æ–∫
- –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

---

## üü† –≠–¢–ê–ü 2: –î–û–ë–ê–í–õ–ï–ù–ò–ï –§–ï–î–ï–†–ê–õ–¨–ù–´–• –ì–û–†–û–î–û–í

**–¶–µ–ª—å:** –î–æ–±–∞–≤–∏—Ç—å 10 —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤, –æ–±–µ—Å–ø–µ—á–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã –†–æ—Å—Å–∏—è ‚Üí –Ø–∫—É—Ç–∏—è  
**–í—Ä–µ–º—è:** 3-4 –¥–Ω—è  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –≠—Ç–∞–ø 1 (–≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ unified-reference)

### 2.1 –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è

#### –§–∞–π–ª 1: `backend/data/reference/russia-federal-cities-reference.json`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ –†–§  
**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- –ú–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ —Å –ø–æ–ª—è–º–∏: `name`, `normalizedName`, `latitude`, `longitude`, `region`, `isKeyCity`, `isFederalCity`, `airports`
- –í–∫–ª—é—á–∏—Ç—å 10 –≥–æ—Ä–æ–¥–æ–≤: –ú–æ—Å–∫–≤–∞, –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥, –ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫, –ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫, –ò—Ä–∫—É—Ç—Å–∫, –•–∞–±–∞—Ä–æ–≤—Å–∫, –í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫, –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥, –ö–∞–∑–∞–Ω—å, –ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥

#### –§–∞–π–ª 2: `backend/src/shared/utils/unified-cities-loader.ts`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–æ–≥–æ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ (–Ø–∫—É—Ç–∏—è + —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–µ –≥–æ—Ä–æ–¥–∞)  
**–§—É–Ω–∫—Ü–∏–∏:**
- `loadUnifiedCitiesReference(): Map<string, UnifiedCity>` - –∑–∞–≥—Ä—É–∂–∞–µ—Ç –æ–±–∞ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –∏ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –≤ Map
- `getUnifiedCity(cityName: string): UnifiedCity | undefined` - –ø–æ–ª—É—á–∞–µ—Ç –≥–æ—Ä–æ–¥ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
- `isCityInUnifiedReference(cityName: string): boolean` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –≥–æ—Ä–æ–¥–∞ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ
- `getAllFederalCities(): UnifiedCity[]` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–µ –≥–æ—Ä–æ–¥–∞
- `getAllYakutiaCities(): UnifiedCity[]` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –≥–æ—Ä–æ–¥–∞ –Ø–∫—É—Ç–∏–∏
- **–¢–∏–ø:** `UnifiedCity { name, normalizedName, latitude, longitude, region, isKeyCity, isFederalCity, airports? }`

#### –§–∞–π–ª 3: `backend/src/application/workers/AirRouteGeneratorWorker.ts`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∞–≤–∏–∞–º–∞—Ä—à—Ä—É—Ç–æ–≤ –∏–∑ —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ –≤ –Ø–∫—É—Ç—Å–∫  
**–ö–ª–∞—Å—Å:** `AirRouteGeneratorWorker extends BaseBackgroundWorker`
**–ú–µ—Ç–æ–¥—ã:**
- `canRun(): Promise<boolean>` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ dataset
- `executeWorkerLogic(): Promise<WorkerExecutionResult>`:
  1. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ –∏–∑ unified-reference
  2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω–æ–≥–æ –≥–æ—Ä–æ–¥–∞:
     - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∞–≤–∏–∞–º–∞—Ä—à—Ä—É—Ç–∞ –≤ –ë–î (–Ø–∫—É—Ç—Å–∫ ‚Üî —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –≥–æ—Ä–æ–¥)
     - –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí —Å–æ–∑–¥–∞–µ—Ç –º–∞—Ä—à—Ä—É—Ç:
       - –ü—Ä—è–º–æ–π: —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –≥–æ—Ä–æ–¥ ‚Üí –Ø–∫—É—Ç—Å–∫ (PLANE, 240 –º–∏–Ω, 2000 –∫–º)
       - –û–±—Ä–∞—Ç–Ω—ã–π: –Ø–∫—É—Ç—Å–∫ ‚Üí —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –≥–æ—Ä–æ–¥ (PLANE, 240 –º–∏–Ω, 2000 –∫–º)
     - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ä–µ–π—Å—ã –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–æ–≤ (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ, 2-3 —Ä–µ–π—Å–∞: 08:00, 14:00, 20:00)
  3. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –º–∞—Ä—à—Ä—É—Ç—ã –∏ —Ä–µ–π—Å—ã –≤ –ë–î

### 2.2 –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

#### –§–∞–π–ª 1: `backend/src/application/workers/ODataSyncWorker.ts`
**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- **–ò–º–ø–æ—Ä—Ç—ã:** –û–±–Ω–æ–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç `isCityInUnifiedReference` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è unified-reference (–≤–º–µ—Å—Ç–æ —Ç–æ–ª—å–∫–æ yakutia)
- **–ú–µ—Ç–æ–¥ `parseODataResponse()`:** –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `city_id` —á–µ—Ä–µ–∑ `isCityInUnifiedReference()` (—Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞–µ—Ç —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–µ –≥–æ—Ä–æ–¥–∞)

#### –§–∞–π–ª 2: `backend/src/application/workers/VirtualEntitiesGeneratorWorker.ts`
**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- **–ò–º–ø–æ—Ä—Ç—ã:**
  - –£–¥–∞–ª–∏—Ç—å: `getAllYakutiaCities`, `getYakutiaCitiesDirectory` –∏–∑ `yakutia-cities-loader.ts`
  - –î–æ–±–∞–≤–∏—Ç—å: `getAllFederalCities`, `getAllYakutiaCities`, `isCityInUnifiedReference` –∏–∑ `unified-cities-loader.ts`
- **–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä (—Å—Ç—Ä–æ–∫–∏ ~30-50):**
  - –£–¥–∞–ª–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `citiesDirectory: CityCoordinates`
  - –ó–∞–≥—Ä—É–∂–∞—Ç—å –≥–æ—Ä–æ–¥–∞ —á–µ—Ä–µ–∑ `getAllYakutiaCities()` + `getAllFederalCities()` –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Å–∞
- **–ú–µ—Ç–æ–¥ `generateVirtualStops()` (—Å—Ç—Ä–æ–∫–∏ ~100-200):**
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `getAllFederalCities()` + `getAllYakutiaCities()` –≤–º–µ—Å—Ç–æ `this.citiesDirectory`
  - –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏:
    - –ì–æ—Ä–æ–¥ –µ—Å—Ç—å –≤ unified-reference (–ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ `isCityInUnifiedReference()`)
    - –ù–µ—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö –æ—Å—Ç–∞–Ω–æ–≤–æ–∫ –≤ –ë–î –¥–ª—è —ç—Ç–æ–≥–æ –≥–æ—Ä–æ–¥–∞
    - `isKeyCity: true`
- **–ú–µ—Ç–æ–¥ `ensureYakutiaCitiesConnectivity()` (—Å—Ç—Ä–æ–∫–∏ 499-600):**
  - –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –≤ `ensureCitiesConnectivity()`
  - –û–±–Ω–æ–≤–∏—Ç—å –ª–æ–≥–∏–∫—É:
    - –î–ª—è –ø–∞—Ä **—Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –≥–æ—Ä–æ–¥ ‚Üí –≥–æ—Ä–æ–¥ –Ø–∫—É—Ç–∏–∏**: —Å–æ–∑–¥–∞–≤–∞—Ç—å hub-based –º–∞—Ä—à—Ä—É—Ç—ã —á–µ—Ä–µ–∑ –Ø–∫—É—Ç—Å–∫
      - –ú–∞—Ä—à—Ä—É—Ç 1: —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –≥–æ—Ä–æ–¥ ‚Üí –Ø–∫—É—Ç—Å–∫ (PLANE, 240 –º–∏–Ω, 2000 –∫–º)
      - –ú–∞—Ä—à—Ä—É—Ç 2: –Ø–∫—É—Ç—Å–∫ ‚Üí –≥–æ—Ä–æ–¥ –Ø–∫—É—Ç–∏–∏ (BUS, 180 –º–∏–Ω, 200 –∫–º)
    - –î–ª—è –ø–∞—Ä **—Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –≥–æ—Ä–æ–¥ ‚Üí —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –≥–æ—Ä–æ–¥**: —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä—è–º—ã–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã (PLANE, 180 –º–∏–Ω, 1500 –∫–º)
    - –î–ª—è –ø–∞—Ä **–≥–æ—Ä–æ–¥ –Ø–∫—É—Ç–∏–∏ ‚Üí –≥–æ—Ä–æ–¥ –Ø–∫—É—Ç–∏–∏**: –æ—Å—Ç–∞–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ª–æ–≥–∏–∫—É

#### –§–∞–π–ª 3: `backend/src/infrastructure/workers/initializeWorkers.ts`
**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- **–ò–º–ø–æ—Ä—Ç—ã:**
  - –£–¥–∞–ª–∏—Ç—å: `getYakutiaCitiesDirectory` –∏–∑ `yakutia-cities-loader.ts`
  - –î–æ–±–∞–≤–∏—Ç—å: `AirRouteGeneratorWorker` –∏–∑ `application/workers`
- **–§—É–Ω–∫—Ü–∏—è `initializeWorkers()` (—Å—Ç—Ä–æ–∫–∏ 114-209):**
  - –£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫—É 156: `const yakutiaCitiesDirectory = getYakutiaCitiesDirectory();`
  - –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É 157: —É–±—Ä–∞—Ç—å –ø–µ—Ä–µ–¥–∞—á—É `yakutiaCitiesDirectory` –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä `VirtualEntitiesGeneratorWorker`
  - –î–æ–±–∞–≤–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ `AirRouteGeneratorWorker` –ø–æ—Å–ª–µ `ODataSyncWorker` –∏ –ø–µ—Ä–µ–¥ `VirtualEntitiesGeneratorWorker`
  - –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å `AirRouteGeneratorWorker` –≤ orchestrator
  - –ü–æ—Ä—è–¥–æ–∫ –≤–æ—Ä–∫–µ—Ä–æ–≤: ODataSyncWorker ‚Üí **AirRouteGeneratorWorker** ‚Üí VirtualEntitiesGeneratorWorker ‚Üí GraphBuilderWorker

### 2.3 –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è

**–ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ**

### 2.4 –¢–µ—Å—Ç—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

#### –ù–æ–≤—ã–π —Ñ–∞–π–ª: `backend/src/__tests__/unit/utils/unified-cities-loader.test.ts`
- –¢–µ—Å—Ç—ã –¥–ª—è `loadUnifiedCitiesReference()`
- –¢–µ—Å—Ç—ã –¥–ª—è `getUnifiedCity()`
- –¢–µ—Å—Ç—ã –¥–ª—è `isCityInUnifiedReference()`
- –¢–µ—Å—Ç—ã –¥–ª—è `getAllFederalCities()`
- –¢–µ—Å—Ç—ã –¥–ª—è `getAllYakutiaCities()`

#### –ù–æ–≤—ã–π —Ñ–∞–π–ª: `backend/src/__tests__/unit/workers/AirRouteGeneratorWorker.test.ts`
- –¢–µ—Å—Ç—ã –¥–ª—è `canRun()`
- –¢–µ—Å—Ç—ã –¥–ª—è `executeWorkerLogic()`
- –¢–µ—Å—Ç—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –∏ —Ä–µ–π—Å–æ–≤

#### –û–±–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª: `backend/src/__tests__/unit/workers/VirtualEntitiesGeneratorWorker.test.ts`
- –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è unified-cities-loader
- –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è `ensureCitiesConnectivity()` —Å —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–º–∏ –≥–æ—Ä–æ–¥–∞–º–∏
- –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è hub-based –º–∞—Ä—à—Ä—É—Ç–æ–≤

#### –û–±–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª: `backend/src/__tests__/unit/workers/ODataSyncWorker.test.ts`
- –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ unified-reference (–≤–∫–ª—é—á–∞—è —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–µ –≥–æ—Ä–æ–¥–∞)

---

## üü° –≠–¢–ê–ü 3: –°–ú–ï–®–ê–ù–ù–´–ï –ú–ê–†–®–†–£–¢–´ –ò –ü–ï–†–ï–ü–†–ê–í–ê

**–¶–µ–ª—å:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–º–µ—à–∞–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã (air + ground + ferry), –ø–µ—Ä–µ–ø—Ä–∞–≤—É –Ø–∫—É—Ç—Å–∫ ‚Üî –ù–∏–∂–Ω–∏–π –ë–µ—Å—Ç—è—Ö  
**–í—Ä–µ–º—è:** 4-5 –¥–Ω–µ–π  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –≠—Ç–∞–ø 1 (–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ù–∏–∂–Ω–∏–π –ë–µ—Å—Ç—è—Ö), –≠—Ç–∞–ø 2 (—Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–µ –≥–æ—Ä–æ–¥–∞)

### 3.1 –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è

**–ù–µ—Ç –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ –Ω–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ**

### 3.2 –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

#### –§–∞–π–ª 1: `backend/data/mock/stops.json`
**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–ª—è —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤:
  - `stop-030`: "–ê—ç—Ä–æ–ø–æ—Ä—Ç –ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫ –¢–æ–ª–º–∞—á—ë–≤–æ" (55.0084, 82.9357, airport, cityId: "–Ω–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫")
  - `stop-031`: "–ê—ç—Ä–æ–ø–æ—Ä—Ç –ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫ –ï–º–µ–ª—å—è–Ω–æ–≤–æ" (56.0089, 92.8537, airport, cityId: "–∫—Ä–∞—Å–Ω–æ—è—Ä—Å–∫")
  - `stop-032`: "–ê—ç—Ä–æ–ø–æ—Ä—Ç –•–∞–±–∞—Ä–æ–≤—Å–∫" (48.4802, 135.0719, airport, cityId: "—Ö–∞–±–∞—Ä–æ–≤—Å–∫")
  - `stop-033`: "–ê—ç—Ä–æ–ø–æ—Ä—Ç –í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫" (43.1155, 131.8855, airport, cityId: "–≤–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫")
  - `stop-034`: "–ê—ç—Ä–æ–ø–æ—Ä—Ç –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥ –ö–æ–ª—å—Ü–æ–≤–æ" (56.8431, 60.6454, airport, cityId: "–µ–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥")
  - `stop-035`: "–ê—ç—Ä–æ–ø–æ—Ä—Ç –ö–∞–∑–∞–Ω—å" (55.8304, 49.0661, airport, cityId: "–∫–∞–∑–∞–Ω—å")
  - `stop-036`: "–ê—ç—Ä–æ–ø–æ—Ä—Ç –ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥ –°—Ç—Ä–∏–≥–∏–Ω–æ" (56.2965, 43.9361, airport, cityId: "–Ω–∏–∂–Ω–∏–π –Ω–æ–≤–≥–æ—Ä–æ–¥")
- –î–æ–±–∞–≤–∏—Ç—å –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–ª—è –ø–µ—Ä–µ–ø—Ä–∞–≤—ã:
  - `stop-027`: "–ü–∞—Ä–æ–º–Ω–∞—è –ø–µ—Ä–µ–ø—Ä–∞–≤–∞ –ù–∏–∂–Ω–∏–π –ë–µ—Å—Ç—è—Ö" (61.9500, 129.6000, ferry_terminal, cityId: "—è–∫—É—Ç—Å–∫")
  - `stop-028`: "–ü—Ä–∏—Å—Ç–∞–Ω—å –Ø–∫—É—Ç—Å–∫" (62.0278, 129.7042, ferry_terminal, cityId: "—è–∫—É—Ç—Å–∫")

#### –§–∞–π–ª 2: `backend/data/mock/routes.json`
**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å –∞–≤–∏–∞–º–∞—Ä—à—Ä—É—Ç—ã –∏–∑ —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ –≤ –Ø–∫—É—Ç—Å–∫:
  - `route-030`: "–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫ - –Ø–∫—É—Ç—Å–∫ (–ê–≤–∏–∞)" (stop-030 ‚Üí stop-001, PLANE, 240 –º–∏–Ω, 2800 –∫–º, 15000 —Ä—É–±)
  - `route-031`: "–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫ - –Ø–∫—É—Ç—Å–∫ (–ê–≤–∏–∞)" (stop-031 ‚Üí stop-001, PLANE, 180 –º–∏–Ω, 2200 –∫–º, 12000 —Ä—É–±)
  - `route-032`: "–•–∞–±–∞—Ä–æ–≤—Å–∫ - –Ø–∫—É—Ç—Å–∫ (–ê–≤–∏–∞)" (stop-032 ‚Üí stop-001, PLANE, 300 –º–∏–Ω, 3200 –∫–º, 18000 —Ä—É–±)
- –î–æ–±–∞–≤–∏—Ç—å ferry-–º–∞—Ä—à—Ä—É—Ç—ã:
  - `route-040`: "–Ø–∫—É—Ç—Å–∫ - –ù–∏–∂–Ω–∏–π –ë–µ—Å—Ç—è—Ö (–ü–∞—Ä–æ–º)" (stop-028 ‚Üí stop-027, FERRY, 20 –º–∏–Ω, 15 –∫–º, 500 —Ä—É–±)
  - `route-041`: "–ù–∏–∂–Ω–∏–π –ë–µ—Å—Ç—è—Ö - –Ø–∫—É—Ç—Å–∫ (–ü–∞—Ä–æ–º)" (stop-027 ‚Üí stop-028, FERRY, 20 –º–∏–Ω, 15 –∫–º, 500 —Ä—É–±)
  - –î–æ–±–∞–≤–∏—Ç—å `metadata.ferrySchedule`:
    - `summer: { start: "06:00", end: "23:00", frequency: 30 }`
    - `winter: { start: "07:00", end: "22:00", frequency: 45 }`

#### –§–∞–π–ª 3: `backend/data/mock/flights.json`
**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–π—Å—ã –¥–ª—è –Ω–æ–≤—ã—Ö –∞–≤–∏–∞–º–∞—Ä—à—Ä—É—Ç–æ–≤ (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ, 2-3 —Ä–µ–π—Å–∞ –≤ –¥–µ–Ω—å: 08:00, 14:00, 20:00)
- –î–æ–±–∞–≤–∏—Ç—å "—Ä–µ–π—Å—ã" –¥–ª—è ferry-–º–∞—Ä—à—Ä—É—Ç–æ–≤ (–∫–∞–∂–¥—ã–µ 30-45 –º–∏–Ω—É—Ç –≤ —Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è)

#### –§–∞–π–ª 4: `backend/src/domain/entities/Route.ts`
**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- **–°—Ç—Ä–æ–∫–∞ 6:** –ò–∑–º–µ–Ω–∏—Ç—å `TransportType` type:
  - –ë—ã–ª–æ: `export type TransportType = 'BUS' | 'TRAIN' | 'PLANE' | 'WATER';`
  - –°—Ç–∞–ª–æ: `export type TransportType = 'BUS' | 'TRAIN' | 'PLANE' | 'WATER' | 'FERRY';`
- **–°—Ç—Ä–æ–∫–∞ 79:** –û–±–Ω–æ–≤–∏—Ç—å `validTransportTypes`:
  - –î–æ–±–∞–≤–∏—Ç—å `'FERRY'` –≤ –º–∞—Å—Å–∏–≤
- **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `TransportType` –≤ –¥—Ä—É–≥–∏—Ö —Ñ–∞–π–ª–∞—Ö:**
  - –ù–∞–π—Ç–∏ –≤—Å–µ –º–µ—Å—Ç–∞, –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `TransportType` –∏–∑ `Route.ts`
  - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤–µ–∑–¥–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è `'FERRY'`
  - –ï—Å–ª–∏ –µ—Å—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Å `RouteSegment.TransportType` enum, —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

#### –§–∞–π–ª 5: `backend/src/application/workers/GraphBuilderWorker.ts`
**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- **–ú–µ—Ç–æ–¥ `buildGraphStructure()` (—Å—Ç—Ä–æ–∫–∏ ~130-300):**
  - –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ä—ë–±–µ—Ä –∏–∑ –º–∞—Ä—à—Ä—É—Ç–æ–≤:
    1. –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–æ –≥–æ—Ä–æ–¥–∞–º (–ø–æ `cityId`)
    2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –≥–æ—Ä–æ–¥–∞ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ä—ë–±—Ä–∞ –ø–µ—Ä–µ—Å–∞–¥–∫–∏ –º–µ–∂–¥—É –æ—Å—Ç–∞–Ω–æ–≤–∫–∞–º–∏:
       - –ï—Å–ª–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤ –æ–¥–Ω–æ–º –≥–æ—Ä–æ–¥–µ ‚Üí —Å–æ–∑–¥–∞—Ç—å –¥–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ä—ë–±—Ä–∞ –ø–µ—Ä–µ—Å–∞–¥–∫–∏
       - –¢–∏–ø —Ä–µ–±—Ä–∞: `TRANSFER` (–¥–æ–±–∞–≤–∏—Ç—å –≤ —Ç–∏–ø `GraphNeighbor` –µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç)
       - –í–µ—Å: —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å —á–µ—Ä–µ–∑ `calculateTransferWeight(stop1, stop2)`
- **–ù–æ–≤—ã–π –º–µ—Ç–æ–¥ `calculateTransferWeight()`:**
  - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `stop1: RealStop | VirtualStop, stop2: RealStop | VirtualStop`
  - –õ–æ–≥–∏–∫–∞:
    - –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∏–ø—ã –æ—Å—Ç–∞–Ω–æ–≤–æ–∫ (airport, ground, ferry_terminal)
    - Air ‚Üí Ground: 90 –º–∏–Ω—É—Ç
    - Ground ‚Üí Air: 120 –º–∏–Ω—É—Ç
    - Ground ‚Üí Ground: 60 –º–∏–Ω—É—Ç
    - Air ‚Üí Ferry: 90 –º–∏–Ω—É—Ç
    - Ferry ‚Üí Ground: 30 –º–∏–Ω—É—Ç
    - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 60 –º–∏–Ω—É—Ç
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `number` (–≤–µ—Å –≤ –º–∏–Ω—É—Ç–∞—Ö)
- **–û–±–Ω–æ–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –≤–µ—Å–∞ –¥–ª—è ferry-–º–∞—Ä—à—Ä—É—Ç–æ–≤:**
  - –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–ø—Ä–∞–≤—ã: 20 –º–∏–Ω—É—Ç (–∏–∑ `route.durationMinutes`)
  - –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –ø–∞—Ä–æ–º–∞:
    - –õ–µ—Ç–æ–º: 15-20 –º–∏–Ω—É—Ç (—á–∞—Å—Ç–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ)
    - –ó–∏–º–æ–π: 30-45 –º–∏–Ω—É—Ç (—Ä–µ–¥–∫–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ)
  - –ò—Ç–æ–≥–æ–≤—ã–π –≤–µ—Å: 20 + –æ–∂–∏–¥–∞–Ω–∏–µ (35-65 –º–∏–Ω—É—Ç)
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `metadata.ferrySchedule` –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–µ–∑–æ–Ω–∞
  - –û–ø—Ä–µ–¥–µ–ª—è—Ç—å —Å–µ–∑–æ–Ω –ø–æ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç–µ (–º–µ—Å—è—Ü 4-9 = –ª–µ—Ç–æ, –æ—Å—Ç–∞–ª—å–Ω–æ–µ = –∑–∏–º–∞)

#### –§–∞–π–ª 6: `backend/src/application/route-builder/RouteGraphBuilder.ts`
**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- **–ú–µ—Ç–æ–¥ `buildFromDataset()` (–∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π):**
  - –ü—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å —Ç–∏–ø —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞:
    - –ï—Å–ª–∏ `transportType === 'FERRY'` ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `TransportType.FERRY` (–∏–∑ RouteSegment enum)
  - –°–æ–∑–¥–∞–≤–∞—Ç—å —Ä—ë–±—Ä–∞ –¥–ª—è ferry-–º–∞—Ä—à—Ä—É—Ç–æ–≤ —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º –≤–µ—Å–æ–º:
    - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `duration` –∏–∑ –º–∞—Ä—à—Ä—É—Ç–∞ (20 –º–∏–Ω—É—Ç)
    - –î–æ–±–∞–≤–ª—è—Ç—å –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –∏–∑ `metadata.ferrySchedule`
    - –†–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å –∏—Ç–æ–≥–æ–≤—ã–π –≤–µ—Å: `duration + waitTime`

#### –§–∞–π–ª 7: `backend/src/domain/repositories/IGraphRepository.ts`
**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- **–¢–∏–ø `GraphNeighbor` (—Å—Ç—Ä–æ–∫–∏ ~17-30):**
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –ø–æ–ª—è `transportType?: string`
  - –ï—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Üí –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `transportType?: string` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ç–∏–ø–∞ —Ä–µ–±—Ä–∞ (TRANSFER, FERRY –∏ —Ç.–¥.)

### 3.3 –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ 1: `TransportType` –≤ `Route.ts`
- –î–æ–±–∞–≤–∏—Ç—å `'FERRY'` –≤ union type

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ 2: `GraphNeighbor` –≤ `IGraphRepository.ts`
- –î–æ–±–∞–≤–∏—Ç—å `transportType?: string` (–µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç)

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ 3: `Route.metadata` (—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è `ferrySchedule` (—É–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `Record<string, unknown>`)

### 3.4 –¢–µ—Å—Ç—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

#### –û–±–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª: `backend/src/__tests__/unit/workers/GraphBuilderWorker.test.ts`
- –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –æ—Å—Ç–∞–Ω–æ–≤–æ–∫ –ø–æ –≥–æ—Ä–æ–¥–∞–º
- –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä—ë–±–µ—Ä –ø–µ—Ä–µ—Å–∞–¥–∫–∏
- –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è `calculateTransferWeight()` —Å–æ –≤—Å–µ–º–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏
- –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –≤–µ—Å–∞ ferry-–º–∞—Ä—à—Ä—É—Ç–æ–≤ —Å —É—á–µ—Ç–æ–º —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç–∏

#### –û–±–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª: `backend/src/__tests__/unit/route-builder/RouteGraphBuilder.test.ts`
- –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ ferry-–º–∞—Ä—à—Ä—É—Ç–æ–≤
- –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –≤–µ—Å–∞ ferry —Å —É—á–µ—Ç–æ–º –æ–∂–∏–¥–∞–Ω–∏—è

#### –û–±–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª: `backend/src/__tests__/integration/use-cases/OptimizedBuildRouteUseCase.integration.test.ts`
- –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è —Å–º–µ—à–∞–Ω–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤:
  - –ú–æ—Å–∫–≤–∞ ‚Üí –Ø–∫—É—Ç—Å–∫ ‚Üí –ß—É—Ä–∞–ø—á–∞ (PLANE + TRANSFER + BUS)
  - –ú–æ—Å–∫–≤–∞ ‚Üí –Ø–∫—É—Ç—Å–∫ ‚Üí –ù–∏–∂–Ω–∏–π –ë–µ—Å—Ç—è—Ö (PLANE + TRANSFER + FERRY)
  - –ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫ ‚Üí –Ø–∫—É—Ç—Å–∫ ‚Üí –û–ª—ë–∫–º–∏–Ω—Å–∫ (PLANE + TRANSFER + BUS)

---

## üü£ –≠–¢–ê–ü 4: –ì–†–ê–§ –ò –í–ê–õ–ò–î–ê–¶–ò–Ø

**–¶–µ–ª—å:** –í–∞–ª–∏–¥–∞—Ü–∏—è –≥—Ä–∞—Ñ–∞, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ—Å–∞–¥–æ–∫, —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞  
**–í—Ä–µ–º—è:** 3-4 –¥–Ω—è  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –≠—Ç–∞–ø 3 (–≥—Ä–∞—Ñ —Å –ø–µ—Ä–µ—Å–∞–¥–∫–∞–º–∏ –∏ ferry)

### 4.1 –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è

#### –§–∞–π–ª 1: `backend/src/shared/validators/graph-validator.ts`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ –≥—Ä–∞—Ñ–∞  
**–§—É–Ω–∫—Ü–∏–∏:**
- `validateGraphStructure(nodes: GraphNode[], edges: GraphNeighbor[]): GraphValidationResult`
  - –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤—Å–µ —Ä—ë–±—Ä–∞ –∏–º–µ—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤–µ—Å (> 0, –Ω–µ NaN, –Ω–µ Infinity)
  - –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤—Å–µ —É–∑–ª—ã –∏–º–µ—é—Ç —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –≤—Ö–æ–¥—è—â–µ–µ –∏–ª–∏ –∏—Å—Ö–æ–¥—è—â–µ–µ —Ä–µ–±—Ä–æ
  - –ü—Ä–æ–≤–µ—Ä–∫–∞: —Å–≤—è–∑–Ω–æ—Å—Ç—å –≥—Ä–∞—Ñ–∞ (BFS –æ—Ç hub-—É–∑–ª–∞ "–Ø–∫—É—Ç—Å–∫")
  - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–∑–ª–æ–≤, —Ä—ë–±–µ—Ä, –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —É–∑–ª–æ–≤, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–≤—è–∑–Ω–æ—Å—Ç–∏
- `validateTransferEdges(edges: GraphNeighbor[]): ValidationResult`
  - –ü—Ä–æ–≤–µ—Ä–∫–∞: —Ä—ë–±—Ä–∞ –ø–µ—Ä–µ—Å–∞–¥–∫–∏ —Å–æ–∑–¥–∞–Ω—ã —Ç–æ–ª—å–∫–æ –º–µ–∂–¥—É –æ—Å—Ç–∞–Ω–æ–≤–∫–∞–º–∏ –≤ –æ–¥–Ω–æ–º –≥–æ—Ä–æ–¥–µ
  - –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤–µ—Å —Ä—ë–±–µ—Ä –ø–µ—Ä–µ—Å–∞–¥–∫–∏ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ 30-120 –º–∏–Ω—É—Ç
- `validateFerryEdges(edges: GraphNeighbor[]): ValidationResult`
  - –ü—Ä–æ–≤–µ—Ä–∫–∞: ferry-—Ä—ë–±—Ä–∞ –∏–º–µ—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤–µ—Å (20-65 –º–∏–Ω—É—Ç)
  - –ü—Ä–æ–≤–µ—Ä–∫–∞: ferry-—Ä—ë–±—Ä–∞ —Å–≤—è–∑—ã–≤–∞—é—Ç —Ç–æ–ª—å–∫–æ ferry_terminal –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
- **–¢–∏–ø—ã:**
  - `GraphValidationResult { isValid: boolean, errors: string[], warnings: string[], stats: {...} }`
  - `ValidationResult { isValid: boolean, errors: string[] }`

### 4.2 –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

#### –§–∞–π–ª 1: `backend/src/application/workers/GraphBuilderWorker.ts`
**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- **–ò–º–ø–æ—Ä—Ç—ã:** –î–æ–±–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–≤ –∏–∑ `graph-validator.ts`
- **–ú–µ—Ç–æ–¥ `executeWorkerLogic()` (–ø–æ—Å–ª–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∞):**
  - –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ä—ë–±–µ—Ä –∏–∑ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –≤—ã–∑–≤–∞—Ç—å `validateGraphStructure()`
  - –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ä—ë–±–µ—Ä –ø–µ—Ä–µ—Å–∞–¥–∫–∏ –≤—ã–∑–≤–∞—Ç—å `validateTransferEdges()`
  - –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è ferry-—Ä—ë–±–µ—Ä –≤—ã–∑–≤–∞—Ç—å `validateFerryEdges()`
  - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
  - –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- **–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤:**
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–∑–ª–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω–æ–≥–æ –≥–æ—Ä–æ–¥–∞
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—ë–±–µ—Ä, —Å–≤—è–∑—ã–≤–∞—é—â–∏—Ö —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ —Å –Ø–∫—É—Ç–∏–µ–π
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–Ω–æ—Å—Ç–∏ —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ —Å hub-—É–∑–ª–æ–º (–Ø–∫—É—Ç—Å–∫)

### 4.3 –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è

**–ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ**

### 4.4 –¢–µ—Å—Ç—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

#### –ù–æ–≤—ã–π —Ñ–∞–π–ª: `backend/src/__tests__/unit/validators/graph-validator.test.ts`
- –¢–µ—Å—Ç—ã –¥–ª—è `validateGraphStructure()` —Å–æ –≤—Å–µ–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏
- –¢–µ—Å—Ç—ã –¥–ª—è `validateTransferEdges()`
- –¢–µ—Å—Ç—ã –¥–ª—è `validateFerryEdges()`
- –¢–µ—Å—Ç—ã –¥–ª—è BFS —Å–≤—è–∑–Ω–æ—Å—Ç–∏ –≥—Ä–∞—Ñ–∞

#### –û–±–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª: `backend/src/__tests__/unit/workers/GraphBuilderWorker.test.ts`
- –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ `executeWorkerLogic()`
- –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π

#### –û–±–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª: `backend/src/__tests__/integration/use-cases/OptimizedBuildRouteUseCase.integration.test.ts`
- –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤:
  - –ú–æ—Å–∫–≤–∞ ‚Üí –Ø–∫—É—Ç—Å–∫
  - –ú–æ—Å–∫–≤–∞ ‚Üí –ß—É—Ä–∞–ø—á–∞
  - –ú–æ—Å–∫–≤–∞ ‚Üí –ù–∏–∂–Ω–∏–π –ë–µ—Å—Ç—è—Ö
  - –ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫ ‚Üí –Ø–∫—É—Ç—Å–∫ ‚Üí –û–ª—ë–∫–º–∏–Ω—Å–∫
  - –ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫ ‚Üí –Ø–∫—É—Ç—Å–∫ ‚Üí –ú–∏—Ä–Ω—ã–π

---

## üìä –ò–¢–û–ì–û–í–ê–Ø –°–í–û–î–ö–ê –ò–ó–ú–ï–ù–ï–ù–ò–ô

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã (9 —Ñ–∞–π–ª–æ–≤)

1. `backend/data/reference/airports-reference.json`
2. `backend/data/reference/suburbs-reference.json`
3. `backend/data/reference/russia-federal-cities-reference.json`
4. `backend/src/shared/utils/airports-loader.ts`
5. `backend/src/shared/utils/suburbs-loader.ts`
6. `backend/src/shared/utils/unified-cities-loader.ts`
7. `backend/src/shared/validators/stop-validator.ts`
8. `backend/src/shared/validators/graph-validator.ts`
9. `backend/src/application/workers/AirRouteGeneratorWorker.ts`

### –û–±–Ω–æ–≤–ª—è–µ–º—ã–µ —Ñ–∞–π–ª—ã (10 —Ñ–∞–π–ª–æ–≤)

1. `backend/src/shared/utils/city-normalizer.ts`
2. `backend/src/application/workers/ODataSyncWorker.ts`
3. `backend/src/application/workers/VirtualEntitiesGeneratorWorker.ts`
4. `backend/src/application/workers/GraphBuilderWorker.ts`
5. `backend/src/application/route-builder/RouteGraphBuilder.ts`
6. `backend/src/domain/entities/Route.ts`
7. `backend/src/domain/repositories/IGraphRepository.ts`
8. `backend/data/mock/stops.json`
9. `backend/data/mock/routes.json`
10. `backend/data/mock/flights.json`
11. `backend/src/infrastructure/workers/initializeWorkers.ts`

### –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–∏—è/–¥–æ–±–∞–≤–ª–µ–Ω–∏—è (8 —Ñ—É–Ω–∫—Ü–∏–π)

1. `extractCityFromStopName()` –≤ `city-normalizer.ts` - –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –∞—ç—Ä–æ–ø–æ—Ä—Ç–æ–≤
2. `parseODataResponse()` –≤ `ODataSyncWorker.ts` - –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é
3. `generateVirtualStops()` –≤ `VirtualEntitiesGeneratorWorker.ts` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å unified-cities-loader
4. `ensureYakutiaCitiesConnectivity()` ‚Üí `ensureCitiesConnectivity()` –≤ `VirtualEntitiesGeneratorWorker.ts` - –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –∏ —Ä–∞—Å—à–∏—Ä–∏—Ç—å
5. `buildGraphStructure()` –≤ `GraphBuilderWorker.ts` - –¥–æ–±–∞–≤–∏—Ç—å —Ä—ë–±—Ä–∞ –ø–µ—Ä–µ—Å–∞–¥–∫–∏
6. `calculateTransferWeight()` –≤ `GraphBuilderWorker.ts` - –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥
7. `buildFromDataset()` –≤ `RouteGraphBuilder.ts` - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ ferry
8. `executeWorkerLogic()` –≤ `GraphBuilderWorker.ts` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è (3 —Å—Ç—Ä—É–∫—Ç—É—Ä—ã)

1. `TransportType` –≤ `Route.ts` - –¥–æ–±–∞–≤–∏—Ç—å `'FERRY'`
2. `GraphNeighbor` –≤ `IGraphRepository.ts` - –¥–æ–±–∞–≤–∏—Ç—å `transportType?: string`
3. `Route.metadata` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è `ferrySchedule` (—É–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)

### –¢–µ—Å—Ç—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (12 —Ñ–∞–π–ª–æ–≤)

**–ù–æ–≤—ã–µ —Ç–µ—Å—Ç—ã (5 —Ñ–∞–π–ª–æ–≤):**
1. `airports-loader.test.ts`
2. `suburbs-loader.test.ts`
3. `stop-validator.test.ts`
4. `unified-cities-loader.test.ts`
5. `graph-validator.test.ts`
6. `AirRouteGeneratorWorker.test.ts`

**–û–±–Ω–æ–≤–ª—è–µ–º—ã–µ —Ç–µ—Å—Ç—ã (6 —Ñ–∞–π–ª–æ–≤):**
1. `city-normalizer.test.ts`
2. `ODataSyncWorker.test.ts`
3. `VirtualEntitiesGeneratorWorker.test.ts`
4. `GraphBuilderWorker.test.ts`
5. `RouteGraphBuilder.test.ts`
6. `OptimizedBuildRouteUseCase.integration.test.ts`

---

## ‚úÖ –ö–†–ò–¢–ï–†–ò–ò –£–°–ü–ï–•–ê –ü–û –≠–¢–ê–ü–ê–ú

### –≠—Ç–∞–ø 1 (–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)
- ‚úÖ "–ê—ç—Ä–æ–ø–æ—Ä—Ç –Ø–∫—É—Ç—Å–∫ (–¢—É–π–º–∞–∞–¥–∞)" ‚Üí `city_id = "–Ø–∫—É—Ç—Å–∫"`
- ‚úÖ "–ù–∏–∂–Ω–∏–π –ë–µ—Å—Ç—è—Ö" ‚Üí `city_id = "–Ø–∫—É—Ç—Å–∫"`
- ‚úÖ "–¢—É–π–º–∞–∞–¥–∞" –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π –≥–æ—Ä–æ–¥
- ‚úÖ –ú—É—Å–æ—Ä–Ω—ã–µ –∑–∞–ø–∏—Å–∏ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –í—Å–µ unit-—Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

### –≠—Ç–∞–ø 2 (–§–µ–¥–µ—Ä–∞–ª—å–Ω—ã–µ –≥–æ—Ä–æ–¥–∞)
- ‚úÖ 10 —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ —Å–∏—Å—Ç–µ–º–µ
- ‚úÖ –ú–∞—Ä—à—Ä—É—Ç—ã –∏–∑ —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ –≤ –Ø–∫—É—Ç–∏—é —Å—Ç—Ä–æ—è—Ç—Å—è (—á–µ—Ä–µ–∑ –Ø–∫—É—Ç—Å–∫)
- ‚úÖ –ú–∞—Ä—à—Ä—É—Ç—ã –º–µ–∂–¥—É —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–º–∏ –≥–æ—Ä–æ–¥–∞–º–∏ —Å—Ç—Ä–æ—è—Ç—Å—è (–ø—Ä—è–º—ã–µ)
- ‚úÖ –í—Å–µ unit-—Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

### –≠—Ç–∞–ø 3 (–°–º–µ—à–∞–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã –∏ –ø–µ—Ä–µ–ø—Ä–∞–≤–∞)
- ‚úÖ –°–º–µ—à–∞–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã (air + ground + ferry) —Å—Ç—Ä–æ—è—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ü–µ—Ä–µ–ø—Ä–∞–≤–∞ –Ø–∫—É—Ç—Å–∫ ‚Üî –ù–∏–∂–Ω–∏–π –ë–µ—Å—Ç—è—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ ferry-—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç
- ‚úÖ –ü–µ—Ä–µ—Å–∞–¥–∫–∏ –º–µ–∂–¥—É —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞–º–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –≤–µ—Å–∞–º–∏
- ‚úÖ –í—Å–µ unit-—Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

### –≠—Ç–∞–ø 4 (–ì—Ä–∞—Ñ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è)
- ‚úÖ –ì—Ä–∞—Ñ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —É–∑–ª–æ–≤ –∏ –≤–µ—Å–æ–≤
- ‚úÖ –û–±–Ω–∞—Ä—É–∂–∏–≤–∞—é—Ç—Å—è –∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –ø—Ä–æ–±–ª–µ–º—ã —Å–≤—è–∑–Ω–æ—Å—Ç–∏
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ —É—Å—Ç–æ–π—á–∏–≤–∞ –∫ –æ—à–∏–±–∫–∞–º
- ‚úÖ –í—Å–µ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã —Å—Ç—Ä–æ—è—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

---

## üéØ –ì–û–¢–û–í–ù–û–°–¢–¨ –ö –í–´–ü–û–õ–ù–ï–ù–ò–Æ

–ü–ª–∞–Ω –≥–æ—Ç–æ–≤ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é. –í—Å–µ —Ñ–∞–π–ª—ã, —Ñ—É–Ω–∫—Ü–∏–∏ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã.

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –î–æ–∂–¥–∞—Ç—å—Å—è –∫–æ–º–∞–Ω–¥—ã "–≤—ã–ø–æ–ª–Ω—è–π" –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

---

**–ö–æ–Ω–µ—Ü –¥–æ–∫—É–º–µ–Ω—Ç–∞**




