# –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–ª–∞–Ω –º–æ–¥–µ—Ä–Ω–∏–∑–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤

**–î–∞—Ç–∞:** 2025-01-XX  
**–í–µ—Ä—Å–∏—è:** 3.0.0  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏  
**–û—Å–Ω–æ–≤–∞–Ω –Ω–∞:** `MULTIMODAL_ROUTE_SYSTEM_IMPROVEMENT_PLAN.md`, `IMPROVED_TECHNICAL_PLAN.md`

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ç–µ–∫—É—â–µ–π —Å–∏—Ç—É–∞—Ü–∏–∏](#1-–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞-—Ç–µ–∫—É—â–µ–π-—Å–∏—Ç—É–∞—Ü–∏–∏)
2. [–ü–ª–∞–Ω –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö](#2-–ø–ª–∞–Ω-–ø–æ-–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é-–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏-–¥–∞–Ω–Ω—ã—Ö)
3. [–ü–ª–∞–Ω –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –≥–æ—Ä–æ–¥–æ–≤](#3-–ø–ª–∞–Ω-–¥–æ–±–∞–≤–ª–µ–Ω–∏—è-—Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö-–≥–æ—Ä–æ–¥–æ–≤)
4. [–ü–ª–∞–Ω –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Å–º–µ—à–∞–Ω–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤](#4-–ø–ª–∞–Ω-–ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è-—Å–º–µ—à–∞–Ω–Ω—ã—Ö-–º–∞—Ä—à—Ä—É—Ç–æ–≤)
5. [–ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–µ–ø—Ä–∞–≤—ã](#5-–ø–ª–∞–Ω-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏-–ø–µ—Ä–µ–ø—Ä–∞–≤—ã)
6. [–ü–ª–∞–Ω –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é —Ä–∞–±–æ—Ç—ã GraphBuilderWorker](#6-–ø–ª–∞–Ω-–ø–æ-–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é-—Ä–∞–±–æ—Ç—ã-graphbuilderworker)
7. [–ß—ë—Ç–∫–∏–π —Å–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ —Ñ–∞–π–ª–∞–º](#7-—á—ë—Ç–∫–∏–π-—Å–ø–∏—Å–æ–∫-–∏–∑–º–µ–Ω–µ–Ω–∏–π-–ø–æ-—Ñ–∞–π–ª–∞–º)
8. [–ì–æ—Ç–æ–≤—ã–π –ø–æ—Ä—è–¥–æ–∫ —Ä–∞–±–æ—Ç](#8-–≥–æ—Ç–æ–≤—ã–π-–ø–æ—Ä—è–¥–æ–∫-—Ä–∞–±–æ—Ç)
9. [–ö–æ–Ω—Ç—Ä-–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è](#9-–∫–æ–Ω—Ç—Ä-–ø—Ä–æ–≤–µ—Ä–∫–∞-–ø–æ—Å–ª–µ-–≤–Ω–µ–¥—Ä–µ–Ω–∏—è)

---

## 1. –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ç–µ–∫—É—â–µ–π —Å–∏—Ç—É–∞—Ü–∏–∏

### 1.1 –ü–æ—á–µ–º—É –∏—Å—á–µ–∑ ¬´–Ø–∫—É—Ç—Å–∫¬ª

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:**
- **–§–∞–π–ª:** `backend/src/shared/utils/city-normalizer.ts`, —Ñ—É–Ω–∫—Ü–∏—è `extractCityFromStopName()` (—Å—Ç—Ä–æ–∫–∏ 121-180)
- **–ü—Ä–æ–±–ª–µ–º–∞:** –§—É–Ω–∫—Ü–∏—è –∏–∑–≤–ª–µ–∫–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–ª–æ–≤–æ –≤ —Å–∫–æ–±–∫–∞—Ö –∫–∞–∫ –≥–æ—Ä–æ–¥
- **–ü—Ä–∏–º–µ—Ä:** "–ê—ç—Ä–æ–ø–æ—Ä—Ç –Ø–∫—É—Ç—Å–∫ (–¢—É–π–º–∞–∞–¥–∞)" ‚Üí –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è "–¢—É–π–º–∞–∞–¥–∞" –≤–º–µ—Å—Ç–æ "–Ø–∫—É—Ç—Å–∫"
- **–ì–¥–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
  - `ODataSyncWorker.ts:267` ‚Üí `cityName = extractCityFromStopName(stopData.name, stopData.address)`
  - `RouteGraphBuilder.ts:72` ‚Üí `const cityName = extractCityFromStopName(stop.name, stop.metadata?.address)`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Å `city_id = "–¢—É–π–º–∞–∞–¥–∞"`, –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –ø–æ "–Ø–∫—É—Ç—Å–∫" –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è

**–¢–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞:**
```typescript
// –°—Ç—Ä–æ–∫–∏ 134-158: –∏–∑–≤–ª–µ–∫–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–ª–æ–≤–æ, –∏–≥–Ω–æ—Ä–∏—Ä—É—è —Å–∫–æ–±–∫–∏
const words = stopName.match(/[–ê-–Ø–∞-—è–Å—ë]+(?:-[–ê-–Ø–∞-—è–Å—ë]+)*/g);
const lastWord = words[words.length - 1].toLowerCase();
// –ü—Ä–æ–±–ª–µ–º–∞: –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω "–ê—ç—Ä–æ–ø–æ—Ä—Ç [–ì–æ—Ä–æ–¥] ([–ê—ç—Ä–æ–ø–æ—Ä—Ç])"
```

### 1.2 –ü–æ—á–µ–º—É –ø–æ—è–≤–∏–ª—Å—è ¬´–¢—É–π–º–∞–¥–∞¬ª

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:**
- –¢–∞ –∂–µ, —á—Ç–æ –≤ 1.1: `extractCityFromStopName()` –∏–∑–≤–ª–µ–∫–∞–µ—Ç "–¢—É–π–º–∞–∞–¥–∞" –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π –≥–æ—Ä–æ–¥
- **–ì–¥–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
  - `ODataSyncWorker.ts` ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å `city_id = "–¢—É–π–º–∞–∞–¥–∞"`
  - `VirtualEntitiesGeneratorWorker.ts:519` ‚Üí `const cityName = stop.cityId || this.extractCityFromStopName(stop.name)`
  - –ï—Å–ª–∏ "–¢—É–π–º–∞–∞–¥–∞" –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ `yakutia-cities-reference.json`, –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å—Å—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í –ë–î –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∑–∞–ø–∏—Å—å —Å `city_id = "–¢—É–π–º–∞–∞–¥–∞"` (–∏–ª–∏ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ "—Ç—É–π–º–∞–∞–¥–∞"), –∫–æ—Ç–æ—Ä–∞—è –Ω–µ –¥–æ–ª–∂–Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å

### 1.3 –ü–æ—á–µ–º—É —á–∞—Å—Ç—å –≥–æ—Ä–æ–¥–æ–≤ –ø—Ä–æ–ø–∞–ª–∞ –∏–ª–∏ —Ä–∞–∑–º–Ω–æ–∂–∏–ª–∞—Å—å

**–ö–æ—Ä–Ω–µ–≤—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**

1. **–ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º:**
   - `ODataSyncWorker.parseODataResponse()` (—Å—Ç—Ä–æ–∫–∏ 252-284) –Ω–µ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º `RealStop`
   - –ú–æ–≥—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å –ø—É—Å—Ç—ã–º `city_id`, –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏, –æ–ø–µ—á–∞—Ç–∫–∞–º–∏

2. **–ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã:**
   - –û–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –≥–æ—Ä–æ–¥ –º–æ–∂–µ—Ç —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è —Å —Ä–∞–∑–Ω—ã–º–∏ `city_id` (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–Ø–∫—É—Ç—Å–∫" –∏ "—è–∫—É—Ç—Å–∫")
   - –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤ –ë–î

3. **–ù–µ—Ç whitelist –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –≥–æ—Ä–æ–¥–æ–≤:**
   - `extractCityFromStopName()` –º–æ–∂–µ—Ç –∏–∑–≤–ª–µ—á—å –º—É—Å–æ—Ä–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (—Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞, –æ–ø–µ—á–∞—Ç–∫–∏)
   - –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–π –≥–æ—Ä–æ–¥ –µ—Å—Ç—å –≤ reference

### 1.4 –ì–¥–µ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –º—É—Å–æ—Ä–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ –∏–∑ OData

**–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –º—É—Å–æ—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:**

1. **ODataSyncWorker.parseODataResponse()** (—Å—Ç—Ä–æ–∫–∏ 258-284):
   - –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π (`name`, `latitude`, `longitude`)
   - –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç (–¥–∏–∞–ø–∞–∑–æ–Ω, NaN)
   - –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑–≤–ª–µ—á–µ–Ω–Ω–æ–≥–æ `city_id` (–Ω–µ –ø—É—Å—Ç–æ–π, –Ω–µ —Å–ª—É–∂–µ–±–Ω–æ–µ —Å–ª–æ–≤–æ)

2. **extractCityFromStopName()** (—Å—Ç—Ä–æ–∫–∏ 121-180):
   - –ú–æ–∂–µ—Ç –∏–∑–≤–ª–µ—á—å —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞ ("—Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è", "–≥–ª–∞–≤–Ω—ã–π") –∫–∞–∫ –≥–æ—Ä–æ–¥–∞
   - –ú–æ–∂–µ—Ç –∏–∑–≤–ª–µ—á—å –æ–ø–µ—á–∞—Ç–∫–∏ –∏–∑ OData
   - –ù–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –∏–∑–≤–ª–µ—á–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –µ—Å—Ç—å –≤ reference

3. **VirtualEntitiesGeneratorWorker** (—Å—Ç—Ä–æ–∫–∏ 519-684):
   - –ú–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–ª—è –≥–æ—Ä–æ–¥–æ–≤, –Ω–µ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –≤ reference
   - –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ –≥–æ—Ä–æ–¥ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –Ω–∞–∑–≤–∞–Ω–∏–µ–º –∞—ç—Ä–æ–ø–æ—Ä—Ç–∞ –∏–ª–∏ –ø—Ä–∏–≥–æ—Ä–æ–¥–∞

### 1.5 –ö–∞–∫ –∏–º–µ–Ω–Ω–æ —Å–µ–π—á–∞—Å —Å—Ç—Ä–æ–∏—Ç—Å—è –≥—Ä–∞—Ñ –∏ —á—Ç–æ –ª–æ–º–∞–µ—Ç —Å–≤—è–∑–Ω–æ—Å—Ç—å

**–¢–µ–∫—É—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∞:**

1. **GraphBuilderWorker.executeWorkerLogic()** (—Å—Ç—Ä–æ–∫–∏ 94-446):
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ (real + virtual) –∏–∑ PostgreSQL
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ –º–∞—Ä—à—Ä—É—Ç—ã (real + virtual) –∏–∑ PostgreSQL
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ —Ä–µ–π—Å—ã –∏–∑ PostgreSQL
   - –°—Ç—Ä–æ–∏—Ç –≥—Ä–∞—Ñ: —É–∑–ª—ã = –æ—Å—Ç–∞–Ω–æ–≤–∫–∏, —Ä—ë–±—Ä–∞ = –º–∞—Ä—à—Ä—É—Ç—ã

2. **–ü—Ä–æ–±–ª–µ–º—ã —Å–≤—è–∑–Ω–æ—Å—Ç–∏:**

   **a) –ù–µ—Ç —Ä—ë–±–µ—Ä –ø–µ—Ä–µ—Å–∞–¥–∫–∏:**
   - –ï—Å–ª–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤ –æ–¥–Ω–æ–º –≥–æ—Ä–æ–¥–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ê—ç—Ä–æ–ø–æ—Ä—Ç –Ø–∫—É—Ç—Å–∫" –∏ "–ê–≤—Ç–æ—Å—Ç–∞–Ω—Ü–∏—è –Ø–∫—É—Ç—Å–∫"), –º–µ–∂–¥—É –Ω–∏–º–∏ –Ω–µ—Ç —Ä–µ–±—Ä–∞
   - –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç "–ú–æ—Å–∫–≤–∞ ‚Üí –ê—ç—Ä–æ–ø–æ—Ä—Ç –Ø–∫—É—Ç—Å–∫ ‚Üí –ê–≤—Ç–æ—Å—Ç–∞–Ω—Ü–∏—è –Ø–∫—É—Ç—Å–∫ ‚Üí –û–ª—ë–∫–º–∏–Ω—Å–∫"

   **b) –ù–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Å–º–µ—à–∞–Ω–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤:**
   - –ì—Ä–∞—Ñ –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ—Å–∞–¥–æ–∫ –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
   - –ù–µ—Ç —Ä—ë–±–µ—Ä —Ç–∏–ø–∞ `TRANSFER` –¥–ª—è –ø–µ—Ä–µ—Å–∞–¥–æ–∫ –≤ –æ–¥–Ω–æ–º –≥–æ—Ä–æ–¥–µ

   **c) –ù–µ—Ç ferry-–º–∞—Ä—à—Ä—É—Ç–æ–≤:**
   - –ü–µ—Ä–µ–ø—Ä–∞–≤–∞ –Ø–∫—É—Ç—Å–∫ ‚Üî –ù–∏–∂–Ω–∏–π –ë–µ—Å—Ç—è—Ö –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
   - –ù–µ—Ç —Ç–∏–ø–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ `FERRY` –≤ –≥—Ä–∞—Ñ–µ

   **d) –ù–µ—Ç —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤:**
   - –§–µ–¥–µ—Ä–∞–ª—å–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ reference
   - –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–ª—è –Ω–∏—Ö –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è
   - –ú–∞—Ä—à—Ä—É—Ç—ã –∏–∑ —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ –Ω–µ —Å—Ç—Ä–æ—è—Ç—Å—è

3. **RouteGraphBuilder.buildFromDataset()** (—Å—Ç—Ä–æ–∫–∏ 35-937):
   - –°—Ç—Ä–æ–∏—Ç –≥—Ä–∞—Ñ –∏–∑ –¥–∞—Ç–∞—Å–µ—Ç–∞, –Ω–æ –Ω–µ —Å–æ–∑–¥–∞–µ—Ç —Ä—ë–±—Ä–∞ –ø–µ—Ä–µ—Å–∞–¥–∫–∏
   - –ù–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–º–µ—à–∞–Ω–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤

---

## 2. –ü–ª–∞–Ω –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

### 2.1 –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∞—ç—Ä–æ–ø–æ—Ä—Ç–æ–≤ (–æ—Å–æ–±–µ–Ω–Ω–æ –∞—ç—Ä–æ–ø–æ—Ä—Ç –Ø–∫—É—Ç—Å–∫–∞)

#### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∞—ç—Ä–æ–ø–æ—Ä—Ç–æ–≤

**–§–∞–π–ª:** `backend/data/reference/airports-reference.json` (–ù–û–í–´–ô)

```json
{
  "version": "1.0.0",
  "description": "–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∞—ç—Ä–æ–ø–æ—Ä—Ç–æ–≤ –∏ –∏—Ö –≥–æ—Ä–æ–¥–æ–≤ –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞–∑–≤–∞–Ω–∏–π –æ—Å—Ç–∞–Ω–æ–≤–æ–∫",
  "airports": [
    {
      "name": "–¢—É–π–º–∞–∞–¥–∞",
      "city": "–Ø–∫—É—Ç—Å–∫",
      "aliases": ["–¢—É–π–º–∞–¥–∞", "Yakutsk Airport", "YKS"],
      "normalizedName": "—Ç—É–π–º–∞–∞–¥–∞"
    },
    {
      "name": "–®–µ—Ä–µ–º–µ—Ç—å–µ–≤–æ",
      "city": "–ú–æ—Å–∫–≤–∞",
      "aliases": ["SVO", "Sheremetyevo"],
      "normalizedName": "—à–µ—Ä–µ–º–µ—Ç—å–µ–≤–æ"
    },
    {
      "name": "–î–æ–º–æ–¥–µ–¥–æ–≤–æ",
      "city": "–ú–æ—Å–∫–≤–∞",
      "aliases": ["DME", "Domodedovo"],
      "normalizedName": "–¥–æ–º–æ–¥–µ–¥–æ–≤–æ"
    },
    {
      "name": "–í–Ω—É–∫–æ–≤–æ",
      "city": "–ú–æ—Å–∫–≤–∞",
      "aliases": ["VKO", "Vnukovo"],
      "normalizedName": "–≤–Ω—É–∫–æ–≤–æ"
    },
    {
      "name": "–ü—É–ª–∫–æ–≤–æ",
      "city": "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥",
      "aliases": ["LED", "Pulkovo"],
      "normalizedName": "–ø—É–ª–∫–æ–≤–æ"
    },
    {
      "name": "–¢–æ–ª–º–∞—á—ë–≤–æ",
      "city": "–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫",
      "aliases": ["OVB", "Tolmachevo"],
      "normalizedName": "—Ç–æ–ª–º–∞—á—ë–≤–æ"
    },
    {
      "name": "–ï–º–µ–ª—å—è–Ω–æ–≤–æ",
      "city": "–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫",
      "aliases": ["KJA", "Yemelyanovo"],
      "normalizedName": "–µ–º–µ–ª—å—è–Ω–æ–≤–æ"
    },
    {
      "name": "–ö–æ–ª—å—Ü–æ–≤–æ",
      "city": "–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥",
      "aliases": ["SVX", "Koltsovo"],
      "normalizedName": "–∫–æ–ª—å—Ü–æ–≤–æ"
    }
  ]
}
```

#### –®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å —É—Ç–∏–ª–∏—Ç—É –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –∞—ç—Ä–æ–ø–æ—Ä—Ç–æ–≤

**–§–∞–π–ª:** `backend/src/shared/utils/airports-loader.ts` (–ù–û–í–´–ô)

```typescript
import fs from 'fs';
import path from 'path';
import { normalizeCityName } from './city-normalizer';

export interface AirportReference {
  name: string;
  city: string;
  aliases: string[];
  normalizedName: string;
}

export function loadAirportsReference(): Map<string, string> {
  const airportsMap = new Map<string, string>();
  
  const referencePath = path.join(
    __dirname,
    '../../../data/reference/airports-reference.json'
  );
  
  if (!fs.existsSync(referencePath)) {
    console.warn(`[AirportsLoader] Reference file not found: ${referencePath}`);
    return airportsMap;
  }
  
  const fileContent = fs.readFileSync(referencePath, 'utf-8');
  const reference = JSON.parse(fileContent);
  
  for (const airport of reference.airports) {
    // –î–æ–±–∞–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
    airportsMap.set(normalizeCityName(airport.name), airport.city);
    // –î–æ–±–∞–≤–ª—è–µ–º –∞–ª–∏–∞—Å—ã
    for (const alias of airport.aliases) {
      airportsMap.set(normalizeCityName(alias), airport.city);
    }
  }
  
  return airportsMap;
}

export function getCityByAirportName(airportName: string): string | undefined {
  const airportsMap = loadAirportsReference();
  const normalized = normalizeCityName(airportName);
  return airportsMap.get(normalized);
}
```

#### –®–∞–≥ 3: –û–±–Ω–æ–≤–∏—Ç—å `extractCityFromStopName()` –≤ `city-normalizer.ts`

**–§–∞–π–ª:** `backend/src/shared/utils/city-normalizer.ts` (–û–ë–ù–û–í–ò–¢–¨)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
1. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `getCityByAirportName` –∏–∑ `airports-loader.ts`
2. –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `extractCityFromStopName()` (—Å—Ç—Ä–æ–∫–∏ 121-180):

```typescript
export function extractCityFromStopName(stopName?: string, address?: string): string {
  if (!stopName) {
    return address ? extractCityFromAddress(address) : '';
  }

  // –®–ê–ì 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ "–ê—ç—Ä–æ–ø–æ—Ä—Ç [–ì–æ—Ä–æ–¥] ([–ù–∞–∑–≤–∞–Ω–∏–µ –∞—ç—Ä–æ–ø–æ—Ä—Ç–∞])"
  const airportPattern = /–ê—ç—Ä–æ–ø–æ—Ä—Ç\s+([–ê-–Ø–∞-—è–Å—ë\-\s]+)\s*\(([^)]+)\)/i;
  const airportMatch = stopName.match(airportPattern);
  
  if (airportMatch) {
    const cityPart = airportMatch[1].trim(); // "–Ø–∫—É—Ç—Å–∫"
    const airportName = airportMatch[2].trim(); // "–¢—É–π–º–∞–∞–¥–∞"
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –≤ —Å–∫–æ–±–∫–∞—Ö –∏–∑–≤–µ—Å—Ç–Ω—ã–º –∞—ç—Ä–æ–ø–æ—Ä—Ç–æ–º
    const cityFromReference = getCityByAirportName(airportName);
    if (cityFromReference) {
      return cityFromReference; // "–Ø–∫—É—Ç—Å–∫" –≤–º–µ—Å—Ç–æ "–¢—É–π–º–∞–∞–¥–∞"
    }
    
    // Fallback: –∏–∑–≤–ª–µ–∫–∞–µ–º –≥–æ—Ä–æ–¥ –∏–∑ —á–∞—Å—Ç–∏ –î–û —Å–∫–æ–±–æ–∫
    return extractCityFromPart(cityPart);
  }

  // –®–ê–ì 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ "–ê—ç—Ä–æ–ø–æ—Ä—Ç [–ì–æ—Ä–æ–¥]" (–±–µ–∑ —Å–∫–æ–±–æ–∫)
  const airportSimplePattern = /–ê—ç—Ä–æ–ø–æ—Ä—Ç\s+([–ê-–Ø–∞-—è–Å—ë\-\s]+)/i;
  const airportSimpleMatch = stopName.match(airportSimplePattern);
  
  if (airportSimpleMatch) {
    return extractCityFromPart(airportSimpleMatch[1].trim());
  }

  // –®–ê–ì 3: –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤
  // ... (–æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
}

function extractCityFromPart(part: string): string {
  const words = part.match(/[–ê-–Ø–∞-—è–Å—ë]+(?:-[–ê-–Ø–∞-—è–Å—ë]+)*/g);
  if (!words || words.length === 0) {
    return part.trim();
  }
  
  const stopTypeWords = new Set([
    '–∞—ç—Ä–æ–ø–æ—Ä—Ç', '–≤–æ–∫–∑–∞–ª', '–∞–≤—Ç–æ—Å—Ç–∞–Ω—Ü–∏—è', '–∞–≤—Ç–æ–≤–æ–∫–∑–∞–ª', '–æ—Å—Ç–∞–Ω–æ–≤–∫–∞', '—Å—Ç–∞–Ω—Ü–∏—è',
    '—Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è', '–≥–ª–∞–≤–Ω—ã–π', '–ø–∞—Å—Å–∞–∂–∏—Ä—Å–∫–∏–π'
  ]);
  
  const lastWord = words[words.length - 1].toLowerCase();
  if (!stopTypeWords.has(lastWord) && words.length > 1) {
    return words[words.length - 1];
  } else if (words.length > 1) {
    return words[0];
  } else {
    return words[0];
  }
}
```

### 2.2 –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å–≤—è–∑–∏ ¬´–ù–∏–∂–Ω–∏–π –ë–µ—Å—Ç—è—Ö ‚Üí –Ø–∫—É—Ç—Å–∫¬ª

#### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ø—Ä–∏–≥–æ—Ä–æ–¥–æ–≤

**–§–∞–π–ª:** `backend/data/reference/suburbs-reference.json` (–ù–û–í–´–ô)

```json
{
  "version": "1.0.0",
  "description": "–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ø—Ä–∏–≥–æ—Ä–æ–¥–æ–≤ –∏ –∏—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤",
  "suburbs": [
    {
      "name": "–ù–∏–∂–Ω–∏–π –ë–µ—Å—Ç—è—Ö",
      "mainCity": "–Ø–∫—É—Ç—Å–∫",
      "type": "ferry_terminal",
      "normalizedName": "–Ω–∏–∂–Ω–∏–π –±–µ—Å—Ç—è—Ö"
    },
    {
      "name": "–ë–µ—Ä–∫–∞–∫–∏—Ç",
      "mainCity": "–ù–µ—Ä—é–Ω–≥—Ä–∏",
      "type": "railway_station",
      "normalizedName": "–±–µ—Ä–∫–∞–∫–∏—Ç"
    }
  ]
}
```

#### –®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å —É—Ç–∏–ª–∏—Ç—É –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –ø—Ä–∏–≥–æ—Ä–æ–¥–æ–≤

**–§–∞–π–ª:** `backend/src/shared/utils/suburbs-loader.ts` (–ù–û–í–´–ô)

```typescript
import fs from 'fs';
import path from 'path';
import { normalizeCityName } from './city-normalizer';

export interface SuburbReference {
  name: string;
  mainCity: string;
  type: string;
  normalizedName: string;
}

export function loadSuburbsReference(): Map<string, string> {
  const suburbsMap = new Map<string, string>();
  
  const referencePath = path.join(
    __dirname,
    '../../../data/reference/suburbs-reference.json'
  );
  
  if (!fs.existsSync(referencePath)) {
    console.warn(`[SuburbsLoader] Reference file not found: ${referencePath}`);
    return suburbsMap;
  }
  
  const fileContent = fs.readFileSync(referencePath, 'utf-8');
  const reference = JSON.parse(fileContent);
  
  for (const suburb of reference.suburbs) {
    suburbsMap.set(normalizeCityName(suburb.name), suburb.mainCity);
  }
  
  return suburbsMap;
}

export function getMainCityBySuburb(suburbName: string): string | undefined {
  const suburbsMap = loadSuburbsReference();
  const normalized = normalizeCityName(suburbName);
  return suburbsMap.get(normalized);
}
```

#### –®–∞–≥ 3: –û–±–Ω–æ–≤–∏—Ç—å `ODataSyncWorker.parseODataResponse()`

**–§–∞–π–ª:** `backend/src/application/workers/ODataSyncWorker.ts` (–û–ë–ù–û–í–ò–¢–¨)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –º–µ—Ç–æ–¥–µ `parseODataResponse()` (—Å—Ç—Ä–æ–∫–∏ 252-284):**

```typescript
import { getCityByAirportName } from '../../shared/utils/airports-loader';
import { getMainCityBySuburb } from '../../shared/utils/suburbs-loader';
import { isCityInUnifiedReference } from '../../shared/utils/unified-cities-loader';

private parseODataResponse(response: ODataResponse): {
  stops: RealStop[];
  routes: Route[];
  flights: Flight[];
} {
  const stops = response.stops.map((stopData: any) => {
    // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç ...
    
    // –ò–∑–≤–ª–µ–∫–∞–µ–º city_id
    let cityName = stopData.cityName;
    if (!cityName && stopData.name) {
      cityName = extractCityFromStopName(stopData.name, stopData.address);
    }
    
    // –ù–û–†–ú–ê–õ–ò–ó–ê–¶–ò–Ø: –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏–≥–æ—Ä–æ–¥—ã
    if (cityName) {
      const mainCity = getMainCityBySuburb(cityName);
      if (mainCity) {
        cityName = mainCity; // "–ù–∏–∂–Ω–∏–π –ë–µ—Å—Ç—è—Ö" ‚Üí "–Ø–∫—É—Ç—Å–∫"
      }
    }
    
    // –ù–û–†–ú–ê–õ–ò–ó–ê–¶–ò–Ø: –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞—ç—Ä–æ–ø–æ—Ä—Ç—ã (–µ—Å–ª–∏ cityName –≤—Å–µ –µ—â–µ –ø–æ—Ö–æ–∂ –Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏–µ –∞—ç—Ä–æ–ø–æ—Ä—Ç–∞)
    if (cityName) {
      const cityFromAirport = getCityByAirportName(cityName);
      if (cityFromAirport) {
        cityName = cityFromAirport; // "–¢—É–π–º–∞–∞–¥–∞" ‚Üí "–Ø–∫—É—Ç—Å–∫"
      }
    }
    
    // –í–ê–õ–ò–î–ê–¶–ò–Ø: –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ city_id –µ—Å—Ç—å –≤ unified-cities-reference.json
    if (cityName && !isCityInUnifiedReference(cityName)) {
      this.log('WARN', `City "${cityName}" not found in unified reference, skipping stop "${stopData.name}"`);
      return null; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ—Å—Ç–∞–Ω–æ–≤–∫—É
    }
    
    // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ —Å–æ–∑–¥–∞–Ω–∏—è RealStop ...
  }).filter(stop => stop !== null); // –§–∏–ª—å—Ç—Ä—É–µ–º null
    
  // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ ...
}
```

### 2.3 –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è OData

#### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ç–æ—Ä –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–æ–∫

**–§–∞–π–ª:** `backend/src/shared/validators/stop-validator.ts` (–ù–û–í–´–ô)

```typescript
export interface ValidationResult {
  isValid: boolean;
  errors: string[];
}

export function validateStopData(stopData: {
  name?: string;
  latitude?: number;
  longitude?: number;
  cityId?: string;
}): ValidationResult {
  const errors: string[] = [];
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ name
  if (!stopData.name || stopData.name.trim().length < 3) {
    errors.push('Stop name must be at least 3 characters');
  }
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ latitude
  if (stopData.latitude === undefined || stopData.latitude === null) {
    errors.push('Latitude is required');
  } else if (isNaN(stopData.latitude) || stopData.latitude < -90 || stopData.latitude > 90) {
    errors.push(`Invalid latitude: ${stopData.latitude}`);
  }
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ longitude
  if (stopData.longitude === undefined || stopData.longitude === null) {
    errors.push('Longitude is required');
  } else if (isNaN(stopData.longitude) || stopData.longitude < -180 || stopData.longitude > 180) {
    errors.push(`Invalid longitude: ${stopData.longitude}`);
  }
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ cityId (–µ—Å–ª–∏ –∏–∑–≤–ª–µ—á–µ–Ω)
  if (stopData.cityId) {
    const stopTypeWords = new Set([
      '–∞—ç—Ä–æ–ø–æ—Ä—Ç', '–≤–æ–∫–∑–∞–ª', '–∞–≤—Ç–æ—Å—Ç–∞–Ω—Ü–∏—è', '–∞–≤—Ç–æ–≤–æ–∫–∑–∞–ª', '–æ—Å—Ç–∞–Ω–æ–≤–∫–∞', '—Å—Ç–∞–Ω—Ü–∏—è',
      '—Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è', '–≥–ª–∞–≤–Ω—ã–π', '–ø–∞—Å—Å–∞–∂–∏—Ä—Å–∫–∏–π', '—Ç—É–π–º–∞–∞–¥–∞', '—Ç—É–π–º–∞–¥–∞'
    ]);
    
    const normalizedCityId = stopData.cityId.toLowerCase().trim();
    if (stopTypeWords.has(normalizedCityId)) {
      errors.push(`Invalid cityId: "${stopData.cityId}" is a stop type word, not a city`);
    }
  }
  
  return {
    isValid: errors.length === 0,
    errors
  };
}
```

#### –®–∞–≥ 2: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ç–æ—Ä –≤ `ODataSyncWorker`

**–§–∞–π–ª:** `backend/src/application/workers/ODataSyncWorker.ts` (–û–ë–ù–û–í–ò–¢–¨)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```typescript
import { validateStopData } from '../../shared/validators/stop-validator';

private parseODataResponse(response: ODataResponse): {
  stops: RealStop[];
  routes: Route[];
  flights: Flight[];
  validationStats: {
    totalStops: number;
    validStops: number;
    invalidStops: number;
    errors: Array<{ stopName: string; errors: string[] }>;
  };
} {
  const validationErrors: Array<{ stopName: string; errors: string[] }> = [];
  
  const stops = response.stops
    .map((stopData: any) => {
      // ... –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è city_id (–∫–∞–∫ –≤ —Ä–∞–∑–¥–µ–ª–µ 2.2) ...
      
      // –í–ê–õ–ò–î–ê–¶–ò–Ø
      const validation = validateStopData({
        name: stopData.name,
        latitude: stopData.coordinates?.latitude ?? stopData.latitude,
        longitude: stopData.coordinates?.longitude ?? stopData.longitude,
        cityId: cityName
      });
      
      if (!validation.isValid) {
        validationErrors.push({
          stopName: stopData.name || 'Unknown',
          errors: validation.errors
        });
        return null; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–µ–≤–∞–ª–∏–¥–Ω—É—é –æ—Å—Ç–∞–Ω–æ–≤–∫—É
      }
      
      // ... —Å–æ–∑–¥–∞–Ω–∏–µ RealStop ...
    })
    .filter(stop => stop !== null);
  
  return {
    stops,
    routes: /* ... */,
    flights: /* ... */,
    validationStats: {
      totalStops: response.stops.length,
      validStops: stops.length,
      invalidStops: validationErrors.length,
      errors: validationErrors
    }
  };
}
```

### 2.4 –ï–¥–∏–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –≥–æ—Ä–æ–¥–æ–≤, –≤–∫–ª—é—á–∞—è —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–µ

#### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤

**–§–∞–π–ª:** `backend/data/reference/russia-federal-cities-reference.json` (–ù–û–í–´–ô)

```json
{
  "version": "1.0.0",
  "description": "–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ –†–æ—Å—Å–∏–∏",
  "cities": [
    {
      "name": "–ú–æ—Å–∫–≤–∞",
      "normalizedName": "–º–æ—Å–∫–≤–∞",
      "latitude": 55.7558,
      "longitude": 37.6173,
      "region": "Central",
      "isKeyCity": true,
      "isFederalCity": true,
      "airports": ["–®–µ—Ä–µ–º–µ—Ç—å–µ–≤–æ", "–î–æ–º–æ–¥–µ–¥–æ–≤–æ", "–í–Ω—É–∫–æ–≤–æ"]
    },
    {
      "name": "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥",
      "normalizedName": "—Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥",
      "latitude": 59.9343,
      "longitude": 30.3351,
      "region": "Northwest",
      "isKeyCity": true,
      "isFederalCity": true,
      "airports": ["–ü—É–ª–∫–æ–≤–æ"]
    },
    {
      "name": "–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫",
      "normalizedName": "–Ω–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫",
      "latitude": 55.0084,
      "longitude": 82.9357,
      "region": "Siberia",
      "isKeyCity": true,
      "isFederalCity": true,
      "airports": ["–¢–æ–ª–º–∞—á—ë–≤–æ"]
    },
    {
      "name": "–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫",
      "normalizedName": "–∫—Ä–∞—Å–Ω–æ—è—Ä—Å–∫",
      "latitude": 56.0089,
      "longitude": 92.8537,
      "region": "Siberia",
      "isKeyCity": true,
      "isFederalCity": true,
      "airports": ["–ï–º–µ–ª—å—è–Ω–æ–≤–æ"]
    },
    {
      "name": "–ò—Ä–∫—É—Ç—Å–∫",
      "normalizedName": "–∏—Ä–∫—É—Ç—Å–∫",
      "latitude": 52.2680,
      "longitude": 104.3889,
      "region": "Siberia",
      "isKeyCity": true,
      "isFederalCity": true,
      "airports": ["–ò—Ä–∫—É—Ç—Å–∫"]
    },
    {
      "name": "–•–∞–±–∞—Ä–æ–≤—Å–∫",
      "normalizedName": "—Ö–∞–±–∞—Ä–æ–≤—Å–∫",
      "latitude": 48.4802,
      "longitude": 135.0719,
      "region": "FarEast",
      "isKeyCity": true,
      "isFederalCity": true,
      "airports": ["–•–∞–±–∞—Ä–æ–≤—Å–∫"]
    },
    {
      "name": "–í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫",
      "normalizedName": "–≤–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫",
      "latitude": 43.1155,
      "longitude": 131.8855,
      "region": "FarEast",
      "isKeyCity": true,
      "isFederalCity": true,
      "airports": ["–í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫"]
    },
    {
      "name": "–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥",
      "normalizedName": "–µ–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥",
      "latitude": 56.8431,
      "longitude": 60.6454,
      "region": "Ural",
      "isKeyCity": true,
      "isFederalCity": true,
      "airports": ["–ö–æ–ª—å—Ü–æ–≤–æ"]
    },
    {
      "name": "–ö–∞–∑–∞–Ω—å",
      "normalizedName": "–∫–∞–∑–∞–Ω—å",
      "latitude": 55.8304,
      "longitude": 49.0661,
      "region": "Volga",
      "isKeyCity": true,
      "isFederalCity": true,
      "airports": ["–ö–∞–∑–∞–Ω—å"]
    },
    {
      "name": "–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥",
      "normalizedName": "–Ω–∏–∂–Ω–∏–π –Ω–æ–≤–≥–æ—Ä–æ–¥",
      "latitude": 56.2965,
      "longitude": 43.9361,
      "region": "Volga",
      "isKeyCity": true,
      "isFederalCity": true,
      "airports": ["–°—Ç—Ä–∏–≥–∏–Ω–æ"]
    }
  ]
}
```

#### –®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å —É—Ç–∏–ª–∏—Ç—É –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–æ–≥–æ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞

**–§–∞–π–ª:** `backend/src/shared/utils/unified-cities-loader.ts` (–ù–û–í–´–ô)

```typescript
import fs from 'fs';
import path from 'path';
import { normalizeCityName } from './city-normalizer';
import { loadYakutiaCitiesReference, type YakutiaCity } from './yakutia-cities-loader';

export interface UnifiedCity {
  name: string;
  normalizedName: string;
  latitude: number;
  longitude: number;
  region: string;
  isKeyCity: boolean;
  isFederalCity: boolean;
  airports?: string[];
}

let unifiedCitiesCache: Map<string, UnifiedCity> | null = null;

export function loadUnifiedCitiesReference(): Map<string, UnifiedCity> {
  if (unifiedCitiesCache) {
    return unifiedCitiesCache;
  }
  
  const citiesMap = new Map<string, UnifiedCity>();
  
  // –ó–∞–≥—Ä—É–∂–∞–µ–º –≥–æ—Ä–æ–¥–∞ –Ø–∫—É—Ç–∏–∏
  const yakutiaCities = loadYakutiaCitiesReference();
  for (const [normalizedName, city] of yakutiaCities.entries()) {
    citiesMap.set(normalizedName, {
      name: city.name,
      normalizedName: city.normalizedName,
      latitude: city.latitude,
      longitude: city.longitude,
      region: 'Yakutia',
      isKeyCity: city.isKeyCity,
      isFederalCity: false
    });
  }
  
  // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–µ –≥–æ—Ä–æ–¥–∞
  const federalCitiesPath = path.join(
    __dirname,
    '../../../data/reference/russia-federal-cities-reference.json'
  );
  
  if (fs.existsSync(federalCitiesPath)) {
    const fileContent = fs.readFileSync(federalCitiesPath, 'utf-8');
    const reference = JSON.parse(fileContent);
    
    for (const city of reference.cities) {
      const normalizedKey = normalizeCityName(city.normalizedName || city.name);
      citiesMap.set(normalizedKey, {
        name: city.name,
        normalizedName: city.normalizedName || normalizeCityName(city.name),
        latitude: city.latitude,
        longitude: city.longitude,
        region: city.region,
        isKeyCity: city.isKeyCity ?? true,
        isFederalCity: city.isFederalCity ?? true,
        airports: city.airports
      });
    }
  }
  
  unifiedCitiesCache = citiesMap;
  return citiesMap;
}

export function getUnifiedCity(cityName: string): UnifiedCity | undefined {
  const citiesMap = loadUnifiedCitiesReference();
  const normalized = normalizeCityName(cityName);
  return citiesMap.get(normalized);
}

export function isCityInUnifiedReference(cityName: string): boolean {
  return getUnifiedCity(cityName) !== undefined;
}

export function getAllFederalCities(): UnifiedCity[] {
  const citiesMap = loadUnifiedCitiesReference();
  return Array.from(citiesMap.values()).filter(city => city.isFederalCity);
}

export function getAllYakutiaCities(): UnifiedCity[] {
  const citiesMap = loadUnifiedCitiesReference();
  return Array.from(citiesMap.values()).filter(city => !city.isFederalCity);
}
```

---

## 3. –ü–ª–∞–Ω –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –≥–æ—Ä–æ–¥–æ–≤ —Ç–∞–∫, —á—Ç–æ–±—ã –æ–Ω–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–ª–∏

### 3.1 –ú–æ—Å–∫–≤–∞, –°–ü–±, –ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫, –ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫, –ò—Ä–∫—É—Ç—Å–∫, –í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫, –•–∞–±–∞—Ä–æ–≤—Å–∫ –∏ –¥—Ä.

**–ì–æ—Ä–æ–¥–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:**
- –ú–æ—Å–∫–≤–∞, –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥, –ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫, –ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫, –ò—Ä–∫—É—Ç—Å–∫, –•–∞–±–∞—Ä–æ–≤—Å–∫, –í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫, –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥, –ö–∞–∑–∞–Ω—å, –ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥

**–í—Å–µ –æ–Ω–∏ —É–∂–µ –≤–∫–ª—é—á–µ–Ω—ã –≤ `russia-federal-cities-reference.json` (—Å–º. —Ä–∞–∑–¥–µ–ª 2.4)**

### 3.2 –ö–∞–∫ –≤—Å—Ç—Ä–æ–∏—Ç—å –∏—Ö –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–∞–π–ø–ª–∞–π–Ω

#### –®–∞–≥ 1: –û–±–Ω–æ–≤–∏—Ç—å `VirtualEntitiesGeneratorWorker`

**–§–∞–π–ª:** `backend/src/application/workers/VirtualEntitiesGeneratorWorker.ts` (–û–ë–ù–û–í–ò–¢–¨)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

1. **–ò–º–ø–æ—Ä—Ç—ã (—Å—Ç—Ä–æ–∫–∏ 27-33):**
```typescript
// –ó–ê–ú–ï–ù–ò–¢–¨:
import {
  getAllYakutiaCities,
  getYakutiaCity,
  isYakutiaCity,
  type YakutiaCity,
} from '../../shared/utils/yakutia-cities-loader';

// –ù–ê:
import {
  getAllYakutiaCities,
  getAllFederalCities,
  getUnifiedCity,
  isCityInUnifiedReference,
  type UnifiedCity,
} from '../../shared/utils/unified-cities-loader';
```

2. **–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä (—Å—Ç—Ä–æ–∫–∏ 55-63):**
```typescript
constructor(
  private readonly stopRepository: IStopRepository,
  private readonly routeRepository: IRouteRepository,
  private readonly flightRepository: IFlightRepository,
  private readonly datasetRepository: IDatasetRepository,
  // –£–î–ê–õ–ò–¢–¨: private readonly citiesDirectory: CityCoordinates
) {
  super('virtual-entities-generator', 'Virtual Entities Generator Worker', '1.0.0');
}
```

3. **–ú–µ—Ç–æ–¥ `generateVirtualStops()` (—Å—Ç—Ä–æ–∫–∏ ~100-200):**
```typescript
private async generateVirtualStops(): Promise<VirtualStop[]> {
  const virtualStops: VirtualStop[] = [];
  
  // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –≥–æ—Ä–æ–¥–∞ (–Ø–∫—É—Ç–∏—è + —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–µ)
  const yakutiaCities = getAllYakutiaCities();
  const federalCities = getAllFederalCities();
  const allCities = [...yakutiaCities, ...federalCities];
  
  // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Ä–µ–∞–ª—å–Ω—ã–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏–∑ –ë–î
  const realStops = await this.stopRepository.getAllRealStops();
  const realCitiesSet = new Set(
    realStops
      .map(stop => stop.cityId)
      .filter(cityId => cityId)
      .map(cityId => normalizeCityName(cityId!))
  );
  
  // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –≥–æ—Ä–æ–¥–æ–≤ –±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –æ—Å—Ç–∞–Ω–æ–≤–æ–∫
  for (const city of allCities) {
    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º, –µ—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å —Ä–µ–∞–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞
    if (realCitiesSet.has(city.normalizedName)) {
      continue;
    }
    
    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –¥–ª—è –∫–ª—é—á–µ–≤—ã—Ö –≥–æ—Ä–æ–¥–æ–≤
    if (!city.isKeyCity) {
      continue;
    }
    
    const virtualStop = new VirtualStop(
      generateVirtualStopId(city.name),
      city.name,
      city.latitude,
      city.longitude,
      city.name, // cityId
      false, // isAirport
      false, // isRailwayStation
      { cityName: city.name, _virtual: true }
    );
    
    virtualStops.push(virtualStop);
  }
  
  return virtualStops;
}
```

4. **–ú–µ—Ç–æ–¥ `ensureYakutiaCitiesConnectivity()` ‚Üí –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –≤ `ensureCitiesConnectivity()` (—Å—Ç—Ä–æ–∫–∏ 499-600):**
```typescript
private async ensureCitiesConnectivity(): Promise<VirtualRoute[]> {
  const virtualRoutes: VirtualRoute[] = [];
  
  const yakutiaCities = getAllYakutiaCities();
  const federalCities = getAllFederalCities();
  const hubCity = getUnifiedCity(this.hubCityName); // "–Ø–∫—É—Ç—Å–∫"
  
  if (!hubCity) {
    this.log('ERROR', `Hub city "${this.hubCityName}" not found in unified reference`);
    return virtualRoutes;
  }
  
  // –ü–ê–†–´: —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –≥–æ—Ä–æ–¥ ‚Üí –≥–æ—Ä–æ–¥ –Ø–∫—É—Ç–∏–∏
  for (const federalCity of federalCities) {
    for (const yakutiaCity of yakutiaCities) {
      // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º, –µ—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç
      const routeExists = await this.checkRouteExists(
        generateVirtualStopId(federalCity.name),
        generateVirtualStopId(yakutiaCity.name)
      );
      
      if (routeExists) {
        continue;
      }
      
      // –°–æ–∑–¥–∞–µ–º hub-based –º–∞—Ä—à—Ä—É—Ç: —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –≥–æ—Ä–æ–¥ ‚Üí –Ø–∫—É—Ç—Å–∫ ‚Üí –≥–æ—Ä–æ–¥ –Ø–∫—É—Ç–∏–∏
      if (yakutiaCity.name !== hubCity.name) {
        // –ú–∞—Ä—à—Ä—É—Ç 1: —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –≥–æ—Ä–æ–¥ ‚Üí –Ø–∫—É—Ç—Å–∫ (air)
        const route1 = new VirtualRoute(
          generateVirtualRouteId(
            generateVirtualStopId(federalCity.name),
            generateVirtualStopId(hubCity.name)
          ),
          generateVirtualStopId(federalCity.name),
          generateVirtualStopId(hubCity.name),
          'PLANE', // air transport
          240, // 4 hours
          2000, // ~2000 km
          { _virtual: true, hubBased: true }
        );
        
        // –ú–∞—Ä—à—Ä—É—Ç 2: –Ø–∫—É—Ç—Å–∫ ‚Üí –≥–æ—Ä–æ–¥ –Ø–∫—É—Ç–∏–∏ (ground)
        const route2 = new VirtualRoute(
          generateVirtualRouteId(
            generateVirtualStopId(hubCity.name),
            generateVirtualStopId(yakutiaCity.name)
          ),
          generateVirtualStopId(hubCity.name),
          generateVirtualStopId(yakutiaCity.name),
          'BUS', // ground transport
          180, // 3 hours
          200, // ~200 km
          { _virtual: true, hubBased: true }
        );
        
        virtualRoutes.push(route1, route2);
      } else {
        // –ü—Ä—è–º–æ–π –º–∞—Ä—à—Ä—É—Ç: —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –≥–æ—Ä–æ–¥ ‚Üí –Ø–∫—É—Ç—Å–∫ (air)
        const route = new VirtualRoute(
          generateVirtualRouteId(
            generateVirtualStopId(federalCity.name),
            generateVirtualStopId(hubCity.name)
          ),
          generateVirtualStopId(federalCity.name),
          generateVirtualStopId(hubCity.name),
          'PLANE',
          240,
          2000,
          { _virtual: true }
        );
        
        virtualRoutes.push(route);
      }
    }
  }
  
  // –ü–ê–†–´: —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –≥–æ—Ä–æ–¥ ‚Üí —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –≥–æ—Ä–æ–¥ (–ø—Ä—è–º—ã–µ –∞–≤–∏–∞–º–∞—Ä—à—Ä—É—Ç—ã)
  for (let i = 0; i < federalCities.length; i++) {
    for (let j = i + 1; j < federalCities.length; j++) {
      const city1 = federalCities[i];
      const city2 = federalCities[j];
      
      const routeExists = await this.checkRouteExists(
        generateVirtualStopId(city1.name),
        generateVirtualStopId(city2.name)
      );
      
      if (routeExists) {
        continue;
      }
      
      // –ü—Ä—è–º–æ–π –∞–≤–∏–∞–º–∞—Ä—à—Ä—É—Ç
      const route = new VirtualRoute(
        generateVirtualRouteId(
          generateVirtualStopId(city1.name),
          generateVirtualStopId(city2.name)
        ),
        generateVirtualStopId(city1.name),
        generateVirtualStopId(city2.name),
        'PLANE',
        180, // 3 hours
        1500, // ~1500 km
        { _virtual: true }
      );
      
      virtualRoutes.push(route);
    }
  }
  
  // –ü–ê–†–´: –≥–æ—Ä–æ–¥ –Ø–∫—É—Ç–∏–∏ ‚Üí –≥–æ—Ä–æ–¥ –Ø–∫—É—Ç–∏–∏ (—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ª–æ–≥–∏–∫–∞)
  // ... (–æ—Å—Ç–∞–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥)
  
  return virtualRoutes;
}
```

### 3.3 –ö–∞–∫ –æ–±–µ—Å–ø–µ—á–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã

#### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å `AirRouteGeneratorWorker`

**–§–∞–π–ª:** `backend/src/application/workers/AirRouteGeneratorWorker.ts` (–ù–û–í–´–ô)

```typescript
import { BaseBackgroundWorker } from './base/BaseBackgroundWorker';
import type { WorkerExecutionResult } from './base/IBackgroundWorker';
import type { IRouteRepository } from '../../domain/repositories/IRouteRepository';
import type { IFlightRepository } from '../../domain/repositories/IFlightRepository';
import type { IDatasetRepository } from '../../domain/repositories/IDatasetRepository';
import { Route } from '../../domain/entities/Route';
import { Flight } from '../../domain/entities/Flight';
import { getAllFederalCities, getUnifiedCity } from '../../shared/utils/unified-cities-loader';
import { generateVirtualStopId } from '../../shared/utils/city-normalizer';

export class AirRouteGeneratorWorker extends BaseBackgroundWorker {
  private hubCityName: string = '–Ø–∫—É—Ç—Å–∫';

  constructor(
    private readonly routeRepository: IRouteRepository,
    private readonly flightRepository: IFlightRepository,
    private readonly datasetRepository: IDatasetRepository
  ) {
    super('air-route-generator', 'Air Route Generator Worker', '1.0.0');
  }

  public async canRun(): Promise<boolean> {
    // –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ ODataSyncWorker, –ø–µ—Ä–µ–¥ VirtualEntitiesGeneratorWorker
    const latestDataset = await this.datasetRepository.getLatestDataset();
    return latestDataset !== null;
  }

  protected async executeWorkerLogic(): Promise<WorkerExecutionResult> {
    const startTime = Date.now();

    try {
      const federalCities = getAllFederalCities();
      const hubCity = getUnifiedCity(this.hubCityName);

      if (!hubCity) {
        throw new Error(`Hub city "${this.hubCityName}" not found`);
      }

      const generatedRoutes: Route[] = [];
      const generatedFlights: Flight[] = [];

      // –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω–æ–≥–æ –≥–æ—Ä–æ–¥–∞ —Å–æ–∑–¥–∞–µ–º –∞–≤–∏–∞–º–∞—Ä—à—Ä—É—Ç –≤ –Ø–∫—É—Ç—Å–∫
      for (const federalCity of federalCities) {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Ä–µ–∞–ª—å–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç
        const existingRoutes = await this.routeRepository.findRoutesByStops(
          generateVirtualStopId(federalCity.name),
          generateVirtualStopId(hubCity.name)
        );

        if (existingRoutes.length > 0) {
          this.log('INFO', `Route ${federalCity.name} ‚Üí ${hubCity.name} already exists, skipping`);
          continue;
        }

        // –°–æ–∑–¥–∞–µ–º –º–∞—Ä—à—Ä—É—Ç
        const route = new Route(
          `air-route-${federalCity.normalizedName}-${hubCity.normalizedName}`,
          generateVirtualStopId(federalCity.name),
          generateVirtualStopId(hubCity.name),
          [
            { stopId: generateVirtualStopId(federalCity.name), order: 1 },
            { stopId: generateVirtualStopId(hubCity.name), order: 2 }
          ],
          'PLANE',
          240, // 4 hours
          2000, // ~2000 km
          15000 // base fare
        );

        generatedRoutes.push(route);

        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ä–µ–π—Å—ã (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ, 2-3 —Ä–µ–π—Å–∞ –≤ –¥–µ–Ω—å)
        const flightTimes = ['08:00', '14:00', '20:00'];
        for (const time of flightTimes) {
          const flight = new Flight(
            `flight-${route.id}-${time.replace(':', '')}`,
            route.id,
            time,
            240, // duration
            15000 // fare
          );
          generatedFlights.push(flight);
        }
      }

      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –º–∞—Ä—à—Ä—É—Ç—ã –∏ —Ä–µ–π—Å—ã
      for (const route of generatedRoutes) {
        await this.routeRepository.save(route);
      }

      for (const flight of generatedFlights) {
        await this.flightRepository.save(flight);
      }

      const executionTime = Date.now() - startTime;

      return {
        success: true,
        message: `Generated ${generatedRoutes.length} air routes and ${generatedFlights.length} flights`,
        executionTimeMs: executionTime,
        metadata: {
          routesGenerated: generatedRoutes.length,
          flightsGenerated: generatedFlights.length
        }
      };
    } catch (error) {
      return {
        success: false,
        message: `Error generating air routes: ${error instanceof Error ? error.message : String(error)}`,
        executionTimeMs: Date.now() - startTime
      };
    }
  }
}
```

#### –®–∞–≥ 2: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ –ø–∞–π–ø–ª–∞–π–Ω –≤–æ—Ä–∫–µ—Ä–æ–≤

**–§–∞–π–ª:** `backend/src/infrastructure/workers/initializeWorkers.ts` (–û–ë–ù–û–í–ò–¢–¨)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```typescript
import { AirRouteGeneratorWorker } from '../../application/workers/AirRouteGeneratorWorker';

// –í —Ñ—É–Ω–∫—Ü–∏–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–æ—Ä–∫–µ—Ä–æ–≤:
const airRouteGeneratorWorker = new AirRouteGeneratorWorker(
  routeRepository,
  flightRepository,
  datasetRepository
);

// –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
// 1. ODataSyncWorker
// 2. AirRouteGeneratorWorker (–ù–û–í–´–ô)
// 3. VirtualEntitiesGeneratorWorker
// 4. GraphBuilderWorker
```

---

## 4. –ü–ª–∞–Ω –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Å–º–µ—à–∞–Ω–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤

### 4.1 –°–∞–º–æ–ª—ë—Ç ‚Üí –ø–µ—Ä–µ–ø—Ä–∞–≤–∞ ‚Üí –∞–≤—Ç–æ–±—É—Å

**–ü—Ä–∏–º–µ—Ä:** –ú–æ—Å–∫–≤–∞ ‚Üí –Ø–∫—É—Ç—Å–∫ ‚Üí –ù–∏–∂–Ω–∏–π –ë–µ—Å—Ç—è—Ö ‚Üí –ß—É—Ä–∞–ø—á–∞

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
1. –†—ë–±—Ä–∞ –ø–µ—Ä–µ—Å–∞–¥–∫–∏ –º–µ–∂–¥—É –æ—Å—Ç–∞–Ω–æ–≤–∫–∞–º–∏ –≤ –æ–¥–Ω–æ–º –≥–æ—Ä–æ–¥–µ
2. Ferry-–º–∞—Ä—à—Ä—É—Ç—ã (–Ø–∫—É—Ç—Å–∫ ‚Üî –ù–∏–∂–Ω–∏–π –ë–µ—Å—Ç—è—Ö)
3. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤–µ—Å–∞ –¥–ª—è –ø–µ—Ä–µ—Å–∞–¥–æ–∫

### 4.2 –°–∞–º–æ–ª—ë—Ç ‚Üí –∞–≤—Ç–æ–±—É—Å

**–ü—Ä–∏–º–µ—Ä:** –ú–æ—Å–∫–≤–∞ ‚Üí –Ø–∫—É—Ç—Å–∫ ‚Üí –ß—É—Ä–∞–ø—á–∞

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
1. –†—ë–±—Ä–∞ –ø–µ—Ä–µ—Å–∞–¥–∫–∏: –ê—ç—Ä–æ–ø–æ—Ä—Ç –Ø–∫—É—Ç—Å–∫ ‚Üí –ê–≤—Ç–æ—Å—Ç–∞–Ω—Ü–∏—è –Ø–∫—É—Ç—Å–∫
2. –í–µ—Å –ø–µ—Ä–µ—Å–∞–¥–∫–∏: 90 –º–∏–Ω—É—Ç (air ‚Üí ground)

### 4.3 –ü–µ—Ä–µ—Å–∞–¥–∫–∏ —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ –≤–µ—Å–∞–º–∏

**–õ–æ–≥–∏–∫–∞ –≤–µ—Å–æ–≤ –ø–µ—Ä–µ—Å–∞–¥–∫–∏:**
- **Air ‚Üí Ground:** 90 –º–∏–Ω—É—Ç (–ø–æ–ª—É—á–µ–Ω–∏–µ –±–∞–≥–∞–∂–∞, –ø–µ—Ä–µ—Ö–æ–¥ –∏–∑ –∞—ç—Ä–æ–ø–æ—Ä—Ç–∞ –≤ –≥–æ—Ä–æ–¥)
- **Ground ‚Üí Air:** 120 –º–∏–Ω—É—Ç (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –¥–æ—Å–º–æ—Ç—Ä)
- **Ground ‚Üí Ground:** 60 –º–∏–Ω—É—Ç (–ø–µ—Ä–µ—Å–∞–¥–∫–∞ –Ω–∞ –∞–≤—Ç–æ–±—É—Å/—Ç–∞–∫—Å–∏)
- **Air ‚Üí Ferry:** 90 –º–∏–Ω—É—Ç (–ø–µ—Ä–µ—Ö–æ–¥ –∏–∑ –∞—ç—Ä–æ–ø–æ—Ä—Ç–∞ –Ω–∞ –ø—Ä–∏—Å—Ç–∞–Ω—å)
- **Ferry ‚Üí Ground:** 30 –º–∏–Ω—É—Ç (–±—ã—Å—Ç—Ä–∞—è –ø–µ—Ä–µ—Å–∞–¥–∫–∞ —Å –ø–∞—Ä–æ–º–∞)

### 4.4 –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã

**–ü—Ä–∏–º–µ—Ä—ã:**
- –ú–æ—Å–∫–≤–∞ ‚Üí –Ø–∫—É—Ç—Å–∫ ‚Üí –ù. –ë–µ—Å—Ç—è—Ö ‚Üí –ß—É—Ä–∞–ø—á–∞
- –ú–æ—Å–∫–≤–∞ ‚Üí –ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫ ‚Üí –Ø–∫—É—Ç—Å–∫ ‚Üí –û–ª—ë–∫–º–∏–Ω—Å–∫

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
1. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–≥–æ—Å–µ–≥–º–µ–Ω—Ç–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤
2. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤–µ—Å–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞
3. –£—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –ø–µ—Ä–µ—Å–∞–¥–∫–∏

---

## 5. –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–µ–ø—Ä–∞–≤—ã –Ø–∫—É—Ç—Å–∫‚Äî–ù–∏–∂–Ω–∏–π –ë–µ—Å—Ç—è—Ö

### 5.1 –ù–æ–≤—ã–µ —Ç–∏–ø—ã –æ—Å—Ç–∞–Ω–æ–≤–æ–∫

**–§–∞–π–ª:** `backend/data/mock/stops.json` (–û–ë–ù–û–í–ò–¢–¨)

**–î–æ–±–∞–≤–∏—Ç—å:**
```json
{
  "id": "stop-027",
  "name": "–ü–∞—Ä–æ–º–Ω–∞—è –ø–µ—Ä–µ–ø—Ä–∞–≤–∞ –ù–∏–∂–Ω–∏–π –ë–µ—Å—Ç—è—Ö",
  "coordinates": {
    "latitude": 61.9500,
    "longitude": 129.6000
  },
  "type": "ferry_terminal",
  "cityId": "—è–∫—É—Ç—Å–∫"
},
{
  "id": "stop-028",
  "name": "–ü—Ä–∏—Å—Ç–∞–Ω—å –Ø–∫—É—Ç—Å–∫",
  "coordinates": {
    "latitude": 62.0278,
    "longitude": 129.7042
  },
  "type": "ferry_terminal",
  "cityId": "—è–∫—É—Ç—Å–∫"
}
```

### 5.2 Ferry-–º–∞—Ä—à—Ä—É—Ç—ã

**–§–∞–π–ª:** `backend/data/mock/routes.json` (–û–ë–ù–û–í–ò–¢–¨)

**–î–æ–±–∞–≤–∏—Ç—å:**
```json
{
  "id": "route-032",
  "name": "–Ø–∫—É—Ç—Å–∫ - –ù–∏–∂–Ω–∏–π –ë–µ—Å—Ç—è—Ö (–ü–∞—Ä–æ–º)",
  "routeNumber": "FERRY-001",
  "transportType": "FERRY",
  "stops": ["stop-028", "stop-027"],
  "baseFare": 500,
  "distance": 15,
  "duration": 20,
  "metadata": {
    "ferrySchedule": {
      "summer": {
        "start": "06:00",
        "end": "23:00",
        "frequency": 30
      },
      "winter": {
        "start": "07:00",
        "end": "22:00",
        "frequency": 45
      }
    }
  }
},
{
  "id": "route-033",
  "name": "–ù–∏–∂–Ω–∏–π –ë–µ—Å—Ç—è—Ö - –Ø–∫—É—Ç—Å–∫ (–ü–∞—Ä–æ–º)",
  "routeNumber": "FERRY-002",
  "transportType": "FERRY",
  "stops": ["stop-027", "stop-028"],
  "baseFare": 500,
  "distance": 15,
  "duration": 20,
  "metadata": {
    "ferrySchedule": {
      "summer": {
        "start": "06:00",
        "end": "23:00",
        "frequency": 30
      },
      "winter": {
        "start": "07:00",
        "end": "22:00",
        "frequency": 45
      }
    }
  }
}
```

### 5.3 –õ–æ–≥–∏–∫–∞ —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç–∏

**–†–∞—Å—á–µ—Ç –≤–µ—Å–∞ –ø–µ—Ä–µ–ø—Ä–∞–≤—ã:**
- **–õ–µ—Ç–æ–º:** 20 –º–∏–Ω—É—Ç (–ø–µ—Ä–µ–ø—Ä–∞–≤–∞) + 15-20 –º–∏–Ω—É—Ç (–æ–∂–∏–¥–∞–Ω–∏–µ) = **35-40 –º–∏–Ω—É—Ç**
- **–ó–∏–º–æ–π:** 20 –º–∏–Ω—É—Ç (–ø–µ—Ä–µ–ø—Ä–∞–≤–∞) + 30-45 –º–∏–Ω—É—Ç (–æ–∂–∏–¥–∞–Ω–∏–µ) = **50-65 –º–∏–Ω—É—Ç**

### 5.4 –í–µ—Å –ø–µ—Ä–µ–ø—Ä–∞–≤—ã –∏ –ø–µ—Ä–µ—Å–∞–¥–æ–∫

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ `GraphBuilderWorker` (—Å–º. —Ä–∞–∑–¥–µ–ª 6)**

---

## 6. –ü–ª–∞–Ω –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é —Ä–∞–±–æ—Ç—ã GraphBuilderWorker

### 6.1 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ—Å–∞–¥–æ–∫ –º–µ–∂–¥—É —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞–º–∏

**–§–∞–π–ª:** `backend/src/application/workers/GraphBuilderWorker.ts` (–û–ë–ù–û–í–ò–¢–¨)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –º–µ—Ç–æ–¥–µ `buildGraphStructure()` (—Å—Ç—Ä–æ–∫–∏ ~130-300):**

```typescript
private buildGraphStructure(
  stops: Array<RealStop | VirtualStop>,
  routes: Array<Route | VirtualRoute>,
  flights: Flight[]
): { nodes: GraphNode[]; edges: GraphNeighbor[] } {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ —Å–æ–∑–¥–∞–Ω–∏—è —É–∑–ª–æ–≤ ...
  
  // –®–ê–ì 1: –°–æ–∑–¥–∞–µ–º —Ä—ë–±—Ä–∞ –∏–∑ –º–∞—Ä—à—Ä—É—Ç–æ–≤
  const edges: GraphNeighbor[] = [];
  
  for (const route of routes) {
    // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ —Å–æ–∑–¥–∞–Ω–∏—è —Ä—ë–±–µ—Ä –∏–∑ –º–∞—Ä—à—Ä—É—Ç–æ–≤ ...
  }
  
  // –®–ê–ì 2: –°–æ–∑–¥–∞–µ–º —Ä—ë–±—Ä–∞ –ø–µ—Ä–µ—Å–∞–¥–∫–∏ –º–µ–∂–¥—É –æ—Å—Ç–∞–Ω–æ–≤–∫–∞–º–∏ –≤ –æ–¥–Ω–æ–º –≥–æ—Ä–æ–¥–µ
  const stopsByCity = new Map<string, Array<RealStop | VirtualStop>>();
  
  for (const stop of stops) {
    const cityId = stop.cityId || extractCityFromStopName(stop.name);
    if (!cityId) continue;
    
    const normalizedCity = normalizeCityName(cityId);
    if (!stopsByCity.has(normalizedCity)) {
      stopsByCity.set(normalizedCity, []);
    }
    stopsByCity.get(normalizedCity)!.push(stop);
  }
  
  // –î–ª—è –∫–∞–∂–¥–æ–≥–æ –≥–æ—Ä–æ–¥–∞ —Å–æ–∑–¥–∞–µ–º —Ä—ë–±—Ä–∞ –ø–µ—Ä–µ—Å–∞–¥–∫–∏ –º–µ–∂–¥—É –æ—Å—Ç–∞–Ω–æ–≤–∫–∞–º–∏
  for (const [city, cityStops] of stopsByCity.entries()) {
    if (cityStops.length < 2) continue;
    
    // –°–æ–∑–¥–∞–µ–º —Ä—ë–±—Ä–∞ –ø–µ—Ä–µ—Å–∞–¥–∫–∏ –º–µ–∂–¥—É –≤—Å–µ–º–∏ –ø–∞—Ä–∞–º–∏ –æ—Å—Ç–∞–Ω–æ–≤–æ–∫ –≤ –≥–æ—Ä–æ–¥–µ
    for (let i = 0; i < cityStops.length; i++) {
      for (let j = i + 1; j < cityStops.length; j++) {
        const stop1 = cityStops[i];
        const stop2 = cityStops[j];
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –ø–µ—Ä–µ—Å–∞–¥–∫–∏ –∏ –≤–µ—Å
        const transferWeight = this.calculateTransferWeight(stop1, stop2);
        
        // –°–æ–∑–¥–∞–µ–º –¥–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ä—ë–±—Ä–∞ –ø–µ—Ä–µ—Å–∞–¥–∫–∏
        edges.push({
          fromStopId: stop1.id,
          toStopId: stop2.id,
          weight: transferWeight,
          transportType: 'TRANSFER',
          routeId: `transfer-${stop1.id}-${stop2.id}`
        });
        
        edges.push({
          fromStopId: stop2.id,
          toStopId: stop1.id,
          weight: transferWeight,
          transportType: 'TRANSFER',
          routeId: `transfer-${stop2.id}-${stop1.id}`
        });
      }
    }
  }
  
  return { nodes, edges };
}

/**
 * –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –≤–µ—Å –ø–µ—Ä–µ—Å–∞–¥–∫–∏ –º–µ–∂–¥—É –¥–≤—É–º—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞–º–∏
 */
private calculateTransferWeight(
  stop1: RealStop | VirtualStop,
  stop2: RealStop | VirtualStop
): number {
  const isStop1Airport = stop1.isAirport || stop1.name.toLowerCase().includes('–∞—ç—Ä–æ–ø–æ—Ä—Ç');
  const isStop2Airport = stop2.isAirport || stop2.name.toLowerCase().includes('–∞—ç—Ä–æ–ø–æ—Ä—Ç');
  const isStop1Ferry = stop1.name.toLowerCase().includes('–ø–µ—Ä–µ–ø—Ä–∞–≤–∞') || stop1.name.toLowerCase().includes('–ø—Ä–∏—Å—Ç–∞–Ω—å');
  const isStop2Ferry = stop2.name.toLowerCase().includes('–ø–µ—Ä–µ–ø—Ä–∞–≤–∞') || stop2.name.toLowerCase().includes('–ø—Ä–∏—Å—Ç–∞–Ω—å');
  const isStop1Ground = stop1.name.toLowerCase().includes('–∞–≤—Ç–æ—Å—Ç–∞–Ω—Ü–∏—è') || stop1.name.toLowerCase().includes('–≤–æ–∫–∑–∞–ª');
  const isStop2Ground = stop2.name.toLowerCase().includes('–∞–≤—Ç–æ—Å—Ç–∞–Ω—Ü–∏—è') || stop2.name.toLowerCase().includes('–≤–æ–∫–∑–∞–ª');
  
  // Air ‚Üí Ground: 90 –º–∏–Ω—É—Ç
  if (isStop1Airport && isStop2Ground) {
    return 90;
  }
  
  // Ground ‚Üí Air: 120 –º–∏–Ω—É—Ç
  if (isStop1Ground && isStop2Airport) {
    return 120;
  }
  
  // Air ‚Üí Ferry: 90 –º–∏–Ω—É—Ç
  if (isStop1Airport && isStop2Ferry) {
    return 90;
  }
  
  // Ferry ‚Üí Ground: 30 –º–∏–Ω—É—Ç
  if (isStop1Ferry && isStop2Ground) {
    return 30;
  }
  
  // Ground ‚Üí Ground: 60 –º–∏–Ω—É—Ç
  if (isStop1Ground && isStop2Ground) {
    return 60;
  }
  
  // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 60 –º–∏–Ω—É—Ç
  return 60;
}
```

### 6.2 –í–µ—Å –ø–µ—Ä–µ—Å–∞–¥–æ–∫ (—Ä–∞–∑–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏)

**–õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –≤–µ—Å–∞ –ø–µ—Ä–µ—Å–∞–¥–∫–∏:**

| –¢–∏–ø –ø–µ—Ä–µ—Å–∞–¥–∫–∏ | –í–µ—Å (–º–∏–Ω—É—Ç—ã) | –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ |
|---------------|--------------|-------------|
| Air ‚Üí Ground | 90 | –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–≥–∞–∂–∞, –ø–µ—Ä–µ—Ö–æ–¥ –∏–∑ –∞—ç—Ä–æ–ø–æ—Ä—Ç–∞ –≤ –≥–æ—Ä–æ–¥ |
| Ground ‚Üí Air | 120 | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –¥–æ—Å–º–æ—Ç—Ä, –ø–µ—Ä–µ—Ö–æ–¥ –≤ –∞—ç—Ä–æ–ø–æ—Ä—Ç |
| Ground ‚Üí Ground | 60 | –ü–µ—Ä–µ—Å–∞–¥–∫–∞ –Ω–∞ –∞–≤—Ç–æ–±—É—Å/—Ç–∞–∫—Å–∏ |
| Air ‚Üí Ferry | 90 | –ü–µ—Ä–µ—Ö–æ–¥ –∏–∑ –∞—ç—Ä–æ–ø–æ—Ä—Ç–∞ –Ω–∞ –ø—Ä–∏—Å—Ç–∞–Ω—å |
| Ferry ‚Üí Ground | 30 | –ë—ã—Å—Ç—Ä–∞—è –ø–µ—Ä–µ—Å–∞–¥–∫–∞ —Å –ø–∞—Ä–æ–º–∞ |
| Ferry ‚Üí Ferry | 20 | –ü–µ—Ä–µ—Å–∞–¥–∫–∞ –º–µ–∂–¥—É –ø–∞—Ä–æ–º–∞–º–∏ (—Ä–µ–¥–∫–æ) |

### 6.3 –í–∞–ª–∏–¥–∞—Ü–∏—è –≥—Ä–∞—Ñ–∞ (–æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å)

**–§–∞–π–ª:** `backend/src/shared/validators/graph-validator.ts` (–ù–û–í–´–ô)

```typescript
import type { GraphNode, GraphNeighbor } from '../../domain/repositories/IGraphRepository';

export interface GraphValidationResult {
  isValid: boolean;
  errors: string[];
  warnings: string[];
  stats: {
    totalNodes: number;
    totalEdges: number;
    isolatedNodes: number;
    invalidWeights: number;
    disconnectedComponents: number;
  };
}

export function validateGraphStructure(
  nodes: GraphNode[],
  edges: GraphNeighbor[]
): GraphValidationResult {
  const errors: string[] = [];
  const warnings: string[] = [];
  
  // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  const stats = {
    totalNodes: nodes.length,
    totalEdges: edges.length,
    isolatedNodes: 0,
    invalidWeights: 0,
    disconnectedComponents: 0
  };
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –í—Å–µ —Ä—ë–±—Ä–∞ –∏–º–µ—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤–µ—Å
  for (const edge of edges) {
    if (edge.weight <= 0 || isNaN(edge.weight) || !isFinite(edge.weight)) {
      errors.push(`Invalid edge weight: ${edge.weight} for edge ${edge.fromStopId} ‚Üí ${edge.toStopId}`);
      stats.invalidWeights++;
    }
  }
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –í—Å–µ —É–∑–ª—ã –∏–º–µ—é—Ç —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –≤—Ö–æ–¥—è—â–µ–µ –∏–ª–∏ –∏—Å—Ö–æ–¥—è—â–µ–µ —Ä–µ–±—Ä–æ
  const nodeIds = new Set(nodes.map(n => n.id));
  const connectedNodes = new Set<string>();
  
  for (const edge of edges) {
    connectedNodes.add(edge.fromStopId);
    connectedNodes.add(edge.toStopId);
  }
  
  for (const node of nodes) {
    if (!connectedNodes.has(node.id)) {
      warnings.push(`Isolated node: ${node.id} (${node.name})`);
      stats.isolatedNodes++;
    }
  }
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: –°–≤—è–∑–Ω–æ—Å—Ç—å –≥—Ä–∞—Ñ–∞ (BFS –æ—Ç hub-—É–∑–ª–∞ "–Ø–∫—É—Ç—Å–∫")
  const hubNode = nodes.find(n => 
    n.cityName && n.cityName.toLowerCase().includes('—è–∫—É—Ç—Å–∫')
  );
  
  if (hubNode) {
    const reachableNodes = bfsFromNode(hubNode.id, edges);
    if (reachableNodes.size < nodes.length * 0.8) {
      warnings.push(`Graph connectivity issue: only ${reachableNodes.size}/${nodes.length} nodes reachable from hub`);
      stats.disconnectedComponents = nodes.length - reachableNodes.size;
    }
  }
  
  return {
    isValid: errors.length === 0,
    errors,
    warnings,
    stats
  };
}

function bfsFromNode(startNodeId: string, edges: GraphNeighbor[]): Set<string> {
  const visited = new Set<string>();
  const queue = [startNodeId];
  visited.add(startNodeId);
  
  while (queue.length > 0) {
    const currentNodeId = queue.shift()!;
    
    for (const edge of edges) {
      if (edge.fromStopId === currentNodeId && !visited.has(edge.toStopId)) {
        visited.add(edge.toStopId);
        queue.push(edge.toStopId);
      }
    }
  }
  
  return visited;
}

export function validateTransferEdges(edges: GraphNeighbor[]): {
  isValid: boolean;
  errors: string[];
} {
  const errors: string[] = [];
  
  for (const edge of edges) {
    if (edge.transportType === 'TRANSFER') {
      // –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤–µ—Å –ø–µ—Ä–µ—Å–∞–¥–∫–∏ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ 30-120 –º–∏–Ω—É—Ç
      if (edge.weight < 30 || edge.weight > 120) {
        errors.push(`Invalid transfer weight: ${edge.weight} minutes (expected 30-120)`);
      }
    }
  }
  
  return {
    isValid: errors.length === 0,
    errors
  };
}

export function validateFerryEdges(edges: GraphNeighbor[]): {
  isValid: boolean;
  errors: string[];
} {
  const errors: string[] = [];
  
  for (const edge of edges) {
    if (edge.transportType === 'FERRY') {
      // –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤–µ—Å ferry-–º–∞—Ä—à—Ä—É—Ç–∞ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ 20-65 –º–∏–Ω—É—Ç
      if (edge.weight < 20 || edge.weight > 65) {
        errors.push(`Invalid ferry weight: ${edge.weight} minutes (expected 20-65)`);
      }
    }
  }
  
  return {
    isValid: errors.length === 0,
    errors
  };
}
```

### 6.4 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ GraphBuilderWorker

**–§–∞–π–ª:** `backend/src/application/workers/GraphBuilderWorker.ts` (–û–ë–ù–û–í–ò–¢–¨)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –º–µ—Ç–æ–¥–µ `executeWorkerLogic()` (–ø–æ—Å–ª–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∞):**

```typescript
import {
  validateGraphStructure,
  validateTransferEdges,
  validateFerryEdges
} from '../../shared/validators/graph-validator';

protected async executeWorkerLogic(): Promise<WorkerExecutionResult> {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∞ ...
  
  // –í–ê–õ–ò–î–ê–¶–ò–Ø –ì–†–ê–§–ê
  this.log('INFO', 'Validating graph structure...');
  
  const graphValidation = validateGraphStructure(nodes, edges);
  if (!graphValidation.isValid) {
    this.log('ERROR', `Graph validation failed: ${graphValidation.errors.join(', ')}`);
    // –ù–µ –ø—Ä–µ—Ä—ã–≤–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –Ω–æ –ª–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
  }
  
  if (graphValidation.warnings.length > 0) {
    this.log('WARN', `Graph validation warnings: ${graphValidation.warnings.join(', ')}`);
  }
  
  const transferValidation = validateTransferEdges(edges);
  if (!transferValidation.isValid) {
    this.log('WARN', `Transfer edges validation: ${transferValidation.errors.join(', ')}`);
  }
  
  const ferryValidation = validateFerryEdges(edges);
  if (!ferryValidation.isValid) {
    this.log('WARN', `Ferry edges validation: ${ferryValidation.errors.join(', ')}`);
  }
  
  // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≥—Ä–∞—Ñ–∞ ...
}
```

### 6.5 –û—Ç–ª–∞–¥–∫–∞ –≥—Ä–∞—Ñ–∞ –¥–ª—è —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤

**–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `GraphBuilderWorker`:**
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–∑–ª–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω–æ–≥–æ –≥–æ—Ä–æ–¥–∞
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—ë–±–µ—Ä, —Å–≤—è–∑—ã–≤–∞—é—â–∏—Ö —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ —Å –Ø–∫—É—Ç–∏–µ–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–Ω–æ—Å—Ç–∏ —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ —Å hub-—É–∑–ª–æ–º (–Ø–∫—É—Ç—Å–∫)

---

## 7. –ß—ë—Ç–∫–∏–π —Å–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ —Ñ–∞–π–ª–∞–º

### 7.1 –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|------|------------|-----------|
| `backend/data/reference/airports-reference.json` | –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∞—ç—Ä–æ–ø–æ—Ä—Ç–æ–≤ | üî¥ –ö–†–ò–¢–ò–ß–ù–û |
| `backend/data/reference/suburbs-reference.json` | –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ø—Ä–∏–≥–æ—Ä–æ–¥–æ–≤ | üî¥ –ö–†–ò–¢–ò–ß–ù–û |
| `backend/data/reference/russia-federal-cities-reference.json` | –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ | üü† –í–´–°–û–ö–ò–ô |
| `backend/src/shared/utils/airports-loader.ts` | –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –∞—ç—Ä–æ–ø–æ—Ä—Ç–æ–≤ | üî¥ –ö–†–ò–¢–ò–ß–ù–û |
| `backend/src/shared/utils/suburbs-loader.ts` | –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –ø—Ä–∏–≥–æ—Ä–æ–¥–æ–≤ | üî¥ –ö–†–ò–¢–ò–ß–ù–û |
| `backend/src/shared/utils/unified-cities-loader.ts` | –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–æ–≥–æ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ | üü† –í–´–°–û–ö–ò–ô |
| `backend/src/shared/validators/stop-validator.ts` | –í–∞–ª–∏–¥–∞—Ü–∏—è –æ—Å—Ç–∞–Ω–æ–≤–æ–∫ | üî¥ –ö–†–ò–¢–ò–ß–ù–û |
| `backend/src/shared/validators/graph-validator.ts` | –í–∞–ª–∏–¥–∞—Ü–∏—è –≥—Ä–∞—Ñ–∞ | üü° –°–†–ï–î–ù–ò–ô |
| `backend/src/application/workers/AirRouteGeneratorWorker.ts` | –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∞–≤–∏–∞–º–∞—Ä—à—Ä—É—Ç–æ–≤ | üü† –í–´–°–û–ö–ò–ô |

### 7.2 –§–∞–π–ª—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

| –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏—è | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|------|-----------|-----------|
| `backend/src/shared/utils/city-normalizer.ts` | –ò—Å–ø—Ä–∞–≤–∏—Ç—å `extractCityFromStopName()` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞—ç—Ä–æ–ø–æ—Ä—Ç–æ–≤ | üî¥ –ö–†–ò–¢–ò–ß–ù–û |
| `backend/src/application/workers/ODataSyncWorker.ts` | –î–æ–±–∞–≤–∏—Ç—å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤ `parseODataResponse()` | üî¥ –ö–†–ò–¢–ò–ß–ù–û |
| `backend/src/application/workers/VirtualEntitiesGeneratorWorker.ts` | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `unified-cities-loader`, –æ–±–Ω–æ–≤–∏—Ç—å `ensureCitiesConnectivity()` | üü† –í–´–°–û–ö–ò–ô |
| `backend/src/application/workers/GraphBuilderWorker.ts` | –î–æ–±–∞–≤–∏—Ç—å —Ä—ë–±—Ä–∞ –ø–µ—Ä–µ—Å–∞–¥–∫–∏, –≤–∞–ª–∏–¥–∞—Ü–∏—é –≥—Ä–∞—Ñ–∞ | üü° –°–†–ï–î–ù–ò–ô |
| `backend/src/application/route-builder/RouteGraphBuilder.ts` | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ ferry-–º–∞—Ä—à—Ä—É—Ç–æ–≤, –ø–µ—Ä–µ—Å–∞–¥–æ–∫ | üü° –°–†–ï–î–ù–ò–ô |
| `backend/data/mock/stops.json` | –î–æ–±–∞–≤–∏—Ç—å –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–ª—è –ø–µ—Ä–µ–ø—Ä–∞–≤—ã –∏ —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ | üü† –í–´–°–û–ö–ò–ô |
| `backend/data/mock/routes.json` | –î–æ–±–∞–≤–∏—Ç—å ferry-–º–∞—Ä—à—Ä—É—Ç—ã –∏ –∞–≤–∏–∞–º–∞—Ä—à—Ä—É—Ç—ã –∏–∑ —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ | üü† –í–´–°–û–ö–ò–ô |
| `backend/data/mock/flights.json` | –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–π—Å—ã –¥–ª—è –Ω–æ–≤—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤ | üü† –í–´–°–û–ö–ò–ô |
| `backend/src/infrastructure/workers/initializeWorkers.ts` | –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å `AirRouteGeneratorWorker` | üü† –í–´–°–û–ö–ò–ô |

### 7.3 –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–∏—è

| –§—É–Ω–∫—Ü–∏—è | –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏—è |
|---------|------|-----------|
| `extractCityFromStopName()` | `city-normalizer.ts` | –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–∞—Ç—Ç–µ—Ä–Ω–∞ "–ê—ç—Ä–æ–ø–æ—Ä—Ç [–ì–æ—Ä–æ–¥] ([–ê—ç—Ä–æ–ø–æ—Ä—Ç])" |
| `parseODataResponse()` | `ODataSyncWorker.ts` | –î–æ–±–∞–≤–∏—Ç—å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏, –≤–∞–ª–∏–¥–∞—Ü–∏—é |
| `generateVirtualStops()` | `VirtualEntitiesGeneratorWorker.ts` | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫, –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ |
| `ensureYakutiaCitiesConnectivity()` | `VirtualEntitiesGeneratorWorker.ts` | –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –≤ `ensureCitiesConnectivity()`, –¥–æ–±–∞–≤–∏—Ç—å —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ |
| `buildGraphStructure()` | `GraphBuilderWorker.ts` | –î–æ–±–∞–≤–∏—Ç—å —Ä—ë–±—Ä–∞ –ø–µ—Ä–µ—Å–∞–¥–∫–∏, —Ä–∞—Å—á–µ—Ç –≤–µ—Å–∞ –ø–µ—Ä–µ—Å–∞–¥–∫–∏ |
| `calculateWeightWithValidation()` | `GraphBuilderWorker.ts` | –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –≤–µ—Å–∞ –¥–ª—è ferry-–º–∞—Ä—à—Ä—É—Ç–æ–≤ —Å —É—á–µ—Ç–æ–º —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç–∏ |

### 7.4 –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

| –°—Ç—Ä—É–∫—Ç—É—Ä–∞ | –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏—è |
|-----------|------|-----------|
| `TransportType` enum | `domain/entities/Route.ts` | –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `FERRY` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç |
| `GraphNeighbor` interface | `domain/repositories/IGraphRepository.ts` | –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `transportType?: string` |
| `Route.metadata` | `domain/entities/Route.ts` | –î–æ–±–∞–≤–∏—Ç—å `ferrySchedule?: { summer: {...}, winter: {...} }` |
| `VirtualRoute` | `domain/entities/VirtualRoute.ts` | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `FERRY` —Ç–∏–ø–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ |

---

## 8. –ì–æ—Ç–æ–≤—ã–π –ø–æ—Ä—è–¥–æ–∫ —Ä–∞–±–æ—Ç

### –≠—Ç–∞–ø 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: üî¥ –ö–†–ò–¢–ò–ß–ù–û)

**–í—Ä–µ–º—è:** 2-3 –¥–Ω—è

#### –ó–∞–¥–∞—á–∞ 1.1: –°–æ–∑–¥–∞—Ç—å —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ –∞—ç—Ä–æ–ø–æ—Ä—Ç–æ–≤ –∏ –ø—Ä–∏–≥–æ—Ä–æ–¥–æ–≤
- [ ] –°–æ–∑–¥–∞—Ç—å `backend/data/reference/airports-reference.json`
- [ ] –°–æ–∑–¥–∞—Ç—å `backend/data/reference/suburbs-reference.json`
- [ ] –°–æ–∑–¥–∞—Ç—å `backend/src/shared/utils/airports-loader.ts`
- [ ] –°–æ–∑–¥–∞—Ç—å `backend/src/shared/utils/suburbs-loader.ts`
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å unit-—Ç–µ—Å—Ç—ã –¥–ª—è –∑–∞–≥—Ä—É–∑—á–∏–∫–æ–≤

#### –ó–∞–¥–∞—á–∞ 1.2: –ò—Å–ø—Ä–∞–≤–∏—Ç—å `extractCityFromStopName()`
- [ ] –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `getCityByAirportName` –≤ `city-normalizer.ts`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–∞—Ç—Ç–µ—Ä–Ω–∞ "–ê—ç—Ä–æ–ø–æ—Ä—Ç [–ì–æ—Ä–æ–¥] ([–ê—ç—Ä–æ–ø–æ—Ä—Ç])"
- [ ] –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–∞—Ç—Ç–µ—Ä–Ω–∞ "–ê—ç—Ä–æ–ø–æ—Ä—Ç [–ì–æ—Ä–æ–¥]" (–±–µ–∑ —Å–∫–æ–±–æ–∫)
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å unit-—Ç–µ—Å—Ç—ã –¥–ª—è –Ω–æ–≤—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

#### –ó–∞–¥–∞—á–∞ 1.3: –û–±–Ω–æ–≤–∏—Ç—å `ODataSyncWorker`
- [ ] –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `getCityByAirportName`, `getMainCityBySuburb`, `isCityInUnifiedReference`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ –≤ `parseODataResponse()`
- [ ] –°–æ–∑–¥–∞—Ç—å `backend/src/shared/validators/stop-validator.ts`
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ç–æ—Ä –≤ `parseODataResponse()`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å unit-—Ç–µ—Å—Ç—ã –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ "–ê—ç—Ä–æ–ø–æ—Ä—Ç –Ø–∫—É—Ç—Å–∫ (–¢—É–π–º–∞–∞–¥–∞)" ‚Üí `city_id = "–Ø–∫—É—Ç—Å–∫"`
- ‚úÖ "–ù–∏–∂–Ω–∏–π –ë–µ—Å—Ç—è—Ö" ‚Üí `city_id = "–Ø–∫—É—Ç—Å–∫"`
- ‚úÖ "–¢—É–π–º–∞–∞–¥–∞" –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π –≥–æ—Ä–æ–¥
- ‚úÖ –ú—É—Å–æ—Ä–Ω—ã–µ –∑–∞–ø–∏—Å–∏ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö

---

### –≠—Ç–∞–ø 2: –§–µ–¥–µ—Ä–∞–ª—å–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: üü† –í–´–°–û–ö–ò–ô)

**–í—Ä–µ–º—è:** 3-4 –¥–Ω—è

#### –ó–∞–¥–∞—á–∞ 2.1: –°–æ–∑–¥–∞—Ç—å —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤
- [ ] –°–æ–∑–¥–∞—Ç—å `backend/data/reference/russia-federal-cities-reference.json`
- [ ] –í–∫–ª—é—á–∏—Ç—å 10 —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ –∏ –∞—ç—Ä–æ–ø–æ—Ä—Ç–∞–º–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç

#### –ó–∞–¥–∞—á–∞ 2.2: –°–æ–∑–¥–∞—Ç—å –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫
- [ ] –°–æ–∑–¥–∞—Ç—å `backend/src/shared/utils/unified-cities-loader.ts`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `loadUnifiedCitiesReference()`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `getAllFederalCities()`, `getAllYakutiaCities()`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `isCityInUnifiedReference()`
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å unit-—Ç–µ—Å—Ç—ã

#### –ó–∞–¥–∞—á–∞ 2.3: –û–±–Ω–æ–≤–∏—Ç—å `VirtualEntitiesGeneratorWorker`
- [ ] –ó–∞–º–µ–Ω–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –Ω–∞ `unified-cities-loader`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `generateVirtualStops()` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–º —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–º
- [ ] –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å `ensureYakutiaCitiesConnectivity()` ‚Üí `ensureCitiesConnectivity()`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –¥–ª—è —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ ‚Üí –Ø–∫—É—Ç–∏—è (hub-based)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –¥–ª—è —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ ‚Üí —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ (–ø—Ä—è–º—ã–µ)
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å unit-—Ç–µ—Å—Ç—ã

#### –ó–∞–¥–∞—á–∞ 2.4: –°–æ–∑–¥–∞—Ç—å `AirRouteGeneratorWorker`
- [ ] –°–æ–∑–¥–∞—Ç—å `backend/src/application/workers/AirRouteGeneratorWorker.ts`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∞–≤–∏–∞–º–∞—Ä—à—Ä—É—Ç–æ–≤ –∏–∑ —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ –≤ –Ø–∫—É—Ç—Å–∫
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Ä–µ–π—Å–æ–≤ –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–æ–≤
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ –ø–∞–π–ø–ª–∞–π–Ω –≤–æ—Ä–∫–µ—Ä–æ–≤ (`initializeWorkers.ts`)
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å unit-—Ç–µ—Å—Ç—ã

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ 10 —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ —Å–∏—Å—Ç–µ–º–µ
- ‚úÖ –ú–∞—Ä—à—Ä—É—Ç—ã –∏–∑ —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ –≤ –Ø–∫—É—Ç–∏—é —Å—Ç—Ä–æ—è—Ç—Å—è (—á–µ—Ä–µ–∑ –Ø–∫—É—Ç—Å–∫)
- ‚úÖ –ú–∞—Ä—à—Ä—É—Ç—ã –º–µ–∂–¥—É —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–º–∏ –≥–æ—Ä–æ–¥–∞–º–∏ —Å—Ç—Ä–æ—è—Ç—Å—è (–ø—Ä—è–º—ã–µ)

---

### –≠—Ç–∞–ø 3: –°–º–µ—à–∞–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã –∏ –ø–µ—Ä–µ–ø—Ä–∞–≤–∞ (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: üü° –°–†–ï–î–ù–ò–ô)

**–í—Ä–µ–º—è:** 4-5 –¥–Ω–µ–π

#### –ó–∞–¥–∞—á–∞ 3.1: –†–∞—Å—à–∏—Ä–∏—Ç—å mock-–¥–∞–Ω–Ω—ã–µ
- [ ] –î–æ–±–∞–≤–∏—Ç—å –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–ª—è —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ –≤ `stops.json`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–ª—è –ø–µ—Ä–µ–ø—Ä–∞–≤—ã (–Ø–∫—É—Ç—Å–∫, –ù–∏–∂–Ω–∏–π –ë–µ—Å—Ç—è—Ö) –≤ `stops.json`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∞–≤–∏–∞–º–∞—Ä—à—Ä—É—Ç—ã –∏–∑ —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ –≤ `routes.json`
- [ ] –î–æ–±–∞–≤–∏—Ç—å ferry-–º–∞—Ä—à—Ä—É—Ç—ã (–Ø–∫—É—Ç—Å–∫ ‚Üî –ù–∏–∂–Ω–∏–π –ë–µ—Å—Ç—è—Ö) –≤ `routes.json`
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–π—Å—ã –¥–ª—è –Ω–æ–≤—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤ –≤ `flights.json`

#### –ó–∞–¥–∞—á–∞ 3.2: –û–±–Ω–æ–≤–∏—Ç—å `GraphBuilderWorker` –¥–ª—è –ø–µ—Ä–µ—Å–∞–¥–æ–∫
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É –æ—Å—Ç–∞–Ω–æ–≤–æ–∫ –ø–æ –≥–æ—Ä–æ–¥–∞–º
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ —Ä—ë–±–µ—Ä –ø–µ—Ä–µ—Å–∞–¥–∫–∏ –º–µ–∂–¥—É –æ—Å—Ç–∞–Ω–æ–≤–∫–∞–º–∏ –≤ –æ–¥–Ω–æ–º –≥–æ—Ä–æ–¥–µ
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `calculateTransferWeight()` —Å —Ä–∞–∑–Ω—ã–º–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ç–∏–ø–∞ —Ä–µ–±—Ä–∞ `TRANSFER`
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å unit-—Ç–µ—Å—Ç—ã

#### –ó–∞–¥–∞—á–∞ 3.3: –û–±–Ω–æ–≤–∏—Ç—å `GraphBuilderWorker` –¥–ª—è ferry-–º–∞—Ä—à—Ä—É—Ç–æ–≤
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –≤–µ—Å–∞ –¥–ª—è ferry-–º–∞—Ä—à—Ä—É—Ç–æ–≤ (20 –º–∏–Ω—É—Ç + –æ–∂–∏–¥–∞–Ω–∏–µ)
- [ ] –£—á–µ—Å—Ç—å —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç—å (–ª–µ—Ç–æ/–∑–∏–º–∞) –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ –≤–µ—Å–∞
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `metadata.ferrySchedule` –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏ –æ–∂–∏–¥–∞–Ω–∏—è
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å unit-—Ç–µ—Å—Ç—ã

#### –ó–∞–¥–∞—á–∞ 3.4: –û–±–Ω–æ–≤–∏—Ç—å `RouteGraphBuilder`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É `FERRY` —Ç–∏–ø–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
- [ ] –°–æ–∑–¥–∞–≤–∞—Ç—å —Ä—ë–±—Ä–∞ –¥–ª—è ferry-–º–∞—Ä—à—Ä—É—Ç–æ–≤ —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º –≤–µ—Å–æ–º
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å unit-—Ç–µ—Å—Ç—ã

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –°–º–µ—à–∞–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã (air + ground + ferry) —Å—Ç—Ä–æ—è—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ü–µ—Ä–µ–ø—Ä–∞–≤–∞ –Ø–∫—É—Ç—Å–∫ ‚Üî –ù–∏–∂–Ω–∏–π –ë–µ—Å—Ç—è—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ ferry-—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç
- ‚úÖ –ü–µ—Ä–µ—Å–∞–¥–∫–∏ –º–µ–∂–¥—É —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞–º–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –≤–µ—Å–∞–º–∏

---

### –≠—Ç–∞–ø 4: –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: üü° –°–†–ï–î–ù–ò–ô)

**–í—Ä–µ–º—è:** 3-4 –¥–Ω—è

#### –ó–∞–¥–∞—á–∞ 4.1: –°–æ–∑–¥–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ç–æ—Ä –≥—Ä–∞—Ñ–∞
- [ ] –°–æ–∑–¥–∞—Ç—å `backend/src/shared/validators/graph-validator.ts`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `validateGraphStructure()`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `validateTransferEdges()`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `validateFerryEdges()`
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å unit-—Ç–µ—Å—Ç—ã

#### –ó–∞–¥–∞—á–∞ 4.2: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤ `GraphBuilderWorker`
- [ ] –í—ã–∑—ã–≤–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø–æ—Å–ª–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∞
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

#### –ó–∞–¥–∞—á–∞ 4.3: –û—Ç–ª–∞–¥–∫–∞ –≥—Ä–∞—Ñ–∞ –¥–ª—è —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É–∑–ª–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω–æ–≥–æ –≥–æ—Ä–æ–¥–∞
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å–≤—è–∑–Ω–æ—Å—Ç–∏ —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ —Å hub-—É–∑–ª–æ–º
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ì—Ä–∞—Ñ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —É–∑–ª–æ–≤ –∏ –≤–µ—Å–æ–≤
- ‚úÖ –û–±–Ω–∞—Ä—É–∂–∏–≤–∞—é—Ç—Å—è –∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –ø—Ä–æ–±–ª–µ–º—ã —Å–≤—è–∑–Ω–æ—Å—Ç–∏
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ —É—Å—Ç–æ–π—á–∏–≤–∞ –∫ –æ—à–∏–±–∫–∞–º

---

## 9. –ö–æ–Ω—Ç—Ä-–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### 9.1 –ß–µ–∫–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ø–∫—É—Ç—Å–∫–∞

- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞ 1:** –Ø–∫—É—Ç—Å–∫ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤
  - –ó–∞–ø—Ä–æ—Å: `GET /api/v1/routes/search?from=–Ø–∫—É—Ç—Å–∫&to=–û–ª—ë–∫–º–∏–Ω—Å–∫`
  - –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –ú–∞—Ä—à—Ä—É—Ç –Ω–∞–π–¥–µ–Ω, `fromCity = "–Ø–∫—É—Ç—Å–∫"`

- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞ 2:** –û—Å—Ç–∞–Ω–æ–≤–∫–∞ "–ê—ç—Ä–æ–ø–æ—Ä—Ç –Ø–∫—É—Ç—Å–∫ (–¢—É–π–º–∞–∞–¥–∞)" –∏–º–µ–µ—Ç `city_id = "–Ø–∫—É—Ç—Å–∫"`
  - –ó–∞–ø—Ä–æ—Å –∫ –ë–î: `SELECT city_id FROM stops WHERE name LIKE '%–Ø–∫—É—Ç—Å–∫%'`
  - –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –í—Å–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å "–Ø–∫—É—Ç—Å–∫" –∏–º–µ—é—Ç `city_id = "–Ø–∫—É—Ç—Å–∫"` –∏–ª–∏ `city_id = "—è–∫—É—Ç—Å–∫"` (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ)

- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞ 3:** "–¢—É–π–º–∞–¥–∞" –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π –≥–æ—Ä–æ–¥
  - –ó–∞–ø—Ä–æ—Å –∫ –ë–î: `SELECT DISTINCT city_id FROM stops WHERE city_id LIKE '%—Ç—É–π–º–∞%'`
  - –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –ü—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–ª–∏ —Ç–æ–ª—å–∫–æ "–Ø–∫—É—Ç—Å–∫"

### 9.2 –ß–µ–∫–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –º—É—Å–æ—Ä–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤

- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞ 1:** –ù–µ—Ç –≥–æ—Ä–æ–¥–æ–≤ —Å —Å–ª—É–∂–µ–±–Ω—ã–º–∏ —Å–ª–æ–≤–∞–º–∏
  - –ó–∞–ø—Ä–æ—Å –∫ –ë–î: `SELECT DISTINCT city_id FROM stops WHERE city_id IN ('—Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è', '–≥–ª–∞–≤–Ω—ã–π', '–ø–∞—Å—Å–∞–∂–∏—Ä—Å–∫–∏–π')`
  - –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –ü—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞ 2:** –í—Å–µ –≥–æ—Ä–æ–¥–∞ –∏–∑ –ë–î –µ—Å—Ç—å –≤ `unified-cities-reference.json`
  - –°–∫—Ä–∏–ø—Ç: –°—Ä–∞–≤–Ω–∏—Ç—å `SELECT DISTINCT city_id FROM stops` —Å `unified-cities-reference.json`
  - –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –í—Å–µ `city_id` –Ω–∞–π–¥–µ–Ω—ã –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ

- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞ 3:** –ù–µ—Ç –æ—Å—Ç–∞–Ω–æ–≤–æ–∫ —Å –ø—É—Å—Ç—ã–º –∏–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º `city_id`
  - –ó–∞–ø—Ä–æ—Å –∫ –ë–î: `SELECT * FROM stops WHERE city_id IS NULL OR city_id = ''`
  - –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –ü—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

### 9.3 –ß–µ–∫–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤

- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞ 1:** –ú–æ—Å–∫–≤–∞ –∏ –¥—Ä—É–≥–∏–µ –≥–æ—Ä–æ–¥–∞ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ —Å–∏—Å—Ç–µ–º–µ
  - –ó–∞–ø—Ä–æ—Å: `GET /api/v1/routes/search?from=–ú–æ—Å–∫–≤–∞&to=–Ø–∫—É—Ç—Å–∫`
  - –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –ú–∞—Ä—à—Ä—É—Ç –Ω–∞–π–¥–µ–Ω, `fromCity = "–ú–æ—Å–∫–≤–∞"`

- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞ 2:** –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–æ–∑–¥–∞–Ω—ã –¥–ª—è —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤
  - –ó–∞–ø—Ä–æ—Å –∫ –ë–î: `SELECT * FROM stops WHERE city_id IN ('–º–æ—Å–∫–≤–∞', '–Ω–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫', '–∫—Ä–∞—Å–Ω–æ—è—Ä—Å–∫') AND is_virtual = true`
  - –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è –≤—Å–µ—Ö —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤

- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞ 3:** –ú–∞—Ä—à—Ä—É—Ç—ã –∏–∑ —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ —Å—Ç—Ä–æ—è—Ç—Å—è
  - –ó–∞–ø—Ä–æ—Å—ã:
    - `GET /api/v1/routes/search?from=–ú–æ—Å–∫–≤–∞&to=–û–ª—ë–∫–º–∏–Ω—Å–∫`
    - `GET /api/v1/routes/search?from=–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫&to=–ú–∏—Ä–Ω—ã–π`
  - –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –ú–∞—Ä—à—Ä—É—Ç—ã –Ω–∞–π–¥–µ–Ω—ã, –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ –Ø–∫—É—Ç—Å–∫ (hub)

### 9.4 –ß–µ–∫–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–º–µ—à–∞–Ω–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤

- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞ 1:** –ú–∞—Ä—à—Ä—É—Ç "–ú–æ—Å–∫–≤–∞ ‚Üí –Ø–∫—É—Ç—Å–∫ ‚Üí –ß—É—Ä–∞–ø—á–∞" —Å—Ç—Ä–æ–∏—Ç—Å—è
  - –ó–∞–ø—Ä–æ—Å: `GET /api/v1/routes/search?from=–ú–æ—Å–∫–≤–∞&to=–ß—É—Ä–∞–ø—á–∞`
  - –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –ú–∞—Ä—à—Ä—É—Ç –Ω–∞–π–¥–µ–Ω, —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–µ–≥–º–µ–Ω—Ç—ã:
    - –ú–æ—Å–∫–≤–∞ ‚Üí –Ø–∫—É—Ç—Å–∫ (PLANE)
    - –ü–µ—Ä–µ—Å–∞–¥–∫–∞ –≤ –Ø–∫—É—Ç—Å–∫–µ (TRANSFER, 90 –º–∏–Ω—É—Ç)
    - –Ø–∫—É—Ç—Å–∫ ‚Üí –ß—É—Ä–∞–ø—á–∞ (BUS)

- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞ 2:** –ú–∞—Ä—à—Ä—É—Ç "–ú–æ—Å–∫–≤–∞ ‚Üí –Ø–∫—É—Ç—Å–∫ ‚Üí –ù–∏–∂–Ω–∏–π –ë–µ—Å—Ç—è—Ö" —Å—Ç—Ä–æ–∏—Ç—Å—è
  - –ó–∞–ø—Ä–æ—Å: `GET /api/v1/routes/search?from=–ú–æ—Å–∫–≤–∞&to=–ù–∏–∂–Ω–∏–π –ë–µ—Å—Ç—è—Ö`
  - –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –ú–∞—Ä—à—Ä—É—Ç –Ω–∞–π–¥–µ–Ω, —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–µ–≥–º–µ–Ω—Ç—ã:
    - –ú–æ—Å–∫–≤–∞ ‚Üí –Ø–∫—É—Ç—Å–∫ (PLANE)
    - –ü–µ—Ä–µ—Å–∞–¥–∫–∞ –≤ –Ø–∫—É—Ç—Å–∫–µ (TRANSFER, 90 –º–∏–Ω—É—Ç)
    - –Ø–∫—É—Ç—Å–∫ ‚Üí –ù–∏–∂–Ω–∏–π –ë–µ—Å—Ç—è—Ö (FERRY)

- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞ 3:** –ú–∞—Ä—à—Ä—É—Ç "–ú–æ—Å–∫–≤–∞ ‚Üí –ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫ ‚Üí –Ø–∫—É—Ç—Å–∫ ‚Üí –û–ª—ë–∫–º–∏–Ω—Å–∫" —Å—Ç—Ä–æ–∏—Ç—Å—è
  - –ó–∞–ø—Ä–æ—Å: `GET /api/v1/routes/search?from=–ú–æ—Å–∫–≤–∞&to=–û–ª—ë–∫–º–∏–Ω—Å–∫`
  - –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –ú–∞—Ä—à—Ä—É—Ç –Ω–∞–π–¥–µ–Ω, —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–µ–≥–º–µ–Ω—Ç—ã:
    - –ú–æ—Å–∫–≤–∞ ‚Üí –ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫ (PLANE, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    - –ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫ ‚Üí –Ø–∫—É—Ç—Å–∫ (PLANE)
    - –ü–µ—Ä–µ—Å–∞–¥–∫–∞ –≤ –Ø–∫—É—Ç—Å–∫–µ (TRANSFER, 90 –º–∏–Ω—É—Ç)
    - –Ø–∫—É—Ç—Å–∫ ‚Üí –û–ª—ë–∫–º–∏–Ω—Å–∫ (BUS)

### 9.5 –ß–µ–∫–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–ø—Ä–∞–≤—ã

- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞ 1:** –ü–µ—Ä–µ–ø—Ä–∞–≤–∞ –Ø–∫—É—Ç—Å–∫ ‚Üî –ù–∏–∂–Ω–∏–π –ë–µ—Å—Ç—è—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç
  - –ó–∞–ø—Ä–æ—Å: `GET /api/v1/routes/search?from=–Ø–∫—É—Ç—Å–∫&to=–ù–∏–∂–Ω–∏–π –ë–µ—Å—Ç—è—Ö`
  - –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –ú–∞—Ä—à—Ä—É—Ç –Ω–∞–π–¥–µ–Ω, —Ç–∏–ø —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ = `FERRY`, –≤–µ—Å = 40-65 –º–∏–Ω—É—Ç

- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞ 2:** Ferry-–º–∞—Ä—à—Ä—É—Ç—ã —Å–æ–∑–¥–∞–Ω—ã –≤ –≥—Ä–∞—Ñ–µ
  - –ó–∞–ø—Ä–æ—Å –∫ Redis: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Ä—ë–±–µ—Ä —Å `transportType = "FERRY"`
  - –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –†—ë–±—Ä–∞ –Ω–∞–π–¥–µ–Ω—ã –º–µ–∂–¥—É –æ—Å—Ç–∞–Ω–æ–≤–∫–∞–º–∏ –ø–µ—Ä–µ–ø—Ä–∞–≤—ã

- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞ 3:** –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –ø–µ—Ä–µ–ø—Ä–∞–≤—ã
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞—Å—á–µ—Ç –≤–µ—Å–∞ –¥–ª—è –ª–µ—Ç–∞ (35-40 –º–∏–Ω—É—Ç) –∏ –∑–∏–º—ã (50-65 –º–∏–Ω—É—Ç)
  - –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –í–µ—Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–µ–∑–æ–Ω–∞

### 9.6 –ß–µ–∫–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥—Ä–∞—Ñ–∞

- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞ 1:** –ì—Ä–∞—Ñ –ø–æ–ª–æ–Ω –∏ —Å–≤—è–∑–µ–Ω
  - –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≥—Ä–∞—Ñ–∞: `validateGraphStructure()`
  - –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: `isValid = true`, –Ω–µ—Ç –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —É–∑–ª–æ–≤

- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞ 2:** –†—ë–±—Ä–∞ –ø–µ—Ä–µ—Å–∞–¥–∫–∏ —Å–æ–∑–¥–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
  - –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é: `validateTransferEdges()`
  - –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –í—Å–µ —Ä—ë–±—Ä–∞ –ø–µ—Ä–µ—Å–∞–¥–∫–∏ –∏–º–µ—é—Ç –≤–µ—Å 30-120 –º–∏–Ω—É—Ç

- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞ 3:** Ferry-—Ä—ë–±—Ä–∞ –∏–º–µ—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤–µ—Å
  - –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é: `validateFerryEdges()`
  - –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –í—Å–µ ferry-—Ä—ë–±—Ä–∞ –∏–º–µ—é—Ç –≤–µ—Å 20-65 –º–∏–Ω—É—Ç

- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞ 4:** –í—Å–µ —É–∑–ª—ã –¥–æ—Å—Ç–∏–∂–∏–º—ã –∏–∑ hub-—É–∑–ª–∞ (–Ø–∫—É—Ç—Å–∫)
  - –ó–∞–ø—É—Å—Ç–∏—Ç—å BFS –æ—Ç –Ø–∫—É—Ç—Å–∫–∞
  - –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –ù–µ –º–µ–Ω–µ–µ 80% —É–∑–ª–æ–≤ –¥–æ—Å—Ç–∏–∂–∏–º—ã

### 9.7 –ò—Ç–æ–≥–æ–≤—ã–π —á–µ–∫–ª–∏—Å—Ç

- [ ] ‚úÖ –Ø–∫—É—Ç—Å–∫ —Å–Ω–æ–≤–∞ –≤ –¥–∞–Ω–Ω—ã—Ö
- [ ] ‚úÖ –ù–µ—Ç –º—É—Å–æ—Ä–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤
- [ ] ‚úÖ –ú–æ—Å–∫–≤–∞ –∏ –¥—Ä—É–≥–∏–µ –≥–æ—Ä–æ–¥–∞ —Å—Ç—Ä–æ—è—Ç –º–∞—Ä—à—Ä—É—Ç—ã
- [ ] ‚úÖ –°–º–µ—à–∞–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã —Å—Ç—Ä–æ—è—Ç—Å—è
- [ ] ‚úÖ –ü–µ—Ä–µ–ø—Ä–∞–≤–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] ‚úÖ –ì—Ä–∞—Ñ –ø–æ–ª–æ–Ω –∏ —Å–≤—è–∑–µ–Ω
- [ ] ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö
- [ ] ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–µ —É—Ö—É–¥—à–∏–ª–∞—Å—å

---

## üìä –ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞

### –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- **–≠—Ç–∞–ø 1 (–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è):** 2-3 –¥–Ω—è
- **–≠—Ç–∞–ø 2 (–§–µ–¥–µ—Ä–∞–ª—å–Ω—ã–µ –≥–æ—Ä–æ–¥–∞):** 3-4 –¥–Ω—è
- **–≠—Ç–∞–ø 3 (–°–º–µ—à–∞–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã –∏ –ø–µ—Ä–µ–ø—Ä–∞–≤–∞):** 4-5 –¥–Ω–µ–π
- **–≠—Ç–∞–ø 4 (–í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è):** 3-4 –¥–Ω—è

**–ò—Ç–æ–≥–æ:** 12-16 –¥–Ω–µ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

1. ‚úÖ –Ø–∫—É—Ç—Å–∫ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤
2. ‚úÖ "–¢—É–π–º–∞–¥–∞" –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π –≥–æ—Ä–æ–¥
3. ‚úÖ –ú—É—Å–æ—Ä–Ω—ã–µ –∑–∞–ø–∏—Å–∏ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö
4. ‚úÖ 10 —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ —Å–∏—Å—Ç–µ–º–µ
5. ‚úÖ –ú–∞—Ä—à—Ä—É—Ç—ã –∏–∑ —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ –≤ –Ø–∫—É—Ç–∏—é —Å—Ç—Ä–æ—è—Ç—Å—è
6. ‚úÖ –°–º–µ—à–∞–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã (air + ground + ferry) —Å—Ç—Ä–æ—è—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
7. ‚úÖ –ü–µ—Ä–µ–ø—Ä–∞–≤–∞ –Ø–∫—É—Ç—Å–∫ ‚Üî –ù–∏–∂–Ω–∏–π –ë–µ—Å—Ç—è—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ ferry-—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç
8. ‚úÖ –ü–µ—Ä–µ—Å–∞–¥–∫–∏ –º–µ–∂–¥—É —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞–º–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
9. ‚úÖ –ì—Ä–∞—Ñ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —É–∑–ª–æ–≤ –∏ –≤–µ—Å–æ–≤
10. ‚úÖ –°–∏—Å—Ç–µ–º–∞ —É—Å—Ç–æ–π—á–∏–≤–∞ –∫ –æ—à–∏–±–∫–∞–º, –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –æ—à–∏–±–∫–∏ –Ω–µ –≤–æ–∑–Ω–∏–∫–∞—é—Ç

---

**–ö–æ–Ω–µ—Ü –¥–æ–∫—É–º–µ–Ω—Ç–∞**
