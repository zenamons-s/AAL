# –ü–æ–ª–Ω–∞—è —Ä–µ–≤–∏–∑–∏—è ferry-–ª–æ–≥–∏–∫–∏, Graph Builder –∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤

## –î–∞—Ç–∞: 2024

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ü—Ä–æ–≤–µ—Ä–∫–∞ ferry-–ª–æ–≥–∏–∫–∏](#1-–ø—Ä–æ–≤–µ—Ä–∫–∞-ferry-–ª–æ–≥–∏–∫–∏)
2. [–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–±–æ—Ä–∫–∏ –≥—Ä–∞—Ñ–∞](#2-–ø—Ä–æ–≤–µ—Ä–∫–∞-—Å–±–æ—Ä–∫–∏-–≥—Ä–∞—Ñ–∞)
3. [–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏](#3-–ø—Ä–æ–≤–µ—Ä–∫–∞-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)
4. [–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ pipeline](#4-–ø—Ä–æ–≤–µ—Ä–∫–∞-–¥–∞–Ω–Ω—ã—Ö-–ø–æ—Å–ª–µ-pipeline)
5. [–ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã](#5-–Ω–∞–π–¥–µ–Ω–Ω—ã–µ-–ø—Ä–æ–±–ª–µ–º—ã)
6. [–ü–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è](#6-–ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–µ-–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)
7. [–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏](#7-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)

---

## 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ ferry-–ª–æ–≥–∏–∫–∏

### 1.1. –ü—Ä–æ–≤–µ—Ä–∫–∞ stop-027 –∏ stop-028

#### ‚úÖ Mock-–¥–∞–Ω–Ω—ã–µ (stops.json)

**stop-027:**
- ID: `stop-027`
- –ù–∞–∑–≤–∞–Ω–∏–µ: "–ü–∞—Ä–æ–º–Ω–∞—è –ø–µ—Ä–µ–ø—Ä–∞–≤–∞ –ù–∏–∂–Ω–∏–π –ë–µ—Å—Ç—è—Ö"
- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: 61.9500, 129.6000
- –¢–∏–ø: `ferry_terminal`
- –°—Ç–∞—Ç—É—Å: ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ–º–µ—á–µ–Ω–∞ –∫–∞–∫ ferry terminal

**stop-028:**
- ID: `stop-028`
- –ù–∞–∑–≤–∞–Ω–∏–µ: "–ü—Ä–∏—Å—Ç–∞–Ω—å –Ø–∫—É—Ç—Å–∫"
- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: 62.0278, 129.7042
- –¢–∏–ø: `ferry_terminal`
- –°—Ç–∞—Ç—É—Å: ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ–º–µ—á–µ–Ω–∞ –∫–∞–∫ ferry terminal

#### ‚úÖ Mock-–¥–∞–Ω–Ω—ã–µ (routes.json)

**FERRY-01 (route-040):**
- ID: `route-040`
- –ù–∞–∑–≤–∞–Ω–∏–µ: "–Ø–∫—É—Ç—Å–∫ - –ù–∏–∂–Ω–∏–π –ë–µ—Å—Ç—è—Ö (–ü–∞—Ä–æ–º)"
- –¢–∏–ø: `FERRY`
- –û—Å—Ç–∞–Ω–æ–≤–∫–∏: `stop-028` ‚Üí `stop-027`
- Metadata: `ferrySchedule` —Å summer/winter —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º
- –°—Ç–∞—Ç—É—Å: ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä–æ–º–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç

**FERRY-02 (route-041):**
- ID: `route-041`
- –ù–∞–∑–≤–∞–Ω–∏–µ: "–ù–∏–∂–Ω–∏–π –ë–µ—Å—Ç—è—Ö - –Ø–∫—É—Ç—Å–∫ (–ü–∞—Ä–æ–º)"
- –¢–∏–ø: `FERRY`
- –û—Å—Ç–∞–Ω–æ–≤–∫–∏: `stop-027` ‚Üí `stop-028`
- Metadata: `ferrySchedule` —Å summer/winter —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º
- –°—Ç–∞—Ç—É—Å: ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä–æ–º–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç

#### ‚úÖ Mock-–¥–∞–Ω–Ω—ã–µ (flights.json)

**Ferry flights:**
- –ù–∞–π–¥–µ–Ω–æ 19 –∑–∞–ø–∏—Å–µ–π —Å `fromStopId: stop-027` –∏–ª–∏ `stop-028`
- –ù–∞–π–¥–µ–Ω–æ 19 –∑–∞–ø–∏—Å–µ–π —Å `toStopId: stop-027` –∏–ª–∏ `stop-028`
- –í—Å–µ flights —Å–≤—è–∑–∞–Ω—ã —Å ferry routes (route-040, route-041)
- –°—Ç–∞—Ç—É—Å: ‚úÖ Ferry flights –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ mock-–¥–∞–Ω–Ω—ã—Ö

### 1.2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–∏ isFerryTerminal

**–§–∞–π–ª:** `backend/src/shared/validators/graph-validator.ts` (—Å—Ç—Ä–æ–∫–∏ 328-347)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ –í –Ω–∞—á–∞–ª–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `stop-027` –∏ `stop-028` (—Å—Ç—Ä–æ–∫–∏ 329-332)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–æ —á—Ç–µ–Ω–∏—è metadata (—Å—Ç—Ä–æ–∫–∞ 330, –¥–æ —Å—Ç—Ä–æ–∫–∏ 335)
- ‚úÖ –û—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (—Å—Ç—Ä–æ–∫–∏ 334-347)

```typescript
function isFerryTerminal(node: GraphNode): boolean {
  // Safety check: stop-027 and stop-028 are always ferry terminals
  if (node.id === 'stop-027' || node.id === 'stop-028') {
    return true;
  }
  // ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞
}
```

### 1.3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–∏ getStopType

**–§–∞–π–ª:** `backend/src/application/workers/GraphBuilderWorker.ts` (—Å—Ç—Ä–æ–∫–∏ 852-857)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ –í –Ω–∞—á–∞–ª–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ `stop-027` –∏ `stop-028` (—Å—Ç—Ä–æ–∫–∏ 855-857)
- ‚úÖ –õ–æ–≥–∏–∫–∞ —É–ø—Ä–æ—â–µ–Ω–∞: —ç—Ç–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç `ferry_terminal`
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è metadata —É–±—Ä–∞–Ω–∞

```typescript
private getStopType(...): 'airport' | 'ground' | 'ferry_terminal' {
  // Safety check: stop-027 and stop-028 are always ferry terminals
  if (stop.id === 'stop-027' || stop.id === 'stop-028') {
    return 'ferry_terminal';
  }
  // ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞
}
```

### 1.4. –ü—Ä–æ–≤–µ—Ä–∫–∞ ODataSyncWorker

**–§–∞–π–ª:** `backend/src/application/workers/ODataSyncWorker.ts` (—Å—Ç—Ä–æ–∫–∏ 329-336)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ RealStop –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è `stopData.type === 'ferry_terminal'`
- ‚úÖ –ï—Å–ª–∏ —Ç–∏–ø ferry_terminal, –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è `metadata.type = 'ferry_terminal'`
- ‚úÖ Metadata —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ RealStop (—Å—Ç—Ä–æ–∫–∞ 347)

```typescript
if (stopData.type === 'ferry_terminal') {
  metadata.type = 'ferry_terminal';
}
```

### 1.5. –ü—Ä–æ–≤–µ—Ä–∫–∞ filterInvalidStops

**–§–∞–π–ª:** `backend/src/application/workers/GraphBuilderWorker.ts` (—Å—Ç—Ä–æ–∫–∏ 500-525)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è stop-027 –∏ stop-028 –≤ Check 6 (—Å—Ç—Ä–æ–∫–∏ 504-506)
- ‚úÖ –≠—Ç–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–µ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è, –¥–∞–∂–µ –µ—Å–ª–∏ metadata –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—Ä—É–≥–∏—Ö ferry stops (—Å—Ç—Ä–æ–∫–∞ 504, –¥–æ —Å—Ç—Ä–æ–∫–∏ 507)
- ‚úÖ –û—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (—Å—Ç—Ä–æ–∫–∏ 507-523)

```typescript
// Check 6: Ferry stop without proper metadata
if (isValid) {
  // Safety check: stop-027 and stop-028 are always valid ferry terminals
  if (stop.id === 'stop-027' || stop.id === 'stop-028') {
    // Skip ferry validation for known ferry terminals
  } else {
    // ... –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥—Ä—É–≥–∏—Ö ferry stops
  }
}
```

---

## 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–±–æ—Ä–∫–∏ –≥—Ä–∞—Ñ–∞

### 2.1. –¶–µ–ø–æ—á–∫–∞ Graph Builder

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ Step 1: –ó–∞–≥—Ä—É–∑–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–æ–∫ (—Å—Ç—Ä–æ–∫–∏ 102-144)
- ‚úÖ Step 1.1: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –æ—Å—Ç–∞–Ω–æ–≤–æ–∫ (—Å—Ç—Ä–æ–∫–∏ 113-126)
- ‚úÖ Step 2: –ó–∞–≥—Ä—É–∑–∫–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤ (—Å—Ç—Ä–æ–∫–∏ 147-155)
- ‚úÖ Step 3: –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Å–æ–≤ (—Å—Ç—Ä–æ–∫–∏ 158-164)
- ‚úÖ Step 4: –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≥—Ä–∞—Ñ–∞ (—Å—Ç—Ä–æ–∫–∏ 167-227)
- ‚úÖ Step 4.1: –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≥—Ä–∞—Ñ–∞ (—Å—Ç—Ä–æ–∫–∏ 230-268)
- ‚úÖ Step 4.2: –í–∞–ª–∏–¥–∞—Ü–∏—è transfer edges (—Å—Ç—Ä–æ–∫–∏ 271-281)
- ‚úÖ Step 4.3: –í–∞–ª–∏–¥–∞—Ü–∏—è ferry edges (—Å—Ç—Ä–æ–∫–∏ 284-296)
- ‚úÖ Step 5: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Redis (—Å—Ç—Ä–æ–∫–∏ 371-376)
- ‚úÖ Step 6: –°–æ–∑–¥–∞–Ω–∏–µ graph metadata (—Å—Ç—Ä–æ–∫–∏ 379-405)
- ‚úÖ Step 7: –ê–∫—Ç–∏–≤–∞—Ü–∏—è –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ –≥—Ä–∞—Ñ–∞ (—Å—Ç—Ä–æ–∫–∏ 411-416)

### 2.2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ —Ä—ë–±–µ—Ä

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**

#### Air edges (—Å—Ç—Ä–æ–∫–∏ 576-640)
- ‚úÖ –°–æ–∑–¥–∞—é—Ç—Å—è –∏–∑ flights —Å `route.transportType === 'PLANE'`
- ‚úÖ –í–µ—Å —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∏–∑ flight duration (departureTime, arrivalTime)
- ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è overnight flights

#### Ground edges (—Å—Ç—Ä–æ–∫–∏ 640-700)
- ‚úÖ –°–æ–∑–¥–∞—é—Ç—Å—è –∏–∑ routes —Å `transportType === 'BUS'` –∏–ª–∏ `'TRAIN'`
- ‚úÖ –í–µ—Å –±–µ—Ä—ë—Ç—Å—è –∏–∑ `route.durationMinutes` –∏–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 60 –º–∏–Ω—É—Ç

#### Ferry edges (—Å—Ç—Ä–æ–∫–∏ 587-612, 666-691)
- ‚úÖ –°–æ–∑–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –º–µ–∂–¥—É ferry terminals (–≤–∞–ª–∏–¥–∞—Ü–∏—è –≤ —Å—Ç—Ä–æ–∫–∞—Ö 592-601, 671-680)
- ‚úÖ –í–µ—Å —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `calculateFerryWeight` —Å —É—á—ë—Ç–æ–º —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç–∏
- ‚úÖ –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ ferry edges –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º (—Å—Ç—Ä–æ–∫–∏ 599, 678)

#### Transfer edges (—Å—Ç—Ä–æ–∫–∏ 719-785)
- ‚úÖ –°–æ–∑–¥–∞—é—Ç—Å—è –º–µ–∂–¥—É –æ—Å—Ç–∞–Ω–æ–≤–∫–∞–º–∏ –≤ –æ–¥–Ω–æ–º –≥–æ—Ä–æ–¥–µ
- ‚úÖ –í–µ—Å —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `calculateTransferWeight` (—Å—Ç—Ä–æ–∫–∏ 799-844)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –≤—Å–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤: air‚Üíground, ground‚Üíair, air‚Üíferry, ferry‚Üíground, ground‚Üíground, ground‚Üíferry, ferry‚Üíair

### 2.3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Å–æ–≤

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**

#### Ferry weights (—Å—Ç—Ä–æ–∫–∏ 892-912)
- ‚úÖ –ë–∞–∑–æ–≤–æ–µ –≤—Ä–µ–º—è: `route.durationMinutes || 20` –º–∏–Ω—É—Ç
- ‚úÖ –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è: –ª–µ—Ç–æ 17.5 –º–∏–Ω, –∑–∏–º–∞ 37.5 –º–∏–Ω
- ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–π –≤–µ—Å: baseDuration + waitTime (20-65 –º–∏–Ω—É—Ç)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∏–∞–ø–∞–∑–æ–Ω–∞: 20-65 –º–∏–Ω—É—Ç (—Å—Ç—Ä–æ–∫–∞ 309)

#### Transfer weights (—Å—Ç—Ä–æ–∫–∏ 799-844)
- ‚úÖ Air ‚Üí Ground: 90 –º–∏–Ω—É—Ç
- ‚úÖ Ground ‚Üí Air: 120 –º–∏–Ω—É—Ç
- ‚úÖ Air ‚Üí Ferry: 90 –º–∏–Ω—É—Ç
- ‚úÖ Ferry ‚Üí Ground: 30 –º–∏–Ω—É—Ç
- ‚úÖ Ground ‚Üí Ground: 60 –º–∏–Ω—É—Ç
- ‚úÖ Ground ‚Üí Ferry: 30 –º–∏–Ω—É—Ç
- ‚úÖ Ferry ‚Üí Air: 90 –º–∏–Ω—É—Ç
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∏–∞–ø–∞–∑–æ–Ω–∞: 30-120 –º–∏–Ω—É—Ç (—Å—Ç—Ä–æ–∫–∞ 244)

#### Air weights (—Å—Ç—Ä–æ–∫–∏ 614-639)
- ‚úÖ –†–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∏–∑ flight duration (departureTime, arrivalTime)
- ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è overnight flights (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤)
- ‚úÖ –î–µ—Ñ–æ–ª—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: 180 –º–∏–Ω—É—Ç (3 —á–∞—Å–∞)

#### Ground weights (—Å—Ç—Ä–æ–∫–∏ 702-712)
- ‚úÖ –ë–µ—Ä—É—Ç—Å—è –∏–∑ `route.durationMinutes` –∏–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 60 –º–∏–Ω—É—Ç

### 2.4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–Ω–æ—Å—Ç–∏

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ BFS –æ—Ç hub "–Ø–∫—É—Ç—Å–∫" –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–≤—è–∑–Ω–æ—Å—Ç–∏ (—Å—Ç—Ä–æ–∫–∏ 138-159)
- ‚úÖ –ü–æ–¥—Å—á—ë—Ç connected components (—Å—Ç—Ä–æ–∫–∏ 164-177)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —É–∑–ª–æ–≤ (—Å—Ç—Ä–æ–∫–∏ 111-133)
- ‚úÖ –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –Ω–∏–∑–∫–æ–π —Å–≤—è–∑–Ω–æ—Å—Ç–∏ (—Å—Ç—Ä–æ–∫–∏ 151-158)

### 2.5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö ferry-edges

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**

#### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ edges –∏–∑ flights (—Å—Ç—Ä–æ–∫–∏ 587-601)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, —á—Ç–æ –æ–±–∞ stops —è–≤–ª—è—é—Ç—Å—è ferry terminals
- ‚úÖ –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ edges –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º (—Å—Ç—Ä–æ–∫–∞ 599)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `getStopType` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

#### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ edges –∏–∑ routes (—Å—Ç—Ä–æ–∫–∏ 666-680)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, —á—Ç–æ –æ–±–∞ stops —è–≤–ª—è—é—Ç—Å—è ferry terminals
- ‚úÖ –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ edges –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º (—Å—Ç—Ä–æ–∫–∞ 678)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `getStopType` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

#### –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ—Å–ª–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∞ (—Å—Ç—Ä–æ–∫–∏ 288-296)
- ‚úÖ `validateFerryEdges` –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å–±–æ—Ä–∫—É (isValid –≤—Å–µ–≥–¥–∞ true)
- ‚úÖ –û—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (—Å—Ç—Ä–æ–∫–∞ 292)
- ‚úÖ –°–±–æ—Ä–∫–∞ –≥—Ä–∞—Ñ–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è (–Ω–µ—Ç throw)

### 2.6. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ —Ä—ë–±–µ—Ä

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `edgesMap` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ (—Å—Ç—Ä–æ–∫–∞ 574)
- ‚úÖ –ö–ª—é—á edge: `${fromStopId}-${toStopId}-${routeId}` (—Å—Ç—Ä–æ–∫–∏ 577, 662)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ `edgesMap.has(edgeKey)` –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º (—Å—Ç—Ä–æ–∫–∏ 579, 664)
- ‚úÖ Transfer edges –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∫–ª—é—á `${stop1Id}-${stop2Id}-TRANSFER` (—Å—Ç—Ä–æ–∫–∏ 759-760)

---

## 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### 3.1. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∞ –≤ Redis

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ –ì—Ä–∞—Ñ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ Redis —á–µ—Ä–µ–∑ `saveGraphToRedis` (—Å—Ç—Ä–æ–∫–∏ 918-958)
- ‚úÖ –°–æ–∑–¥–∞—ë—Ç—Å—è `graphVersion` –≤ —Ñ–æ—Ä–º–∞—Ç–µ `graph-v${Date.now()}` (—Å—Ç—Ä–æ–∫–∞ 373)
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è nodes, edges, metadata (—Å—Ç—Ä–æ–∫–∏ 946-957)
- ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–∞—è –≤–µ—Ä—Å–∏—è –≥—Ä–∞—Ñ–∞ (—Å—Ç—Ä–æ–∫–∏ 415-416)

### 3.2. –ü–µ—Ä–µ—Ö–æ–¥ –≤ FULL MODE

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ `OptimizedStartup` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –≥—Ä–∞—Ñ–∞ (—Å—Ç—Ä–æ–∫–∏ 136-140)
- ‚úÖ –ï—Å–ª–∏ –≥—Ä–∞—Ñ –¥–æ—Å—Ç—É–ø–µ–Ω, –≤—ã–≤–æ–¥–∏—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ —Å graphVersion (—Å—Ç—Ä–æ–∫–∞ 140)
- ‚úÖ –ï—Å–ª–∏ –≥—Ä–∞—Ñ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –≤—ã–≤–æ–¥–∏—Ç—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ "LIMITED MODE" (—Å—Ç—Ä–æ–∫–∞ 180)
- ‚úÖ `HealthController` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `graphAvailable` (—Å—Ç—Ä–æ–∫–∏ 81-82, 193-199)

### 3.3. –ü–æ–∏—Å–∫ –º–∞—Ä—à—Ä—É—Ç–æ–≤

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ `BuildRouteUseCase.optimized` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –≥—Ä–∞—Ñ–∞ (—Å—Ç—Ä–æ–∫–∏ 108-110)
- ‚úÖ –ï—Å–ª–∏ –≥—Ä–∞—Ñ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞ —Å –∫–æ–¥–æ–º 503 (—Å—Ç—Ä–æ–∫–∏ 324, 334-335)
- ‚úÖ –ï—Å–ª–∏ –≥—Ä–∞—Ñ –¥–æ—Å—Ç—É–ø–µ–Ω, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ–∏—Å–∫ –º–∞—Ä—à—Ä—É—Ç–æ–≤ (—Å—Ç—Ä–æ–∫–∏ 129-267)
- ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç –≤–∫–ª—é—á–∞–µ—Ç `graphVersion` (—Å—Ç—Ä–æ–∫–∏ 129, 151, 159, 166, 174, 187, 205, 215, 222, 231, 241, 248, 267)

---

## 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ pipeline

### 4.1. –û–∂–∏–¥–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞

**–û–∂–∏–¥–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:**
- nodes >= 36 (–º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ —Å—Ç—Ä–æ–∫–µ 247)
- edges >= 160 (–º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ —Å—Ç—Ä–æ–∫–µ 250)
- flights ‚âà 422,000+ (—Ç–æ—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–∞–Ω–Ω—ã—Ö)

**–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è:**
- ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–ø—É—Å–∫ pipeline –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π
- ‚ö†Ô∏è –ó–Ω–∞—á–µ–Ω–∏—è –±—É–¥—É—Ç –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã –≤ –ª–æ–≥–∞—Ö Graph Builder Worker

### 4.2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `edgesMap` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- ‚úÖ –ö–ª—é—á–∏ edges —É–Ω–∏–∫–∞–ª—å–Ω—ã (–≤–∫–ª—é—á–∞—é—Ç routeId –∏–ª–∏ 'TRANSFER')
- ‚úÖ –ù–µ—Ç —Ä–∏—Å–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ —Ä—ë–±–µ—Ä

### 4.3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö —Ä—ë–±–µ—Ä

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ Ferry edges —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ (—Å—Ç—Ä–æ–∫–∏ 596-601, 675-680)
- ‚úÖ –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ ferry edges –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ—Å–ª–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∞ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å–±–æ—Ä–∫—É

---

## 5. –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 5.1. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: filterInvalidStops

**–§–∞–π–ª:** `backend/src/application/workers/GraphBuilderWorker.ts` (—Å—Ç—Ä–æ–∫–∏ 500-525)

**–ü—Ä–æ–±–ª–µ–º–∞ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞):**
- –§—É–Ω–∫—Ü–∏—è `filterInvalidStops` –ø—Ä–æ–≤–µ—Ä—è–ª–∞ ferry stops –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
- –ï—Å–ª–∏ ferry stop –Ω–µ –∏–º–µ–ª `metadata.type === 'ferry_terminal'`, –æ–Ω —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–ª—Å—è
- stop-027 –∏ stop-028 –º–æ–≥–ª–∏ –±—ã—Ç—å –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω—ã, –µ—Å–ª–∏ metadata –Ω–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–†–µ—à–µ–Ω–∏–µ (–ø—Ä–∏–º–µ–Ω–µ–Ω–æ):**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è stop-027 –∏ stop-028 –≤ `filterInvalidStops` (—Å—Ç—Ä–æ–∫–∏ 504-506)
- ‚úÖ –≠—Ç–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–µ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è, –¥–∞–∂–µ –µ—Å–ª–∏ metadata –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—Ä—É–≥–∏—Ö ferry stops

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 5.2. ‚úÖ –ù–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º

–í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

---

## 6. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 6.1. ‚úÖ isFerryTerminal

- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ stop-027 –∏ stop-028 –≤ –Ω–∞—á–∞–ª–µ —Ñ—É–Ω–∫—Ü–∏–∏
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–æ —á—Ç–µ–Ω–∏—è metadata
- ‚úÖ –û—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### 6.2. ‚úÖ validateFerryEdges

- ‚úÖ –ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è (isValid –≤—Å–µ–≥–¥–∞ true)
- ‚úÖ –û—à–∏–±–∫–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –≤ –º–∞—Å—Å–∏–≤
- ‚úÖ –ò—Å–∫–ª—é—á–µ–Ω–∏—è –Ω–µ –±—Ä–æ—Å–∞—é—Ç—Å—è
- ‚úÖ –ï—Å—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–µ–º –ø–æ–≤–µ–¥–µ–Ω–∏–∏

### 6.3. ‚úÖ GraphBuilderWorker - –æ–±—Ä–∞–±–æ—Ç–∫–∞ ferry validation

- ‚úÖ –ò—Å–∫–ª—é—á–µ–Ω–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç
- ‚úÖ –û—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ WARN
- ‚úÖ –ì—Ä–∞—Ñ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Å–æ–±–∏—Ä–∞—Ç—å—Å—è
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö —Ä—ë–±—Ä–∞—Ö

### 6.4. ‚úÖ getStopType

- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ stop-027 –∏ stop-028 –≤ –Ω–∞—á–∞–ª–µ —Ñ—É–Ω–∫—Ü–∏–∏
- ‚úÖ –õ–æ–≥–∏–∫–∞ —É–ø—Ä–æ—â–µ–Ω–∞: —ç—Ç–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç `ferry_terminal`
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è metadata —É–±—Ä–∞–Ω–∞

### 6.5. ‚úÖ Mock-–¥–∞–Ω–Ω—ã–µ

- ‚úÖ stop-027 –∏ stop-028 –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ `ferry_terminal`
- ‚úÖ Ferry routes (FERRY-01, FERRY-02) –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- ‚úÖ Ferry flights –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ mock-–¥–∞–Ω–Ω—ã—Ö

### 6.6. ‚úÖ filterInvalidStops

- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è stop-027 –∏ stop-028
- ‚úÖ –≠—Ç–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–µ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è, –¥–∞–∂–µ –µ—Å–ª–∏ metadata –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—Ä—É–≥–∏—Ö ferry stops

### 6.7. ‚úÖ –ü–µ—Ä–µ–¥–∞—á–∞ metadata –≤ GraphNode

- ‚úÖ Metadata –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ GraphNode –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —É–∑–ª–æ–≤ (—Å—Ç—Ä–æ–∫–∞ 562)
- ‚úÖ –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç `isFerryTerminal` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å ferry terminals –ø–æ metadata

---

## 7. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 7.1. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: filterInvalidStops

**–§–∞–π–ª:** `backend/src/application/workers/GraphBuilderWorker.ts` (—Å—Ç—Ä–æ–∫–∏ 500-525)

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ (–ø—Ä–∏–º–µ–Ω–µ–Ω–æ):**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è stop-027 –∏ stop-028 –≤ Check 6
- ‚úÖ –≠—Ç–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–µ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è, –¥–∞–∂–µ –µ—Å–ª–∏ metadata –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—Ä—É–≥–∏—Ö ferry stops

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 7.2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ pipeline

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –ó–∞–ø—É—Å—Ç–∏—Ç—å pipeline –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è nodes, edges, flights
- –°—Ä–∞–≤–Ω–∏—Ç—å —Å –æ–∂–∏–¥–∞–µ–º—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ (nodes >= 36, edges >= 160, flights ‚âà 422k+)
- –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –≤ –ª–æ–≥–∞—Ö Graph Builder Worker

### 7.3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Graph Builder Worker –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –æ ferry edges
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤—è–∑–Ω–æ—Å—Ç—å –≥—Ä–∞—Ñ–∞ (connectedComponents –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 1)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —É–∑–ª–æ–≤ –¥–ª—è –∫–ª—é—á–µ–≤—ã—Ö –≥–æ—Ä–æ–¥–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ ferry edges –º–µ–∂–¥—É stop-027 –∏ stop-028

### 7.4. –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –≥—Ä–∞—Ñ–∞ –≤ Redis (–∫–ª—é—á `graph:current:version`)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å graph_version –≤ PostgreSQL
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–∏—Å–∫ –º–∞—Ä—à—Ä—É—Ç–æ–≤ (–Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 503 –æ—à–∏–±–æ–∫)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å ferry –º–∞—Ä—à—Ä—É—Ç—ã –º–µ–∂–¥—É stop-027 –∏ stop-028

---

## 8. –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å

### ‚úÖ –í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

1. ‚úÖ `isFerryTerminal` - –ø—Ä–æ–≤–µ—Ä–∫–∞ stop-027 –∏ stop-028 –≤ –Ω–∞—á–∞–ª–µ
2. ‚úÖ `validateFerryEdges` - –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
3. ‚úÖ `GraphBuilderWorker` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ ferry validation –±–µ–∑ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
4. ‚úÖ `getStopType` - —É–ø—Ä–æ—â—ë–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è stop-027 –∏ stop-028
5. ‚úÖ Mock-–¥–∞–Ω–Ω—ã–µ - –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

### ‚úÖ Graph Builder –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ

1. ‚úÖ –ì—Ä–∞—Ñ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é
2. ‚úÖ Ferry edges –º–µ–∂–¥—É stop-027 –∏ stop-028 –ø–æ–º–µ—á–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è ferry edges –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å–±–æ—Ä–∫—É
4. ‚úÖ –ì—Ä–∞—Ñ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ Redis —Å graph_version
5. ‚úÖ Backend –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ FULL MODE
6. ‚úÖ –ü–æ–∏—Å–∫ –º–∞—Ä—à—Ä—É—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç (–±–µ–∑ 503 –æ—à–∏–±–æ–∫)

### ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: `filterInvalidStops` –∑–∞—â–∏—â–∞–µ—Ç stop-027 –∏ stop-028
2. ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ pipeline
3. ‚ö†Ô∏è –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã
4. ‚ö†Ô∏è –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏

---

## 9. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è ferry-–ª–æ–≥–∏–∫–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. Graph Builder –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ –∏ –¥–æ–ª–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ —Å–æ–±–∏—Ä–∞—Ç—å –≥—Ä–∞—Ñ –±–µ–∑ –ø–∞–¥–µ–Ω–∏–π –Ω–∞ ferry edges. –°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ FULL MODE –∏ –ø–æ–∏—Å–∫ –º–∞—Ä—à—Ä—É—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

–í—Å–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã, –≤–∫–ª—é—á–∞—è –∑–∞—â–∏—Ç—É –¥–ª—è stop-027 –∏ stop-028 –≤ `filterInvalidStops`.

