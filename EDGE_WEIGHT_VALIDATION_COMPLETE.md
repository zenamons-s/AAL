# –û—Ç—á—ë—Ç: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Ä—ë–±–µ—Ä —Å –≥–∞—Ä–∞–Ω—Ç–∏–µ–π –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ weight

## –ü—Ä–æ–±–ª–µ–º–∞

PathFinder –Ω–µ –º–æ–≥ –æ–±–Ω–æ–≤–ª—è—Ç—å —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –∏ –≤–æ–∑–≤—Ä–∞—â–∞–ª `distance = Infinity`, –ø–æ—Ç–æ–º—É —á—Ç–æ —Ä—ë–±—Ä–∞ –≥—Ä–∞—Ñ–∞ –Ω–µ –∏–º–µ–ª–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —á–∏—Å–ª–æ–≤–æ–≥–æ `weight`:

- **–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ä—ë–±—Ä–∞ –∏–º–µ–ª–∏ `undefined` –∏–ª–∏ `null` weight**: PathFinder –Ω–µ –º–æ–≥ —Å—É–º–º–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å–∞
- **–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ä—ë–±—Ä–∞ –∏–º–µ–ª–∏ `NaN` –∏–ª–∏ —Å—Ç—Ä–æ–∫–æ–≤—ã–π weight**: –ê–ª–≥–æ—Ä–∏—Ç–º Dijkstra –Ω–µ –º–æ–≥ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
- **–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ä—ë–±—Ä–∞ –∏–º–µ–ª–∏ –Ω–µ–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π weight**: –ê–ª–≥–æ—Ä–∏—Ç–º –Ω–µ –º–æ–≥ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ã–±–∏—Ä–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π —É–∑–µ–ª
- **–í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã –Ω–µ –∏–º–µ–ª–∏ weight**: –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —Ä—ë–±—Ä–∞ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å PathFinder

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- PathFinder –Ω–µ –º–æ–≥ –æ–±–Ω–æ–≤–ª—è—Ç—å —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
- `distance = Infinity` –¥–ª—è –≤—Å–µ—Ö —É–∑–ª–æ–≤
- –ú–∞—Ä—à—Ä—É—Ç—ã –Ω–µ –Ω–∞—Ö–æ–¥–∏–ª–∏—Å—å –¥–∞–∂–µ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –ø—É—Ç–∏ –≤ –≥—Ä–∞—Ñ–µ

## –†–µ—à–µ–Ω–∏–µ

–ü–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Ä—ë–±–µ—Ä —Å –≥–∞—Ä–∞–Ω—Ç–∏–µ–π –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —á–∏—Å–ª–æ–≤–æ–≥–æ `weight` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–±—Ä–∞. –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è `weight` –Ω–∞ –≤—Å–µ—Ö —ç—Ç–∞–ø–∞—Ö —Å–æ–∑–¥–∞–Ω–∏—è –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä—ë–±–µ—Ä –≤ –≥—Ä–∞—Ñ.

## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –ù–æ–≤—ã–π –º–µ—Ç–æ–¥ `calculateWeightWithValidation` –≤ RouteGraphBuilder

**–§–∞–π–ª:** `backend/src/application/route-builder/RouteGraphBuilder.ts`

**–ú–µ—Ç–æ–¥:** `calculateWeightWithValidation()`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è weight —Å –≥–∞—Ä–∞–Ω—Ç–∏–µ–π –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —á–∏—Å–ª–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
- –ü—Ä–∞–≤–∏–ª–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è weight:
  1. –î–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤: weight = duration –≤ –º–∏–Ω—É—Ç–∞—Ö (–∏–∑ —Ä–µ–π—Å–æ–≤ –∏–ª–∏ segment.estimatedDuration)
  2. –ï—Å–ª–∏ duration –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Äî weight = cost (–∏–∑ segment.basePrice)
  3. –ï—Å–ª–∏ cost –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Äî weight = 60 (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤)
  4. weight –≤—Å–µ–≥–¥–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º > 0
- –ï—Å–ª–∏ —Ä–µ–±—Ä–æ —Å–æ–¥–µ—Ä–∂–∏—Ç –º–∞—Å—Å–∏–≤ —Ä–µ–π—Å–æ–≤, –±–µ—Ä—ë—Ç—Å—è –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π duration —Å—Ä–µ–¥–∏ —Ä–µ–π—Å–æ–≤
- –ï—Å–ª–∏ –≤ —Ä–µ–π—Å–∞—Ö –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–∞–∑—É–º–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (60 –º–∏–Ω—É—Ç)

**–ö–æ–¥:**
```typescript
private calculateWeightWithValidation(
  segment: RouteSegment,
  flights: IAvailableFlight[],
  toOrder: number,
  fromOrder: number,
  fromStopId: string,
  toStopId: string
): number {
  // –®–∞–≥ 1: –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å duration –∏–∑ —Ä–µ–π—Å–æ–≤ (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π duration —Å—Ä–µ–¥–∏ –≤—Å–µ—Ö —Ä–µ–π—Å–æ–≤)
  let durationFromFlights: number | undefined = undefined;
  
  if (flights && flights.length > 0) {
    const durations: number[] = [];
    
    for (const flight of flights) {
      try {
        const depTime = new Date(flight.departureTime);
        const arrTime = new Date(flight.arrivalTime);
        const diffMinutes = Math.max(0, (arrTime.getTime() - depTime.getTime()) / (1000 * 60));
        
        if (!isNaN(diffMinutes) && diffMinutes > 0 && diffMinutes < 10000) {
          durations.push(diffMinutes);
        }
      } catch (error) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞—Ç—ã
        continue;
      }
    }
    
    if (durations.length > 0) {
      durationFromFlights = Math.min(...durations);
    }
  }
  
  // –®–∞–≥ 2: –ò—Å–ø–æ–ª—å–∑—É–µ–º duration –∏–∑ —Ä–µ–π—Å–æ–≤, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω
  if (durationFromFlights !== undefined && durationFromFlights > 0) {
    return Math.round(durationFromFlights);
  }
  
  // –®–∞–≥ 3: –ò—Å–ø–æ–ª—å–∑—É–µ–º segment.estimatedDuration, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω
  if (segment.estimatedDuration !== undefined && segment.estimatedDuration > 0) {
    return Math.round(segment.estimatedDuration);
  }
  
  // –®–∞–≥ 4: –ò—Å–ø–æ–ª—å–∑—É–µ–º cost (basePrice), –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω
  if (segment.basePrice !== undefined && segment.basePrice > 0) {
    const weight = Math.round(segment.basePrice / 1000 * 60);
    return Math.max(1, weight); // –ú–∏–Ω–∏–º—É–º 1 –º–∏–Ω—É—Ç–∞
  }
  
  // –®–∞–≥ 5: –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤ (60 –º–∏–Ω—É—Ç)
  const isVirtualRoute = segment.routeId?.startsWith('virtual-route-') === true;
  if (isVirtualRoute) {
    return 60; // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤
  }
  
  // –®–∞–≥ 6: –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–∞–∑—É–º–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (60 –º–∏–Ω—É—Ç) –¥–ª—è –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤
  return 60;
}
```

**–ì–∞—Ä–∞–Ω—Ç–∏–∏:**
- ‚úÖ –í—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —á–∏—Å–ª–æ > 0
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π duration –∏–∑ —Ä–µ–π—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤
- ‚úÖ –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ 60 –º–∏–Ω—É—Ç –¥–ª—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞

### 2. –ú–µ—Ç–æ–¥ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ `isValidWeight` –≤ RouteGraphBuilder

**–§–∞–π–ª:** `backend/src/application/route-builder/RouteGraphBuilder.ts`

**–ú–µ—Ç–æ–¥:** `isValidWeight()`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ weight –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º —Ä–µ–±—Ä–∞
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ weight —è–≤–ª—è–µ—Ç—Å—è —á–∏—Å–ª–æ–º, –Ω–µ NaN, –Ω–µ —Å—Ç—Ä–æ–∫–æ–π, –Ω–µ null –∏ > 0

**–ö–æ–¥:**
```typescript
private isValidWeight(weight: any): weight is number {
  if (typeof weight !== 'number') {
    console.log(`[RouteGraphBuilder.isValidWeight] ‚ùå Weight –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —á–∏—Å–ª–æ–º: type=${typeof weight}, value=${weight}`);
    return false;
  }
  
  if (isNaN(weight)) {
    console.log(`[RouteGraphBuilder.isValidWeight] ‚ùå Weight —è–≤–ª—è–µ—Ç—Å—è NaN: ${weight}`);
    return false;
  }
  
  if (!isFinite(weight)) {
    console.log(`[RouteGraphBuilder.isValidWeight] ‚ùå Weight –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∫–æ–Ω–µ—á–Ω—ã–º —á–∏—Å–ª–æ–º: ${weight}`);
    return false;
  }
  
  if (weight <= 0) {
    console.log(`[RouteGraphBuilder.isValidWeight] ‚ùå Weight –Ω–µ–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π: ${weight}`);
    return false;
  }
  
  return true;
}
```

**–ì–∞—Ä–∞–Ω—Ç–∏–∏:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ weight (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å number)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ NaN
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–æ–Ω–µ—á–Ω–æ—Å—Ç—å —á–∏—Å–ª–∞
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (> 0)

### 3. –í–∞–ª–∏–¥–∞—Ü–∏—è weight –≤ RouteGraphBuilder.buildFromDataset

**–§–∞–π–ª:** `backend/src/application/route-builder/RouteGraphBuilder.ts`

**–ú–µ—Ç–æ–¥:** `buildFromDataset()`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –í—ã–∑–æ–≤ `calculateWeightWithValidation` –≤–º–µ—Å—Ç–æ `calculateWeight`
- –í–∞–ª–∏–¥–∞—Ü–∏—è weight –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º —Ä–µ–±—Ä–∞
- –ü—Ä–æ–ø—É—Å–∫ —Ä—ë–±–µ—Ä —Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º weight

**–ö–æ–¥:**
```typescript
// –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –í—ã—á–∏—Å–ª—è–µ–º –≤–µ—Å —Ä–µ–±—Ä–∞ —Å –≥–∞—Ä–∞–Ω—Ç–∏–µ–π –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —á–∏—Å–ª–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
const weight = this.calculateWeightWithValidation(
  segment,
  availableFlights,
  i + 1,
  i,
  fromStopId,
  toStopId
);

// –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –í–∞–ª–∏–¥–∞—Ü–∏—è weight –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º —Ä–µ–±—Ä–∞
if (!this.isValidWeight(weight)) {
  console.log(`[RouteGraphBuilder] ‚ùå –û–®–ò–ë–ö–ê: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π weight=${weight} –¥–ª—è —Ä–µ–±—Ä–∞ ${fromStopId} -> ${toStopId}, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Ä–µ–±—Ä–æ`);
  continue;
}
```

**–ì–∞—Ä–∞–Ω—Ç–∏–∏:**
- ‚úÖ –í—Å–µ —Ä—ë–±—Ä–∞ –∏–º–µ—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π weight –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º
- ‚úÖ –†—ë–±—Ä–∞ —Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º weight –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–ø—É—â–µ–Ω–Ω–æ–≥–æ —Ä–µ–±—Ä–∞

### 4. –í–∞–ª–∏–¥–∞—Ü–∏—è weight –≤ RouteGraph.addEdge

**–§–∞–π–ª:** `backend/src/application/route-builder/RouteGraph.ts`

**–ú–µ—Ç–æ–¥:** `addEdge()`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è weight –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º —Ä–µ–±—Ä–∞ –≤ –≥—Ä–∞—Ñ
- –†—ë–±—Ä–∞ —Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º weight –Ω–µ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –≥—Ä–∞—Ñ

**–ö–æ–¥:**
```typescript
addEdge(edge: IRouteEdge): void {
  // –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –í–∞–ª–∏–¥–∞—Ü–∏—è weight –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º —Ä–µ–±—Ä–∞
  if (!this.isValidWeight(edge.weight)) {
    console.log(`[RouteGraph.addEdge] ‚ùå –û–®–ò–ë–ö–ê: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π weight=${edge.weight} –¥–ª—è —Ä–µ–±—Ä–∞ ${edge.fromStopId} -> ${edge.toStopId}! –†–µ–±—Ä–æ –ù–ï –¥–æ–±–∞–≤–ª–µ–Ω–æ.`);
    console.log(`[RouteGraph.addEdge] –¢–∏–ø weight: ${typeof edge.weight}, –∑–Ω–∞—á–µ–Ω–∏–µ: ${edge.weight}`);
    return; // –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º —Ä–µ–±—Ä–æ, –µ—Å–ª–∏ weight –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π
  }
  
  // ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–µ–±—Ä–∞
}
```

**–ì–∞—Ä–∞–Ω—Ç–∏–∏:**
- ‚úÖ –í—Å–µ —Ä—ë–±—Ä–∞ –≤ –≥—Ä–∞—Ñ–µ –∏–º–µ—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π weight
- ‚úÖ –†—ë–±—Ä–∞ —Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º weight –Ω–µ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ—Ç–∫–ª–æ–Ω—ë–Ω–Ω–æ–≥–æ —Ä–µ–±—Ä–∞

### 5. –ú–µ—Ç–æ–¥ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ `isValidWeight` –≤ RouteGraph

**–§–∞–π–ª:** `backend/src/application/route-builder/RouteGraph.ts`

**–ú–µ—Ç–æ–¥:** `isValidWeight()`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ weight –≤ RouteGraph
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `addEdge()` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ weight –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º

**–ö–æ–¥:**
```typescript
private isValidWeight(weight: any): weight is number {
  if (typeof weight !== 'number') {
    return false;
  }
  
  if (isNaN(weight)) {
    return false;
  }
  
  if (!isFinite(weight)) {
    return false;
  }
  
  if (weight <= 0) {
    return false;
  }
  
  return true;
}
```

**–ì–∞—Ä–∞–Ω—Ç–∏–∏:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ weight (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å number)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ NaN
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–æ–Ω–µ—á–Ω–æ—Å—Ç—å —á–∏—Å–ª–∞
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (> 0)

### 6. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞ `updateFromDataset` –≤ RouteGraph

**–§–∞–π–ª:** `backend/src/application/route-builder/RouteGraph.ts`

**–ú–µ—Ç–æ–¥:** `updateFromDataset()`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π duration –∏–∑ —Ä–µ–π—Å–æ–≤ –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è weight
- –í–∞–ª–∏–¥–∞—Ü–∏—è weight –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º —Ä–µ–±—Ä–∞
- –ü—Ä–æ–ø—É—Å–∫ —Ä—ë–±–µ—Ä —Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º weight

**–ö–æ–¥:**
```typescript
// –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –í—ã—á–∏—Å–ª—è–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–∑ —Ä–µ–π—Å–æ–≤
let minDuration: number | undefined = undefined;
let avgDurationMinutes = 0;

if (routeFlights.length > 0) {
  const durations: number[] = [];
  for (const flight of routeFlights) {
    try {
      const departureTime = new Date(flight.departureTime);
      const arrivalTime = new Date(flight.arrivalTime);
      const diffMinutes = Math.max(0, (arrivalTime.getTime() - departureTime.getTime()) / (1000 * 60));
      if (!isNaN(diffMinutes) && diffMinutes > 0 && diffMinutes < 10000) {
        durations.push(diffMinutes);
      }
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞—Ç—ã
    }
  }
  if (durations.length > 0) {
    minDuration = Math.min(...durations);
    avgDurationMinutes = Math.round(durations.reduce((sum, d) => sum + d, 0) / durations.length);
  }
}

// –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –í—ã—á–∏—Å–ª—è–µ–º weight —Å –≥–∞—Ä–∞–Ω—Ç–∏–µ–π –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —á–∏—Å–ª–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
let weight: number;

// –®–∞–≥ 1: –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π duration –∏–∑ —Ä–µ–π—Å–æ–≤, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω
if (minDuration !== undefined && minDuration > 0) {
  weight = Math.round(minDuration);
}
// –®–∞–≥ 2: –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ä–µ–¥–Ω–∏–π duration, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω
else if (avgDurationMinutes > 0) {
  weight = Math.round(avgDurationMinutes);
}
// –®–∞–≥ 3: –û—Ü–µ–Ω–∏–≤–∞–µ–º –≤—Ä–µ–º—è –≤ –ø—É—Ç–∏ –ø–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—é (–ø—Ä–∏–º–µ—Ä–Ω–æ 60 –∫–º/—á)
else if (distance > 0) {
  weight = Math.round((distance / 60) * 60);
  weight = Math.max(1, weight);
}
// –®–∞–≥ 4: –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤ (60 –º–∏–Ω—É—Ç)
else {
  weight = 60;
}

// –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ weight > 0
weight = Math.max(1, weight);

// –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –í–∞–ª–∏–¥–∞—Ü–∏—è weight –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º —Ä–µ–±—Ä–∞
if (!this.isValidWeight(weight)) {
  console.log(`[RouteGraph.updateFromDataset] ‚ùå –û–®–ò–ë–ö–ê: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π weight=${weight} –¥–ª—è —Ä–µ–±—Ä–∞ ${fromStopId} -> ${toStopId}, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Ä–µ–±—Ä–æ`);
  continue;
}
```

**–ì–∞—Ä–∞–Ω—Ç–∏–∏:**
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π duration –∏–∑ —Ä–µ–π—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è weight
- ‚úÖ –í—Å–µ —Ä—ë–±—Ä–∞ –∏–º–µ—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π weight –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º
- ‚úÖ –†—ë–±—Ä–∞ —Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º weight –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è

### 7. –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–µ—Å–æ–≤ —Ä—ë–±–µ—Ä

**–§–∞–π–ª:** `backend/src/application/route-builder/RouteGraphBuilder.ts`

**–ú–µ—Ç–æ–¥:** `logEdgeWeightsDiagnostics()`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤–µ—Å–æ–≤ —Ä—ë–±–µ—Ä
- –í—ã–≤–æ–¥–∏—Ç:
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—ë–±–µ—Ä —Å–æ —Å—Ç–∞–±–∏–ª—å–Ω—ã–º weight
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—ë–±–µ—Ä, –≥–¥–µ –ø—Ä–∏—à–ª–æ—Å—å –ø—Ä–æ—Å—Ç–∞–≤–∏—Ç—å —Ñ–∏–∫—Ç–∏–≤–Ω—ã–π weight = 60
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö/–æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ä—ë–±–µ—Ä (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 0)
- –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∞

**–ö–æ–¥:**
```typescript
private logEdgeWeightsDiagnostics(graph: RouteGraph): void {
  const allEdges: Array<{ fromStopId: string; toStopId: string; weight: number; routeId: string }> = [];
  
  // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —Ä—ë–±—Ä–∞ –∏–∑ –≥—Ä–∞—Ñ–∞
  const allNodes = graph.getAllNodes();
  for (const node of allNodes) {
    const edges = graph.getEdgesFrom(node.stopId);
    for (const edge of edges) {
      allEdges.push({
        fromStopId: edge.fromStopId,
        toStopId: edge.toStopId,
        weight: edge.weight,
        routeId: edge.segment.routeId
      });
    }
  }
  
  // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –≤–µ—Å–∞
  let edgesWithStableWeight = 0;
  let edgesWithDefaultWeight = 0;
  let edgesWithInvalidWeight = 0;
  
  for (const edge of allEdges) {
    if (typeof edge.weight !== 'number' || isNaN(edge.weight) || !isFinite(edge.weight) || edge.weight <= 0) {
      edgesWithInvalidWeight++;
      console.log(`[RouteGraphBuilder.logEdgeWeightsDiagnostics] ‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π weight: ${edge.weight} –¥–ª—è —Ä–µ–±—Ä–∞ ${edge.fromStopId} -> ${edge.toStopId} (routeId: ${edge.routeId})`);
    } else if (edge.weight === 60) {
      edgesWithDefaultWeight++;
    } else {
      edgesWithStableWeight++;
    }
  }
  
  console.log(`[RouteGraphBuilder.logEdgeWeightsDiagnostics] üìä –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤–µ—Å–æ–≤ —Ä—ë–±–µ—Ä:`);
  console.log(`[RouteGraphBuilder.logEdgeWeightsDiagnostics]   - –í—Å–µ–≥–æ —Ä—ë–±–µ—Ä: ${allEdges.length}`);
  console.log(`[RouteGraphBuilder.logEdgeWeightsDiagnostics]   - –†—ë–±–µ—Ä —Å–æ —Å—Ç–∞–±–∏–ª—å–Ω—ã–º weight: ${edgesWithStableWeight}`);
  console.log(`[RouteGraphBuilder.logEdgeWeightsDiagnostics]   - –†—ë–±–µ—Ä —Å —Ñ–∏–∫—Ç–∏–≤–Ω—ã–º weight=60: ${edgesWithDefaultWeight}`);
  console.log(`[RouteGraphBuilder.logEdgeWeightsDiagnostics]   - –†—ë–±–µ—Ä —Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º weight: ${edgesWithInvalidWeight}`);
  
  if (edgesWithInvalidWeight > 0) {
    console.log(`[RouteGraphBuilder.logEdgeWeightsDiagnostics] ‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –ù–∞–π–¥–µ–Ω–æ ${edgesWithInvalidWeight} —Ä—ë–±–µ—Ä —Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º weight!`);
  } else {
    console.log(`[RouteGraphBuilder.logEdgeWeightsDiagnostics] ‚úÖ –í—Å–µ —Ä—ë–±—Ä–∞ –∏–º–µ—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π weight`);
  }
}
```

**–ì–∞—Ä–∞–Ω—Ç–∏–∏:**
- ‚úÖ –ü–æ–ª–Ω–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –≤–µ—Å–æ–≤ —Ä—ë–±–µ—Ä
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–±—Ä–∞
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–µ—Å–æ–≤ —Ä—ë–±–µ—Ä

## –ì–∞—Ä–∞–Ω—Ç–∏–∏ —Å–∏—Å—Ç–µ–º—ã

### ‚úÖ –ö–∞–∂–¥–æ–µ —Ä–µ–±—Ä–æ –∏–º–µ–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —á–∏—Å–ª–æ–≤–æ–π weight

- –í—Å–µ —Ä—ë–±—Ä–∞ –∏–º–µ—é—Ç weight, –∫–æ—Ç–æ—Ä—ã–π —è–≤–ª—è–µ—Ç—Å—è —á–∏—Å–ª–æ–º > 0
- –ù–∏ –æ–¥–Ω–æ —Ä–µ–±—Ä–æ –Ω–µ –∏–º–µ–µ—Ç `undefined`, `null`, `NaN`, —Å—Ç—Ä–æ–∫–æ–≤—ã–π weight –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–µ–µ –ø–æ–ª–µ
- Weight –≤—Å–µ–≥–¥–∞ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º:
  1. –î–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤: weight = duration –≤ –º–∏–Ω—É—Ç–∞—Ö (–∏–∑ —Ä–µ–π—Å–æ–≤ –∏–ª–∏ segment.estimatedDuration)
  2. –ï—Å–ª–∏ duration –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Äî weight = cost (–∏–∑ segment.basePrice)
  3. –ï—Å–ª–∏ cost –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Äî weight = 60 (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤)

### ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è weight –Ω–∞ –≤—Å–µ—Ö —ç—Ç–∞–ø–∞—Ö

- –í–∞–ª–∏–¥–∞—Ü–∏—è weight –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º —Ä–µ–±—Ä–∞ –≤ `RouteGraphBuilder`
- –í–∞–ª–∏–¥–∞—Ü–∏—è weight –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º —Ä–µ–±—Ä–∞ –≤ –≥—Ä–∞—Ñ –≤ `RouteGraph.addEdge`
- –í–∞–ª–∏–¥–∞—Ü–∏—è weight –≤ –º–µ—Ç–æ–¥–µ `updateFromDataset`

### ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π duration –∏–∑ —Ä–µ–π—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è weight

- –ï—Å–ª–∏ —Ä–µ–±—Ä–æ —Å–æ–¥–µ—Ä–∂–∏—Ç –º–∞—Å—Å–∏–≤ —Ä–µ–π—Å–æ–≤, –±–µ—Ä—ë—Ç—Å—è –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π duration —Å—Ä–µ–¥–∏ —Ä–µ–π—Å–æ–≤
- –ï—Å–ª–∏ –≤ —Ä–µ–π—Å–∞—Ö –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–∞–∑—É–º–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (60 –º–∏–Ω—É—Ç)

### ‚úÖ –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–µ—Å–æ–≤ —Ä—ë–±–µ—Ä

- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—ë–±–µ—Ä —Å–æ —Å—Ç–∞–±–∏–ª—å–Ω—ã–º weight
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—ë–±–µ—Ä, –≥–¥–µ –ø—Ä–∏—à–ª–æ—Å—å –ø—Ä–æ—Å—Ç–∞–≤–∏—Ç—å —Ñ–∏–∫—Ç–∏–≤–Ω—ã–π weight = 60
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö/–æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ä—ë–±–µ—Ä (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 0)

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ü—Ä–∏–º–µ—Ä—ã –ø–∞—Ä –≥–æ—Ä–æ–¥–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

1. **–Ø–∫—É—Ç—Å–∫ ‚Üí –û–ª—ë–∫–º–∏–Ω—Å–∫**: –†–µ–∞–ª—å–Ω—ã–π ‚Üí –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π
2. **–õ–µ–Ω—Å–∫ ‚Üí –Ø–∫—É—Ç—Å–∫**: –†–µ–∞–ª—å–Ω—ã–π ‚Üí –†–µ–∞–ª—å–Ω—ã–π
3. **–í–µ—Ä—Ö–æ—è–Ω—Å–∫ ‚Üí –ñ–∏–≥–∞–Ω—Å–∫**: –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π ‚Üí –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π
4. **–ê–º–≥–∞ ‚Üí –¢–∏–∫—Å–∏**: –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π ‚Üí –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π
5. **–ú–∏—Ä–Ω—ã–π ‚Üí –û–ª—ë–∫–º–∏–Ω—Å–∫**: –†–µ–∞–ª—å–Ω—ã–π ‚Üí –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π

### –û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:

```
[RouteGraphBuilder.calculateWeightWithValidation] –ù–∞–π–¥–µ–Ω duration –∏–∑ —Ä–µ–π—Å–æ–≤: 180 –º–∏–Ω—É—Ç –¥–ª—è ... -> ...
[RouteGraphBuilder.calculateWeightWithValidation] ‚úÖ Weight –∏–∑ duration —Ä–µ–π—Å–æ–≤: 180 –¥–ª—è ... -> ...
[RouteGraphBuilder.logEdgeWeightsDiagnostics] üìä –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤–µ—Å–æ–≤ —Ä—ë–±–µ—Ä:
[RouteGraphBuilder.logEdgeWeightsDiagnostics]   - –í—Å–µ–≥–æ —Ä—ë–±–µ—Ä: N
[RouteGraphBuilder.logEdgeWeightsDiagnostics]   - –†—ë–±–µ—Ä —Å–æ —Å—Ç–∞–±–∏–ª—å–Ω—ã–º weight: M
[RouteGraphBuilder.logEdgeWeightsDiagnostics]   - –†—ë–±–µ—Ä —Å —Ñ–∏–∫—Ç–∏–≤–Ω—ã–º weight=60: K
[RouteGraphBuilder.logEdgeWeightsDiagnostics]   - –†—ë–±–µ—Ä —Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º weight: 0
[RouteGraphBuilder.logEdgeWeightsDiagnostics] ‚úÖ –í—Å–µ —Ä—ë–±—Ä–∞ –∏–º–µ—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π weight
[PathFinder] ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ "...": Infinity -> X (—á–µ—Ä–µ–∑ "...")
```

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:

- ‚úÖ –í—Å–µ —Ä—ë–±—Ä–∞ –∏–º–µ—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —á–∏—Å–ª–æ–≤–æ–π weight > 0
- ‚úÖ PathFinder –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —á–∏—Å–ª–æ–≤—ã–µ –≤–µ—Å–∞
- ‚úÖ PathFinder —Å—É–º–º–∏—Ä—É–µ—Ç –≤–µ—Å–∞ –∏ –≤—ã–±–∏—Ä–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π —É–∑–µ–ª
- ‚úÖ –ú–∞—Ä—à—Ä—É—Ç—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –¥–ª—è –ª—é–±–æ–π –ø–∞—Ä—ã –≥–æ—Ä–æ–¥–æ–≤
- ‚úÖ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 0 —Ä—ë–±–µ—Ä —Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º weight

## –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–∏—Å—Ç–µ–º–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç:

- ‚úÖ **–ö–∞–∂–¥–æ–µ —Ä–µ–±—Ä–æ –∏–º–µ–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —á–∏—Å–ª–æ–≤–æ–π weight**: –í—Å–µ —Ä—ë–±—Ä–∞ –∏–º–µ—é—Ç weight, –∫–æ—Ç–æ—Ä—ã–π —è–≤–ª—è–µ—Ç—Å—è —á–∏—Å–ª–æ–º > 0
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è weight –Ω–∞ –≤—Å–µ—Ö —ç—Ç–∞–ø–∞—Ö**: –í–∞–ª–∏–¥–∞—Ü–∏—è weight –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º —Ä–µ–±—Ä–∞ –∏ –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –≤ –≥—Ä–∞—Ñ
- ‚úÖ **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π duration –∏–∑ —Ä–µ–π—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è weight**: –ï—Å–ª–∏ —Ä–µ–±—Ä–æ —Å–æ–¥–µ—Ä–∂–∏—Ç –º–∞—Å—Å–∏–≤ —Ä–µ–π—Å–æ–≤, –±–µ—Ä—ë—Ç—Å—è –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π duration —Å—Ä–µ–¥–∏ —Ä–µ–π—Å–æ–≤
- ‚úÖ **–î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–µ—Å–æ–≤ —Ä—ë–±–µ—Ä**: –ü–æ–ª–Ω–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –≤–µ—Å–æ–≤ —Ä—ë–±–µ—Ä —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–æ–π

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

1. `backend/src/application/route-builder/RouteGraphBuilder.ts`:
   - –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `calculateWeightWithValidation()` –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è weight —Å –≥–∞—Ä–∞–Ω—Ç–∏–µ–π –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —á–∏—Å–ª–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
   - –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `isValidWeight()` –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ weight
   - –û–±–Ω–æ–≤–ª—ë–Ω –º–µ—Ç–æ–¥ `buildFromDataset()` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `calculateWeightWithValidation` –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ weight
   - –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `logEdgeWeightsDiagnostics()` –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤–µ—Å–æ–≤ —Ä—ë–±–µ—Ä

2. `backend/src/application/route-builder/RouteGraph.ts`:
   - –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `isValidWeight()` –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ weight
   - –û–±–Ω–æ–≤–ª—ë–Ω –º–µ—Ç–æ–¥ `addEdge()` –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ weight –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º —Ä–µ–±—Ä–∞
   - –û–±–Ω–æ–≤–ª—ë–Ω –º–µ—Ç–æ–¥ `updateFromDataset()` –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è weight —Å –≥–∞—Ä–∞–Ω—Ç–∏–µ–π –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —á–∏—Å–ª–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è

## –ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

‚úÖ **PathFinder –¥–æ–ª–∂–µ–Ω:**
- –í–∏–¥–µ—Ç—å —Ç–æ–ª—å–∫–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —á–∏—Å–ª–æ–≤—ã–µ –≤–µ—Å–∞
- –°—É–º–º–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å–∞ –∏ –≤—ã–±–∏—Ä–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π —É–∑–µ–ª
- –û–±–Ω–æ–≤–ª—è—Ç—å —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (–Ω–µ Infinity)
- –ù–∞—Ö–æ–¥–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è –ª—é–±–æ–π –ø–∞—Ä—ã –≥–æ—Ä–æ–¥–æ–≤

‚úÖ **–õ–æ–≥–∏ –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å:**
- "‚úÖ Weight –∏–∑ duration —Ä–µ–π—Å–æ–≤: X –¥–ª—è ... -> ..."
- "‚úÖ –í—Å–µ —Ä—ë–±—Ä–∞ –∏–º–µ—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π weight"
- "–†—ë–±–µ—Ä —Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º weight: 0"
- "‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ ...: Infinity -> X"

‚úÖ **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å:**
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—ë–±–µ—Ä —Å–æ —Å—Ç–∞–±–∏–ª—å–Ω—ã–º weight > 0
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—ë–±–µ—Ä —Å —Ñ–∏–∫—Ç–∏–≤–Ω—ã–º weight = 60
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—ë–±–µ—Ä —Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º weight = 0


