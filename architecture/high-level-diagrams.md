# High-Level Architecture Diagrams (C4 Model)

## 1. System Context Diagram (Level 1)

**Описание:** Высокоуровневое представление системы и её взаимодействия с внешними пользователями и системами.

```
┌─────────────────────────────────────────────────────────────────┐
│                         SYSTEM CONTEXT                          │
└─────────────────────────────────────────────────────────────────┘

                    ┌──────────────┐
                    │   User       │
                    │  (Browser)   │
                    └──────┬───────┘
                           │
                           │ HTTPS
                           │
         ┌─────────────────▼─────────────────┐
         │                                   │
         │      Travel App SaaS              │
         │      (MVP)                        │
         │                                   │
         └─────────────────┬─────────────────┘
                           │
                           │
        ┌──────────────────┼──────────────────┐
        │                  │                  │
        │                  │                  │
┌───────▼──────┐  ┌────────▼────────┐  ┌─────▼──────┐
│   Frontend   │  │   Backend API   │  │  MinIO     │
│   (React)    │  │   (Node.js)     │  │  (S3)      │
│   Port: 3000 │  │   Port: 5000    │  │  Port: 9000│
└──────────────┘  └────────┬────────┘  └────────────┘
                            │
                            │
                    ┌───────▼───────┐
                    │  PostgreSQL   │
                    │  Port: 5432   │
                    └──────────────┘
```

**Компоненты:**
- **User** — Пользователь (браузер)
- **Frontend** — React приложение
- **Backend API** — Node.js сервер
- **PostgreSQL** — База данных
- **MinIO** — S3-совместимое хранилище

---

## 2. Container Diagram (Level 2)

**Описание:** Детальное представление контейнеров (приложений) и их взаимодействия.

```
┌─────────────────────────────────────────────────────────────────┐
│                        CONTAINER DIAGRAM                         │
└─────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────┐
│                         Frontend Container                       │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │  React Application (Port: 3000)                           │  │
│  │                                                            │  │
│  │  Components:                                              │  │
│  │  - Route Search                                           │  │
│  │  - Route Details                                          │  │
│  │  - Map Component                                          │  │
│  │  - Order Form                                             │  │
│  │  - Assistant Chat                                         │  │
│  │  - User Profile                                           │  │
│  │                                                            │  │
│  │  State Management:                                        │  │
│  │  - React Query (API cache)                                │  │
│  │  - Context API (UI state)                                 │  │
│  └────────────────────────────────────────────────────────────┘  │
└────────────────────────────┬──────────────────────────────────────┘
                             │
                             │ HTTP/REST
                             │ JWT Token
                             │
┌────────────────────────────▼──────────────────────────────────────┐
│                      Backend API Container                        │
│  ┌────────────────────────────────────────────────────────────┐   │
│  │  Node.js Application (Port: 5000)                         │   │
│  │                                                            │   │
│  │  ┌────────────────────────────────────────────────────┐   │   │
│  │  │  Presentation Layer                                 │   │   │
│  │  │  - REST API Endpoints                               │   │   │
│  │  │  - Middleware (Auth, Validation, Error Handling)   │   │   │
│  │  └────────────────────┬───────────────────────────────┘   │   │
│  │                        │                                   │   │
│  │  ┌────────────────────▼───────────────────────────────┐   │   │
│  │  │  Application Layer                                   │   │   │
│  │  │  - Use Cases (Commands/Queries)                      │   │   │
│  │  │  - CQRS Pattern                                      │   │   │
│  │  │  - Pipeline Behaviors                                │   │   │
│  │  └────────────────────┬───────────────────────────────┘   │   │
│  │                        │                                   │   │
│  │  ┌────────────────────▼───────────────────────────────┐   │   │
│  │  │  Domain Layer                                       │   │   │
│  │  │  - Entities                                          │   │   │
│  │  │  - Value Objects                                     │   │   │
│  │  │  - Domain Events                                     │   │   │
│  │  └────────────────────┬───────────────────────────────┘   │   │
│  │                        │                                   │   │
│  │  ┌────────────────────▼───────────────────────────────┐   │   │
│  │  │  Infrastructure Layer                               │   │   │
│  │  │  - PostgreSQL Repository                             │   │   │
│  │  │  - MinIO Client                                     │   │   │
│  │  │  - Mock Data Reader                                 │   │   │
│  │  └────────────────────────────────────────────────────┘   │   │
│  └────────────────────────────────────────────────────────────┘   │
└────────────┬───────────────────────────────┬──────────────────────┘
             │                               │
             │ SQL                            │ S3 API
             │                                │
┌────────────▼──────────┐      ┌─────────────▼──────────┐
│  PostgreSQL Container │      │   MinIO Container      │
│  ┌──────────────────┐  │      │  ┌─────────────────┐  │
│  │  Database        │  │      │  │  S3 Bucket      │  │
│  │  - users         │  │      │  │  - icons/       │  │
│  │  - orders        │  │      │  │  - images/      │  │
│  │  - services      │  │      │  │  - maps/        │  │
│  │  Port: 5432      │  │      │  │  Port: 9000     │  │
│  └──────────────────┘  │      │  └─────────────────┘  │
└─────────────────────────┘      └───────────────────────┘
```

**Взаимодействия:**
- Frontend → Backend: HTTP/REST API, JWT токены
- Backend → PostgreSQL: SQL запросы
- Backend → MinIO: S3 API (GET/PUT)
- Backend → Mock Files: Чтение JSON файлов

---

## 3. Component Diagram - Backend (Level 3)

**Описание:** Детальная структура компонентов Backend API.

```
┌─────────────────────────────────────────────────────────────────┐
│              BACKEND COMPONENT DIAGRAM (Clean Architecture)      │
└─────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────┐
│                      PRESENTATION LAYER                           │
│  ┌────────────────────────────────────────────────────────────┐   │
│  │  API Controllers                                           │   │
│  │  - AuthController (register, login, logout)                │   │
│  │  - RoutesController (search, get, map)                     │   │
│  │  - OrdersController (create, list, get, cancel)            │   │
│  │  - AssistantController (chat, weather, risk)               │   │
│  │  - AttractionsController (list, get)                       │   │
│  │  - EventsController (list, get)                            │   │
│  │  - UsersController (profile, avatar)                       │   │
│  └────────────────────┬───────────────────────────────────────┘   │
│                       │                                             │
│  ┌────────────────────▼───────────────────────────────────────┐   │
│  │  Middleware                                                 │   │
│  │  - AuthMiddleware (JWT validation)                         │   │
│  │  - ValidationMiddleware (request validation)                │   │
│  │  - ErrorHandlingMiddleware (global error handler)           │   │
│  │  - LoggingMiddleware (request logging)                      │   │
│  └────────────────────────────────────────────────────────────┘   │
└────────────────────────────┬───────────────────────────────────────┘
                              │
                              │ Uses
                              │
┌─────────────────────────────▼──────────────────────────────────────┐
│                      APPLICATION LAYER                              │
│  ┌────────────────────────────────────────────────────────────┐   │
│  │  Use Cases (Commands)                                       │   │
│  │  - RegisterUserCommand                                      │   │
│  │  - LoginUserCommand                                         │   │
│  │  - CreateOrderCommand                                       │   │
│  │  - CancelOrderCommand                                       │   │
│  │  - UploadAvatarCommand                                      │   │
│  └────────────────────┬───────────────────────────────────────┘   │
│                       │                                             │
│  ┌────────────────────▼───────────────────────────────────────┐   │
│  │  Use Cases (Queries)                                       │   │
│  │  - SearchRoutesQuery                                       │   │
│  │  - GetRouteQuery                                           │   │
│  │  - GetRouteMapQuery                                        │   │
│  │  - GetOrdersQuery                                          │   │
│  │  - GetUserProfileQuery                                     │   │
│  │  - ChatWithAssistantQuery                                  │   │
│  └────────────────────┬───────────────────────────────────────┘   │
│                       │                                             │
│  ┌────────────────────▼───────────────────────────────────────┐   │
│  │  Pipeline Behaviors                                        │   │
│  │  - ValidationBehavior                                       │   │
│  │  - LoggingBehavior                                         │   │
│  │  - AuditingBehavior                                        │   │
│  │  - ErrorHandlingBehavior                                   │   │
│  └────────────────────────────────────────────────────────────┘   │
└────────────────────────────┬───────────────────────────────────────┘
                              │
                              │ Uses
                              │
┌─────────────────────────────▼──────────────────────────────────────┐
│                        DOMAIN LAYER                                 │
│  ┌────────────────────────────────────────────────────────────┐   │
│  │  Entities                                                    │   │
│  │  - User                                                      │   │
│  │  - Order                                                     │   │
│  │  - OrderPassenger                                            │   │
│  │  - OrderService                                              │   │
│  └────────────────────┬───────────────────────────────────────┘   │
│                       │                                             │
│  ┌────────────────────▼───────────────────────────────────────┐   │
│  │  Value Objects                                              │   │
│  │  - Email                                                    │   │
│  │  - Price                                                    │   │
│  │  - Coordinates                                              │   │
│  └────────────────────┬───────────────────────────────────────┘   │
│                       │                                             │
│  ┌────────────────────▼───────────────────────────────────────┐   │
│  │  Domain Events                                              │   │
│  │  - OrderCreatedEvent                                        │   │
│  │  - OrderCancelledEvent                                      │   │
│  └────────────────────────────────────────────────────────────┘   │
└────────────────────────────┬───────────────────────────────────────┘
                              │
                              │ Implements
                              │
┌─────────────────────────────▼──────────────────────────────────────┐
│                    INFRASTRUCTURE LAYER                             │
│  ┌────────────────────────────────────────────────────────────┐   │
│  │  Repositories (Interfaces defined in Domain/Application)    │   │
│  │  - IUserRepository → UserRepository (PostgreSQL)           │   │
│  │  - IOrderRepository → OrderRepository (PostgreSQL)         │   │
│  └────────────────────┬───────────────────────────────────────┘   │
│                       │                                             │
│  ┌────────────────────▼───────────────────────────────────────┐   │
│  │  External Services                                          │   │
│  │  - IStorageService → MinIOStorageService                    │   │
│  │  - IMockDataService → MockDataService (JSON files)          │   │
│  └────────────────────┬───────────────────────────────────────┘   │
│                       │                                             │
│  ┌────────────────────▼───────────────────────────────────────┐   │
│  │  Infrastructure Services                                    │   │
│  │  - DatabaseConnection (PostgreSQL)                         │   │
│  │  - S3Client (MinIO)                                        │   │
│  │  - FileSystemService (Mock files)                         │   │
│  └────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────┘
```

**Зависимости:**
- Presentation → Application → Domain
- Infrastructure → Application → Domain
- Domain не зависит ни от чего

---

## 4. Data Flow Diagram

**Описание:** Потоки данных в системе.

```
┌─────────────────────────────────────────────────────────────────┐
│                        DATA FLOW DIAGRAM                          │
└─────────────────────────────────────────────────────────────────┘

┌──────────────┐
│   User       │
└──────┬───────┘
       │
       │ 1. Search Routes
       │
┌──────▼──────────────────────────────────────────────────────────┐
│  Frontend                                                         │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  Route Search Component                                    │ │
│  │  Input: from, to, date, passengers                        │ │
│  └────────────────────┬───────────────────────────────────────┘ │
└───────────────────────┼──────────────────────────────────────────┘
                        │
                        │ 2. GET /api/v1/routes/search
                        │
┌───────────────────────▼──────────────────────────────────────────┐
│  Backend API                                                      │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  RoutesController                                            │ │
│  │  → SearchRoutesQuery                                         │ │
│  │  → MockDataService.readRoutes()                             │ │
│  │  → MinIOStorageService.getIcons()                           │ │
│  └────────────────────┬───────────────────────────────────────┘ │
└───────────────────────┼──────────────────────────────────────────┘
                        │
        ┌───────────────┼───────────────┐
        │               │               │
        │ 3. Read       │ 4. Get        │
        │    Mock Data  │    Icons      │
        │               │               │
┌───────▼──────┐  ┌─────▼──────┐  ┌────▼──────┐
│  Mock Files  │  │   MinIO    │  │ PostgreSQL│
│  routes.json │  │  icons/    │  │  (users)  │
└──────────────┘  └────────────┘  └───────────┘
                        │
                        │ 5. Response
                        │
┌───────────────────────▼──────────────────────────────────────────┐
│  Frontend                                                         │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  Route List Component                                     │ │
│  │  Display: routes with icons                               │ │
│  └────────────────────┬───────────────────────────────────────┘ │
└───────────────────────┼──────────────────────────────────────────┘
                        │
                        │ 6. Display Results
                        │
┌───────────────────────▼──────┐
│   User                       │
│   (Views route list)         │
└──────────────────────────────┘
```

---

## 5. Deployment Diagram

**Описание:** Развертывание системы в Docker контейнерах.

```
┌─────────────────────────────────────────────────────────────────┐
│                      DEPLOYMENT DIAGRAM                           │
└─────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────┐
│                    Docker Host (Single Machine)                  │
│                                                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  Docker Network: travel-app-network                      │  │
│  │                                                            │  │
│  │  ┌──────────────────┐  ┌──────────────────┐              │  │
│  │  │  Frontend        │  │  Backend API     │              │  │
│  │  │  Container       │  │  Container       │              │  │
│  │  │                  │  │                  │              │  │
│  │  │  Image:          │  │  Image:           │              │  │
│  │  │  travel-app-     │  │  travel-app-      │              │  │
│  │  │  frontend:latest │  │  backend:latest   │              │  │
│  │  │                  │  │                  │              │  │
│  │  │  Ports:          │  │  Ports:           │              │  │
│  │  │  - 3000:3000     │  │  - 5000:5000     │              │  │
│  │  │                  │  │                  │              │  │
│  │  │  Volumes:        │  │  Volumes:         │              │  │
│  │  │  - ./frontend    │  │  - ./backend     │              │  │
│  │  │                  │  │  - ./data        │              │  │
│  │  └──────────────────┘  └────────┬───────────┘              │  │
│  │                                │                           │  │
│  │                                │                           │  │
│  │  ┌─────────────────────────────▼───────────┐              │  │
│  │  │  PostgreSQL Container                    │              │  │
│  │  │                                          │              │  │
│  │  │  Image: postgres:15                      │              │  │
│  │  │  Ports: 5432:5432                        │              │  │
│  │  │  Volumes:                                │              │  │
│  │  │  - postgres-data:/var/lib/postgresql/data │              │  │
│  │  │  Environment:                            │              │  │
│  │  │  - POSTGRES_DB=travel_app                │              │  │
│  │  │  - POSTGRES_USER=admin                   │              │  │
│  │  │  - POSTGRES_PASSWORD=***                 │              │  │
│  │  └──────────────────────────────────────────┘              │  │
│  │                                                            │  │
│  │  ┌──────────────────────────────────────────┐              │  │
│  │  │  MinIO Container                        │              │  │
│  │  │                                          │              │  │
│  │  │  Image: minio/minio:latest               │              │  │
│  │  │  Ports:                                  │              │  │
│  │  │  - 9000:9000 (API)                       │              │  │
│  │  │  - 9001:9001 (Console)                  │              │  │
│  │  │  Volumes:                                │              │  │
│  │  │  - minio-data:/data                     │              │  │
│  │  │  Environment:                            │              │  │
│  │  │  - MINIO_ROOT_USER=minioadmin            │              │  │
│  │  │  - MINIO_ROOT_PASSWORD=***               │              │  │
│  │  └──────────────────────────────────────────┘              │  │
│  └────────────────────────────────────────────────────────────┘  │
│                                                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  Docker Compose Configuration                            │  │
│  │  - docker-compose.yml                                     │  │
│  │  - .env                                                    │  │
│  └──────────────────────────────────────────────────────────┘  │
└──────────────────────────────────────────────────────────────────┘
```

---

## 6. Clean Architecture Layers Diagram

**Описание:** Визуализация слоев Clean Architecture и их зависимостей.

```
┌─────────────────────────────────────────────────────────────────┐
│              CLEAN ARCHITECTURE LAYERS DIAGRAM                   │
└─────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────┐
│                    PRESENTATION LAYER                             │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │  • API Controllers                                         │  │
│  │  • Middleware (Auth, Validation, Error Handling)          │  │
│  │  • DTOs (Request/Response)                                 │  │
│  └────────────────────────────────────────────────────────────┘  │
│                            │                                      │
│                            │ Depends on                           │
│                            ▼                                      │
┌──────────────────────────────────────────────────────────────────┐
│                    APPLICATION LAYER                             │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │  • Use Cases (Commands/Queries)                            │  │
│  │  • CQRS Pattern                                            │  │
│  │  • Pipeline Behaviors                                      │  │
│  │  • Application Services                                    │  │
│  └────────────────────────────────────────────────────────────┘  │
│                            │                                      │
│                            │ Depends on                           │
│                            ▼                                      │
┌──────────────────────────────────────────────────────────────────┐
│                      DOMAIN LAYER                                │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │  • Entities                                                │  │
│  │  • Value Objects                                           │  │
│  │  • Domain Events                                           │  │
│  │  • Domain Services                                         │  │
│  │  • Repository Interfaces                                  │  │
│  │  • Service Interfaces                                      │  │
│  └────────────────────────────────────────────────────────────┘  │
│                            ▲                                      │
│                            │ Implements                           │
│                            │                                      │
┌──────────────────────────────────────────────────────────────────┐
│                  INFRASTRUCTURE LAYER                             │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │  • Repository Implementations (PostgreSQL)                  │  │
│  │  • External Services (MinIO, FileSystem)                    │  │
│  │  • Database Connection                                      │  │
│  │  • S3 Client                                                │  │
│  │  • Mock Data Reader                                         │  │
│  └────────────────────────────────────────────────────────────┘  │
└──────────────────────────────────────────────────────────────────┘

Dependency Rule: Dependencies point INWARD
- Presentation → Application → Domain
- Infrastructure → Application → Domain
- Domain has NO dependencies
```

---

## 7. Legend

**Условные обозначения:**

- **→** — Зависимость (depends on)
- **─** — Взаимодействие (interaction)
- **┌─┐** — Контейнер/Компонент
- **│** — Поток данных
- **▼** — Направление зависимости

**Уровни C4 Model:**
1. **System Context** — Система и внешние пользователи
2. **Container** — Контейнеры/приложения
3. **Component** — Компоненты внутри контейнера
4. **Code** — Код (не показан в архитектуре)


