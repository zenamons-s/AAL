# Нефункциональные требования (NFR)

## 1. Производительность

### 1.1 Время отклика API

**Требования:**
- **Поиск маршрутов:** ≤ 500ms (p95)
- **Получение деталей маршрута:** ≤ 200ms (p95)
- **Создание заказа:** ≤ 1s (p95)
- **Авторизация:** ≤ 300ms (p95)
- **Получение списка заказов:** ≤ 500ms (p95)

**Метрики:**
- p50 (медиана): в 2 раза быстрее p95
- p99: не более 2x от p95

---

### 1.2 Пропускная способность

**Требования:**
- **API запросы:** ≥ 1000 req/s на один инстанс Backend
- **Одновременные пользователи:** ≥ 500 на один инстанс Frontend
- **Запросы к БД:** ≤ 100ms (p95)

---

### 1.3 Оптимизация

**Стратегии:**
- Кэширование mock-данных в памяти Backend
- Кэширование API ответов на Frontend (React Query)
- Индексы в PostgreSQL для быстрых запросов
- Ленивая загрузка данных карты
- Пагинация для списков

---

## 2. Надежность

### 2.1 Доступность (Availability)

**Требования:**
- **SLA:** 99.5% uptime (≈ 3.6 часа простоя в месяц)
- **Плановое обслуживание:** не более 2 часов в месяц
- **Время восстановления (MTTR):** ≤ 30 минут

---

### 2.2 Отказоустойчивость

**Требования:**
- **Graceful degradation:** При недоступности MinIO показывать placeholder изображения
- **Retry logic:** Автоматические повторы при временных сбоях
- **Circuit breaker:** Защита от каскадных отказов

---

### 2.3 Резервное копирование

**Требования:**
- **PostgreSQL:** Ежедневное резервное копирование
- **MinIO:** Еженедельное резервное копирование
- **Хранение резервных копий:** 30 дней
- **Время восстановления из резервной копии:** ≤ 1 час

---

## 3. Безопасность

### 3.1 Аутентификация и авторизация

**Требования:**
- **JWT токены:** Срок действия 24 часа
- **Пароли:** Минимум 8 символов, буквы и цифры
- **Хеширование паролей:** bcrypt с salt rounds = 10
- **HTTPS:** Обязательно для всех запросов

---

### 3.2 Защита данных

**Требования:**
- **Валидация входных данных:** На всех endpoints
- **SQL injection:** Защита через параметризованные запросы
- **XSS:** Санитизация пользовательского ввода
- **CORS:** Настройка разрешенных доменов
- **Rate limiting:** Ограничение запросов на пользователя

---

### 3.3 Конфиденциальность

**Требования:**
- **Персональные данные:** Изоляция по user_id
- **Логирование:** Без паролей и токенов
- **Secrets:** Хранение в переменных окружения
- **Минимизация данных:** Хранение только необходимых данных

---

## 4. Масштабируемость

### 4.1 Горизонтальное масштабирование

**Требования:**
- **Frontend:** Stateless, готов к масштабированию
- **Backend:** Stateless API, готов к масштабированию
- **PostgreSQL:** Репликация (master-slave) для чтения
- **MinIO:** Распределенное хранилище

---

### 4.2 Вертикальное масштабирование

**Требования:**
- **Минимальные ресурсы:**
  - Frontend: 512MB RAM, 0.5 CPU
  - Backend: 1GB RAM, 1 CPU
  - PostgreSQL: 2GB RAM, 1 CPU
  - MinIO: 1GB RAM, 0.5 CPU

---

## 5. Удобство использования

### 5.1 Пользовательский интерфейс

**Требования:**
- **Время загрузки страницы:** ≤ 2s (первая загрузка)
- **Интерактивность:** ≤ 100ms (клик → реакция)
- **Адаптивность:** Поддержка мобильных устройств
- **Доступность:** Соответствие WCAG 2.1 Level AA

---

### 5.2 Обработка ошибок

**Требования:**
- **Понятные сообщения об ошибках:** На русском языке
- **Валидация форм:** В реальном времени
- **Индикаторы загрузки:** Для всех асинхронных операций
- **Обработка сетевых ошибок:** Автоматические повторы

---

## 6. Поддерживаемость

### 6.1 Код

**Требования:**
- **Читаемость:** Следование стандартам кодирования
- **Документация:** Комментарии для сложной логики
- **Тестируемость:** Unit тесты для бизнес-логики
- **Рефакторинг:** Регулярный рефакторинг для улучшения качества

---

### 6.2 Мониторинг

**Требования:**
- **Логирование:** Все важные события
- **Метрики:** Производительность, ошибки, использование ресурсов
- **Алерты:** Уведомления при критических ошибках
- **Дашборды:** Визуализация метрик

---

## 7. Ограничения

### 7.1 Ограничения загрузки файлов

**Требования:**
- **Максимальный размер файла:** 10 MB (изображения), 1 MB (иконки)
- **Форматы:** JPEG, PNG, WebP для изображений; PNG, SVG для иконок
- **Rate limiting:** Максимум 10 загрузок в минуту на пользователя

---

### 7.2 Ограничения MinIO

**Требования:**
- **Максимальный размер bucket:** 10 GB (для MVP)
- **Количество файлов:** До 10,000 файлов
- **Мониторинг использования:** Предупреждение при 80% заполнения

---

### 7.3 Ограничения PostgreSQL

**Требования:**
- **Максимальный размер БД:** 5 GB (для MVP)
- **Количество записей:** До 100,000 записей в таблице orders
- **Мониторинг размера:** Предупреждение при 80% заполнения

---

## 8. Совместимость

### 8.1 Браузеры

**Требования:**
- **Chrome:** Последние 2 версии
- **Firefox:** Последние 2 версии
- **Safari:** Последние 2 версии
- **Edge:** Последние 2 версии

---

### 8.2 Устройства

**Требования:**
- **Десктоп:** Минимальное разрешение 1280x720
- **Планшет:** Минимальное разрешение 768x1024
- **Мобильный:** Минимальное разрешение 375x667

---

## 9. Локализация

### 9.1 Языки

**Требования:**
- **Основной язык:** Русский
- **Будущее:** Английский язык

---

### 9.2 Форматы

**Требования:**
- **Даты:** DD.MM.YYYY
- **Время:** HH:MM (24-часовой формат)
- **Валюта:** RUB (₽)
- **Числа:** Пробелы для тысяч (1 000)

---

## 10. Тестирование

### 10.1 Покрытие тестами

**Требования:**
- **Unit тесты:** ≥ 70% покрытие бизнес-логики
- **Integration тесты:** Критические пути
- **E2E тесты:** Основные сценарии пользователя

---

### 10.2 Типы тестов

**Требования:**
- **Unit:** Изолированные тесты компонентов
- **Integration:** Тесты взаимодействия компонентов
- **E2E:** Полные сценарии пользователя
- **Performance:** Нагрузочное тестирование

---

## 11. Документация

### 11.1 Техническая документация

**Требования:**
- **Архитектура:** Полное описание системы
- **API:** OpenAPI спецификация
- **База данных:** ERD диаграммы
- **Развертывание:** Инструкции по деплою

---

### 11.2 Пользовательская документация

**Требования:**
- **Руководство пользователя:** Основные функции
- **FAQ:** Часто задаваемые вопросы
- **Поддержка:** Контакты поддержки

---

## 12. Метрики успеха

### 12.1 Производительность

**KPI:**
- Среднее время отклика API: ≤ 300ms
- p95 время отклика: ≤ 500ms
- Доступность: ≥ 99.5%

---

### 12.2 Пользовательский опыт

**KPI:**
- Время загрузки страницы: ≤ 2s
- Успешность создания заказа: ≥ 95%
- Ошибки пользователя: ≤ 2%

---

### 12.3 Технические метрики

**KPI:**
- Покрытие тестами: ≥ 70%
- Время восстановления: ≤ 30 минут
- Использование ресурсов: ≤ 80%

---

## 13. Будущие улучшения

### 13.1 Производительность
- CDN для статических файлов
- Оптимизация изображений
- Кэширование на уровне CDN

### 13.2 Масштабируемость
- Kubernetes для оркестрации
- Автомасштабирование
- Распределенное кэширование (Redis)

### 13.3 Безопасность
- Двухфакторная аутентификация
- OAuth интеграция
- Расширенный мониторинг безопасности

