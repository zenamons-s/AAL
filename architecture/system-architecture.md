# Системная архитектура Travel App SaaS (MVP)

## 1. Общее описание системы

### 1.1 Концепция
Система представляет собой SaaS-платформу для планирования и покупки билетов на транспорт с интеллектуальным помощником-мамонтёнком. Архитектура построена на принципах разделения ответственности и изоляции компонентов.

### 1.2 Компоненты системы
Система состоит из трех основных частей:

1. **Frontend (UI-приложение)** — отдельный контейнер
   - Отвечает за пользовательский интерфейс
   - Отображает маршруты, карту, диалоги
   - Взаимодействует только с Backend API

2. **Backend API** — отдельный контейнер
   - Обрабатывает бизнес-логику
   - Управляет данными и маршрутами
   - Работает с mock-данными в MVP
   - Интегрируется с PostgreSQL и S3

3. **Инфраструктура** — отдельные контейнеры
   - PostgreSQL — база данных
   - MinIO (S3) — хранилище файлов
   - Docker Compose — оркестрация

## 2. Принципы архитектуры

### 2.1 Разделение ответственности
- Каждый компонент имеет четко определенную зону ответственности
- Frontend не содержит бизнес-логики
- Backend не содержит UI-логики
- Инфраструктура изолирована от прикладной логики

### 2.2 Изоляция компонентов
- Каждый компонент разворачивается в отдельном контейнере
- Компоненты взаимодействуют только через четко определенные интерфейсы
- Нет прямых зависимостей между компонентами

### 2.3 Масштабируемость
- Архитектура готова к горизонтальному масштабированию
- Возможность замены mock-данных на реальные API
- Возможность миграции на Kubernetes

## 3. Схема взаимодействия компонентов

```
┌─────────────────┐
│   Frontend      │
│   (React App)   │
└────────┬────────┘
         │ HTTP/REST
         │
┌────────▼────────┐
│  Backend API    │
│  (Node.js/      │
│   Express)      │
└────┬───────┬────┘
     │       │
     │       │
┌────▼───┐ ┌─▼──────┐
│PostgreSQL│ │ MinIO │
│          │ │ (S3)  │
└──────────┘ └───────┘
```

## 4. Потоки данных

### 4.1 Пользовательский запрос
1. Пользователь взаимодействует с Frontend
2. Frontend отправляет HTTP-запрос к Backend API
3. Backend обрабатывает запрос, обращается к БД/S3 при необходимости
4. Backend возвращает ответ Frontend
5. Frontend отображает результат пользователю

### 4.2 Работа с данными
- **Пользовательские данные** → PostgreSQL
- **Файлы и изображения** → MinIO (S3)
- **Mock-данные** → Backend (файлы/память)

## 5. Технологический стек

### 5.1 Frontend
- React (UI-фреймворк)
- TypeScript (типизация)
- Картографическая библиотека (Leaflet/Mapbox)
- HTTP-клиент (Axios/Fetch)

### 5.2 Backend
- Node.js (платформа)
- Express/Fastify (веб-фреймворк)
- TypeScript (типизация)
- PostgreSQL клиент (pg/Prisma)
- S3 клиент (AWS SDK/MinIO SDK)

### 5.3 Инфраструктура
- Docker (контейнеризация)
- Docker Compose (оркестрация)
- PostgreSQL (реляционная БД)
- MinIO (S3-совместимое хранилище)

## 6. Безопасность

### 6.1 Аутентификация и авторизация
- JWT токены для сессий
- Хранение токенов в PostgreSQL
- Защита API endpoints

### 6.2 Изоляция данных
- Каждый пользователь видит только свои данные
- Изоляция на уровне БД (WHERE user_id = ?)

## 7. Масштабирование (будущее)

### 7.1 Горизонтальное масштабирование
- Frontend: несколько инстансов за балансировщиком
- Backend: несколько инстансов за балансировщиком
- PostgreSQL: репликация (master-slave)
- MinIO: распределенное хранилище

### 7.2 Миграция на Kubernetes
- Замена Docker Compose на Kubernetes
- Использование Helm charts
- Автомасштабирование на основе нагрузки


