# Архитектура Travel App SaaS (MVP)

## Обзор

Данная папка содержит полную архитектурную документацию проекта Travel App SaaS. Архитектура построена на принципах Clean Architecture для Backend и React Best Practices для Frontend.

## Структура документации

### 1. [Системная архитектура](./system-architecture.md)
Общее описание системы, компонентов и их взаимодействия. Включает:
- Концепцию системы
- Принципы архитектуры
- Схему взаимодействия компонентов
- Технологический стек
- Безопасность и масштабирование

### 2. [Архитектура Backend API](./backend-architecture.md)
Детальное описание Backend на основе Clean Architecture:
- Принципы Clean Architecture (правило зависимостей, инверсия зависимостей)
- Структура слоев (Domain, Application, Infrastructure, Presentation)
- Domain Layer - чистота ядра (сущности, value objects, доменные события)
- Application Layer - use cases, CQRS, Pipeline Behaviors
- Работа с PostgreSQL и S3
- Mock-данные в MVP
- Валидация, аудит, безопасность
- Обработка ошибок и логирование
- SOLID принципы и тестируемость

### 3. [Архитектура Frontend](./frontend-architecture.md)
Архитектура Frontend на React с принципами:
- Feature-Based Architecture
- Компонентная структура (Compound Components)
- Управление состоянием (Context, React Query, UI Store)
- Организация Hooks и Utils
- TypeScript Best Practices
- Разделение логики компонентов
- Lifecycle Management
- Работа с API
- Стилизация (тема "Якутский север")
- Производительность и доступность

### 4. [Архитектура инфраструктуры](./infrastructure-architecture.md)
Инфраструктурные компоненты:
- Docker контейнеры
- Docker Compose конфигурация
- PostgreSQL, MinIO и Redis
- Переменные окружения
- Развертывание и масштабирование

### 4.1 [Архитектура кеширования (Redis)](./cache-architecture.md)
Архитектура кеширования с Redis:
- Структура модуля Redis
- Стратегия кеширования
- Места использования кеша
- Правила работы с кешем
- Конфигурация TTL
- Мониторинг и отладка

### 5. [Диаграммы взаимодействия](./component-diagrams.md)
Визуальные схемы и диаграммы:
- Общая архитектура системы
- Слои Backend (Clean Architecture)
- Потоки обработки запросов
- Схемы данных
- Сетевые схемы

### 6. [API Контракты](./api-contracts.md)
Полное описание API между Frontend и Backend:
- Версионирование API (v1)
- Все endpoints с запросами и ответами
- Структура ошибок
- Коды ошибок
- Пагинация
- Аутентификация (JWT)

### 7. [Архитектура данных](./data-architecture.md)
Структура данных в системе:
- Схемы PostgreSQL (users, orders, services)
- Структура Mock-данных (JSON)
- Связи между данными
- Валидация данных
- Индексация и поиск

### 8. [Потоки интеграции](./integration-flows.md)
Sequence Diagrams и потоки данных:
- Поиск маршрутов
- Создание заказа
- Отображение карты
- Взаимодействие с помощником
- Авторизация
- Загрузка файлов
- Обработка ошибок

### 9. [Бизнес-сценарии](./business-scenarios.md)
Сценарии использования MVP:
- Поиск маршрутов
- Просмотр деталей маршрута
- Выбор услуг
- Просмотр карты
- Взаимодействие с помощником
- Просмотр заказов
- Авторизация

### 10. [Архитектура авторизации](./auth-architecture.md)
Система авторизации и профиля:
- JWT токены
- Процесс регистрации/входа/выхода
- Хранение токенов на Frontend
- Middleware авторизации
- Профиль пользователя
- Защита endpoints
- Безопасность паролей

### 11. [Политика хранения MinIO](./storage-policy.md)
Структура и правила хранения файлов:
- Структура bucket
- Правила доступа (публичный/приватный)
- Загрузка файлов
- Валидация файлов
- Оптимизация изображений
- Кэширование
- Безопасность

### 12. [Архитектура карты](./map-architecture.md)
Архитектура отображения карты:
- Структура данных карты
- Слои карты (маршрут, достопримечательности, события)
- Получение данных карты
- Отображение на карте
- Подсчет расстояния
- Интерактивность
- Производительность

### 13. [High-Level Diagrams](./high-level-diagrams.md)
Визуальные диаграммы системы (C4 Model):
- System Context Diagram
- Container Diagram
- Component Diagram
- Data Flow Diagram
- Deployment Diagram
- Clean Architecture Layers Diagram

### 14. [Database ERD](./database-erd.md)
Полная схема базы данных:
- ERD диаграмма
- Детальное описание всех таблиц
- Связи между таблицами (1:N, 1:1)
- Индексы и ограничения
- Примеры запросов

### 15. [Спецификация Mock-данных](./mock-data-specification.md)
Полная структура всех mock-данных:
- cities.json — схема
- routes.json — схема
- attractions.json — схема
- events.json — схема
- weather.json — схема
- hotels.json — схема
- car-rentals.json — схема
- insurance.json — схема
- premium-support.json — схема

### 16. [Поведение ассистента](./assistant-behaviour.md)
Логика работы помощника (мамонтёнка):
- Правила генерации ответов
- Реакция на погодные риски
- Факты по городам
- Варианты поведения
- Расчет рисков 1-10
- Рекомендации по страховке
- Дерево диалогов

### 17. [Нефункциональные требования](./non-functional-requirements.md)
NFR для системы:
- Производительность (latency, throughput)
- Надежность (SLA, availability)
- Безопасность
- Масштабируемость
- Ограничения (файлы, MinIO, PostgreSQL)

### 18. [Обработка ошибок](./error-handling.md)
Полная система обработки ошибок:
- Формат ошибок
- Коды ошибок
- Обработка на Backend и Frontend
- Логирование ошибок
- Мониторинг

### 19. [Конфигурация и переменные окружения](./environment-configuration.md)
Управление конфигурацией:
- Глобальный реестр всех ENV переменных
- Различия между dev/staging/prod
- Правила хранения .env
- Структура secrets
- Валидация конфигурации

### 20. [Архитектура логирования](./logging-architecture.md)
Система логирования:
- Формат логов
- Уровни логирования
- Структура entry (timestamp, userId, traceId)
- Бизнес-логи vs системные логи
- Правила для ошибок
- Маскирование данных

### 21. [UX Flow](./ux-flow.md)
Дерево экранов и переходы:
- Полный список экранов
- Переходы между экранами
- Состояния (loading/empty/error)
- Компоненты (карта, панель услуг, карточка маршрута)
- Поведение UI

### 22. [Версионирование API](./api-versioning.md)
Правила версионирования API:
- Создание /api/v2/
- Политика изменений
- Backward compatibility
- Deprecation policy
- Миграция на новую версию

### 23. [DevOps Pipeline](./devops-pipeline.md)
CI/CD процесс (минимальный для MVP):
- Правила lint/test/build
- Ветвление Git
- Прод-процесс
- Примеры конфигурации

## Ключевые принципы

### Разделение ответственности
- **Frontend** — только UI, без бизнес-логики
- **Backend** — бизнес-логика и данные
- **Инфраструктура** — хранение и сервисы

### Изоляция компонентов
- Каждый компонент в отдельном контейнере
- Взаимодействие только через четко определенные интерфейсы
- Нет прямых зависимостей между компонентами

### Clean Architecture (Backend)
- Зависимости направлены внутрь (Dependency Rule)
- Domain Layer не зависит от внешних слоев
- Инверсия зависимостей (Dependency Inversion)
- CQRS паттерн (Commands/Queries)
- Pipeline Behaviors для cross-cutting concerns
- SOLID принципы
- Легкая замена инфраструктуры
- Высокая тестируемость

**Подробнее:** [Архитектура Backend API](./backend-architecture.md)

### React Best Practices (Frontend)
- Feature-Based Architecture
- Компонентный подход
- Compound Components
- Разделение на умные и глупые компоненты
- Управление состоянием (Context, React Query, UI Store)
- Организация Hooks и Utils
- TypeScript Best Practices
- Performance оптимизация

**Подробнее:** [Архитектура Frontend](./frontend-architecture.md)

## Компоненты системы

```
┌──────────────┐
│  Frontend    │  React приложение
│  (Container) │  Порт: 3000
└──────┬───────┘
       │ HTTP/REST
       │
┌──────▼───────┐
│  Backend API │  Node.js приложение
│  (Container) │  Порт: 5000
└──────┬───────┘
       │
   ┌───┴───┬───┐
   │       │   │
┌──▼───┐ ┌─▼────┐ ┌─▼────┐
│Postgr│ │MinIO │ │Redis │  Инфраструктура
│es    │ │(S3)  │ │Cache │  Порты: 5432, 9000, 6379
└──────┘ └──────┘ └──────┘
```

## Технологический стек

### Frontend
- React 18+
- TypeScript
- React Router
- React Query / SWR
- Leaflet / Mapbox (карта)
- Axios / Fetch

### Backend
- Node.js 18+
- Express / Fastify
- TypeScript
- PostgreSQL (pg / Prisma)
- MinIO SDK / AWS SDK

### Инфраструктура
- Docker
- Docker Compose
- PostgreSQL 15+
- MinIO (S3-совместимое)
- Redis 7+ (кеширование)

## Потоки данных

### Пользовательский запрос
1. User → Frontend
2. Frontend → Backend API (HTTP)
3. Backend → Redis (проверка кеша)
4. Backend → PostgreSQL / MinIO / Mock Data (если нет в кеше)
5. Backend → Redis (сохранение в кеш)
6. Backend → Frontend (JSON)
7. Frontend → User (UI)

### Типы данных
- **Пользовательские данные** → PostgreSQL
- **Кеш результатов** → Redis
- **Сессии пользователей** → Redis
- **Файлы и изображения** → MinIO (S3)
- **Mock-данные** → Backend (файлы/память)

## Безопасность

### Аутентификация
- JWT токены
- Хранение в PostgreSQL (sessions)
- Защита API endpoints

### Авторизация
- Проверка прав доступа
- Изоляция данных по user_id
- Роли пользователей (будущее)

### Защита данных
- Валидация входных данных
- Защита от SQL-инъекций (ORM)
- Защита от XSS
- CORS настройки

## Масштабирование

### Горизонтальное масштабирование
- Frontend: несколько инстансов за балансировщиком
- Backend: несколько инстансов за балансировщиком
- PostgreSQL: репликация (master-slave)
- MinIO: распределенное хранилище

### Вертикальное масштабирование
- Увеличение ресурсов контейнеров
- Оптимизация запросов к БД
- Кэширование через Redis
- Оптимизация TTL и стратегии кеширования

## Mock-данные в MVP

Backend работает с mock-файлами:
- `data/routes.json` — маршруты
- `data/cities.json` — города
- `data/weather.json` — погода
- `data/hotels.json` — гостиницы
- `data/car-rentals.json` — аренда авто
- `data/attractions.json` — достопримечательности
- `data/events.json` — события
- `data/facts.json` — факты для помощника

## Будущее развитие

### Замена mock-данных
- Интеграция с реальными API маршрутизации
- Интеграция с погодными сервисами
- Интеграция с сервисами гостиниц

### Миграция на Kubernetes
- Замена Docker Compose на Kubernetes
- Автомасштабирование
- Self-healing
- Rolling updates

### Дополнительные функции
- Платежная система
- Email-уведомления
- Мобильное приложение
- Офлайн-режим

## Цветовая тема "Якутский север"

- Ледяной голубой: `#E0F2F7`
- Северный синий: `#1E3A5F`
- Бирюза: `#4ECDC4`
- Снежный белый: `#FFFFFF`
- Фиолетовое сияние: `#9B59B6`

## Дополнительные ресурсы

- [Бизнес требования](../documentation/Бизнес%20требования.xlsx)
- [Диаграмма со связями](../documentation/Диаграмма%20со%20связями.png)
- [Краткие пояснения к диаграмме](../documentation/Краткие%20пояснения%20к%20диаграмме.docx)

## Контакты

Для вопросов по архитектуре обращайтесь к команде разработки.

