# Бизнес-сценарии MVP

## 1. Общие принципы

### 1.1 Цель MVP
- Демонстрация основных возможностей приложения
- Поиск и выбор маршрутов
- Создание заказов с услугами
- Взаимодействие с помощником
- Отображение карты с маршрутами и достопримечательностями

### 1.2 Пользовательские роли
- **Гость** — неавторизованный пользователь (может искать маршруты, просматривать карту)
- **Пользователь** — авторизованный пользователь (может создавать заказы, использовать ЛК)

## 2. Сценарии пользователя

### 2.1 Поиск маршрутов

**Сценарий:** Пользователь ищет маршрут из Якутска в Москву на 20 января 2024

**Шаги:**
1. Пользователь открывает главную страницу
2. Пользователь видит форму поиска маршрутов
3. Пользователь выбирает:
   - Город отправления: "Якутск"
   - Город назначения: "Москва"
   - Дата поездки: "20.01.2024"
   - Количество пассажиров: "2"
4. Пользователь нажимает "Найти маршруты"
5. Frontend отправляет запрос на `/api/v1/routes/search`
6. Backend возвращает список маршрутов
7. Пользователь видит список маршрутов с:
   - Типом транспорта (самолет, поезд, автобус, корабль)
   - Временем отправления и прибытия
   - Длительностью поездки
   - Ценой
   - Доступными местами
8. Пользователь может отсортировать маршруты по:
   - Цене (по возрастанию/убыванию)
   - Времени отправления
   - Длительности поездки

**Результат:** Пользователь видит список доступных маршрутов

---

### 2.2 Просмотр деталей маршрута

**Сценарий:** Пользователь открывает детали маршрута

**Шаги:**
1. Пользователь нажимает на маршрут из списка
2. Frontend отправляет запрос на `/api/v1/routes/:id`
3. Backend возвращает детали маршрута
4. Пользователь видит:
   - Полную информацию о маршруте
   - Информацию о перевозчике
   - Описание маршрута
   - Кнопку "Выбрать маршрут"
5. Пользователь может открыть карту маршрута

**Результат:** Пользователь видит детальную информацию о маршруте

---

### 2.3 Выбор услуг

**Сценарий:** Пользователь выбирает маршрут и добавляет услуги

**Шаги:**
1. Пользователь нажимает "Выбрать маршрут"
2. Если пользователь не авторизован, показывается форма входа/регистрации
3. После авторизации пользователь видит форму создания заказа
4. Пользователь вводит данные пассажиров:
   - Полное имя
   - Номер документа
5. Пользователь видит доступные услуги:
   - **Страховка:**
     - Базовая страховка (500 руб)
     - Расширенная страховка (1000 руб)
   - **Премиальная поддержка:**
     - Премиальная поддержка (1000 руб)
6. Пользователь выбирает услуги (опционально)
7. Пользователь видит итоговую стоимость:
   - Цена маршрута
   - Цена выбранных услуг
   - Общая стоимость
8. Пользователь нажимает "Создать заказ"
9. Frontend отправляет запрос на `/api/v1/orders`
10. Backend создает заказ в PostgreSQL
11. Пользователь видит подтверждение создания заказа

**Результат:** Заказ создан, пользователь видит подтверждение

---

### 2.4 Просмотр карты маршрута

**Сценарий:** Пользователь открывает карту маршрута

**Шаги:**
1. Пользователь нажимает "Открыть карту" на странице маршрута
2. Frontend отправляет запрос на `/api/v1/routes/:id/map`
3. Backend возвращает данные карты:
   - Polyline маршрута
   - Waypoints (точки маршрута)
   - Достопримечательности вдоль маршрута
   - События в городах маршрута
4. Frontend отображает карту с:
   - Линией маршрута (polyline)
   - Точками отправления и назначения
   - Иконками достопримечательностей
   - Иконками событий
5. Пользователь может:
   - Кликнуть на достопримечательность для просмотра информации
   - Кликнуть на событие для просмотра информации
   - Изменить масштаб карты
   - Перемещаться по карте

**Результат:** Пользователь видит карту с маршрутом, достопримечательностями и событиями

---

### 2.5 Взаимодействие с помощником (мамонтёнком)

**Сценарий:** Пользователь задает вопрос помощнику

**Шаги:**
1. Пользователь открывает чат с помощником
2. Пользователь видит приветственное сообщение от мамонтёнка
3. Пользователь задает вопрос: "Что ты знаешь о Якутске?"
4. Frontend отправляет запрос на `/api/v1/assistant/chat`
5. Backend обрабатывает вопрос:
   - Извлекает ключевые слова ("Якутск")
   - Читает данные о городе из `cities.json`
   - Читает погоду из `weather.json`
   - Читает достопримечательности из `attractions.json`
   - Генерирует ответ с фактами
6. Backend возвращает ответ с:
   - Текстовым ответом
   - Погодой в городе
   - Интересными фактами
   - Рекомендациями (если есть)
7. Пользователь видит ответ помощника
8. Пользователь может задать следующий вопрос

**Результат:** Пользователь получает ответ от помощника с полезной информацией

---

### 2.6 Просмотр списка заказов

**Сценарий:** Пользователь открывает список заказов в ЛК

**Шаги:**
1. Пользователь авторизован
2. Пользователь открывает "Личный кабинет" → "Мои заказы"
3. Frontend отправляет запрос на `/api/v1/orders`
4. Backend возвращает список заказов пользователя
5. Пользователь видит список заказов с:
   - Маршрутом (откуда → куда)
   - Датой поездки
   - Статусом заказа
   - Итоговой стоимостью
   - Выбранными услугами
6. Пользователь может:
   - Открыть детали заказа
   - Отменить заказ (если статус `pending`)
   - Открыть карту маршрута

**Результат:** Пользователь видит список своих заказов

---

### 2.7 Отмена заказа

**Сценарий:** Пользователь отменяет заказ

**Шаги:**
1. Пользователь открывает детали заказа
2. Пользователь видит кнопку "Отменить заказ" (если статус `pending`)
3. Пользователь нажимает "Отменить заказ"
4. Frontend показывает подтверждение
5. Пользователь подтверждает отмену
6. Frontend отправляет запрос на `DELETE /api/v1/orders/:id`
7. Backend обновляет статус заказа на `cancelled` в PostgreSQL
8. Пользователь видит подтверждение отмены
9. Заказ исчезает из списка активных заказов

**Результат:** Заказ отменен

---

## 3. Сценарии помощника (мамонтёнка)

### 3.1 Ответ на вопрос о городе

**Сценарий:** Пользователь спрашивает о городе

**Вопросы:**
- "Что ты знаешь о Якутске?"
- "Расскажи про Москву"
- "Какая погода в Якутске?"

**Ответ помощника включает:**
- Информацию о городе (из `cities.json`)
- Погоду (из `weather.json`)
- Интересные факты
- Рекомендации по достопримечательностям

---

### 3.2 Оценка рисков маршрута

**Сценарий:** Пользователь спрашивает о рисках маршрута

**Вопросы:**
- "Какие риски у этого маршрута?"
- "Стоит ли ехать в это время года?"

**Ответ помощника включает:**
- Уровень риска (low, medium, high)
- Факторы риска (погода, сезон, и т.д.)
- Рекомендации (страховка, раннее прибытие)
- Вероятность задержки

---

### 3.3 Рекомендации по услугам

**Сценарий:** Пользователь спрашивает о необходимости услуг

**Вопросы:**
- "Нужна ли страховка?"
- "Что дает премиальная поддержка?"

**Ответ помощника включает:**
- Описание услуги
- Преимущества
- Рекомендации по выбору

---

## 4. Сценарии отображения карты

### 4.1 Отображение маршрута

**Сценарий:** Карта показывает маршрут между городами

**Элементы карты:**
- **Линия маршрута** — polyline между точками отправления и назначения
- **Точка отправления** — иконка города отправления
- **Точка назначения** — иконка города назначения
- **Waypoints** — промежуточные точки маршрута (если есть)

**Тип транспорта:**
- **Самолет** — синяя линия
- **Поезд** — зеленая линия
- **Автобус** — оранжевая линия
- **Корабль** — голубая линия

---

### 4.2 Отображение достопримечательностей

**Сценарий:** Карта показывает достопримечательности вдоль маршрута

**Элементы:**
- **Иконки достопримечательностей** — на карте в координатах достопримечательностей
- **Категории:**
  - Памятник — иконка памятника
  - Музей — иконка музея
  - Парк — иконка парка
- **При клике на иконку:**
  - Показывается название
  - Показывается описание
  - Показывается изображение
  - Показывается рейтинг

---

### 4.3 Отображение событий

**Сценарий:** Карта показывает события в городах маршрута

**Элементы:**
- **Иконки событий** — на карте в координатах событий
- **Категории:**
  - Фестиваль — иконка фестиваля
  - Концерт — иконка концерта
  - Выставка — иконка выставки
- **При клике на иконку:**
  - Показывается название события
  - Показывается дата и время
  - Показывается описание
  - Показывается изображение

---

### 4.4 Подсчет расстояния

**Сценарий:** Карта показывает расстояние маршрута

**Расчет:**
- **Для самолета:** Прямое расстояние между городами (great circle distance)
- **Для поезда/автобуса:** Расстояние по дорогам (если доступно)
- **Для корабля:** Расстояние по воде (если доступно)

**Отображение:**
- Расстояние показывается в километрах
- Отображается рядом с информацией о маршруте

---

## 5. Сценарии работы с услугами

### 5.1 Выбор страховки

**Сценарий:** Пользователь выбирает страховку при создании заказа

**Шаги:**
1. Пользователь видит варианты страховки
2. Пользователь выбирает вариант:
   - Базовая страховка (500 руб)
   - Расширенная страховка (1000 руб)
3. Пользователь видит обновленную итоговую стоимость
4. При создании заказа страховка добавляется в заказ

---

### 5.2 Выбор премиальной поддержки

**Сценарий:** Пользователь выбирает премиальную поддержку

**Шаги:**
1. Пользователь видит вариант премиальной поддержки
2. Пользователь выбирает премиальную поддержку (1000 руб)
3. Пользователь видит обновленную итоговую стоимость
4. При создании заказа премиальная поддержка добавляется в заказ

---

## 6. Сценарии авторизации

### 6.1 Регистрация

**Сценарий:** Новый пользователь регистрируется

**Шаги:**
1. Пользователь нажимает "Регистрация"
2. Пользователь вводит:
   - Email
   - Пароль
   - Полное имя
3. Frontend валидирует данные
4. Frontend отправляет запрос на `/api/v1/auth/register`
5. Backend создает пользователя в PostgreSQL
6. Backend возвращает пользователя и JWT токен
7. Frontend сохраняет токен
8. Пользователь автоматически авторизован

---

### 6.2 Вход

**Сценарий:** Пользователь входит в систему

**Шаги:**
1. Пользователь нажимает "Вход"
2. Пользователь вводит:
   - Email
   - Пароль
3. Frontend отправляет запрос на `/api/v1/auth/login`
4. Backend проверяет учетные данные
5. Backend возвращает пользователя и JWT токен
6. Frontend сохраняет токен
7. Пользователь авторизован

---

### 6.3 Выход

**Сценарий:** Пользователь выходит из системы

**Шаги:**
1. Пользователь нажимает "Выход"
2. Frontend отправляет запрос на `/api/v1/auth/logout`
3. Frontend удаляет токен из localStorage
4. Пользователь перенаправляется на главную страницу

---

## 7. Обработка ошибок в сценариях

### 7.1 Ошибка поиска маршрутов

**Сценарий:** Маршруты не найдены

**Действия:**
- Показывается сообщение: "Маршруты не найдены"
- Предлагается изменить параметры поиска

---

### 7.2 Ошибка создания заказа

**Сценарий:** Заказ не может быть создан

**Причины:**
- Маршрут недоступен
- Недостаточно мест
- Ошибка валидации данных

**Действия:**
- Показывается сообщение об ошибке
- Предлагается исправить данные

---

### 7.3 Ошибка авторизации

**Сценарий:** Неверные учетные данные

**Действия:**
- Показывается сообщение: "Неверный email или пароль"
- Предлагается восстановить пароль (в будущем)

---

## 8. Успешные сценарии

### 8.1 Успешный поиск маршрутов
- Пользователь видит список маршрутов
- Пользователь может отсортировать и отфильтровать результаты

### 8.2 Успешное создание заказа
- Пользователь видит подтверждение создания заказа
- Заказ появляется в списке заказов

### 8.3 Успешное взаимодействие с помощником
- Пользователь получает полезный ответ
- Пользователь может задать следующий вопрос

### 8.4 Успешное отображение карты
- Карта показывает маршрут, достопримечательности и события
- Пользователь может взаимодействовать с элементами карты


