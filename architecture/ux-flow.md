# UX Flow (Дерево экранов)

## 1. Общие принципы

### 1.1 Навигация
- **Маршрутизация:** React Router
- **Состояния:** Loading, Empty, Error для каждого экрана
- **Переходы:** Плавные анимации между экранами
- **Обратная навигация:** Кнопка "Назад" и история браузера

### 1.2 Состояния экранов
- **Loading** — загрузка данных
- **Empty** — нет данных
- **Error** — ошибка загрузки
- **Success** — успешное отображение данных

---

## 2. Полный список экранов

### 2.1 Публичные экраны

| Экран | Путь | Описание |
|-------|------|----------|
| Главная | `/` | Поиск маршрутов |
| Детали маршрута | `/routes/:id` | Детали выбранного маршрута |
| Карта маршрута | `/routes/:id/map` | Карта с маршрутом |
| Вход | `/login` | Форма входа |
| Регистрация | `/register` | Форма регистрации |
| Достопримечательность | `/attractions/:id` | Детали достопримечательности |
| Событие | `/events/:id` | Детали события |

---

### 2.2 Защищенные экраны (требуют авторизации)

| Экран | Путь | Описание |
|-------|------|----------|
| Форма заказа | `/orders/new?routeId=:id` | Создание заказа |
| Список заказов | `/orders` | Список заказов пользователя |
| Детали заказа | `/orders/:id` | Детали заказа |
| Профиль | `/profile` | Профиль пользователя |
| Настройки | `/settings` | Настройки пользователя |

---

## 3. Дерево экранов

```
┌─────────────────────────────────────────────────────────┐
│                    Главная (/)                          │
│  - Поиск маршрутов                                      │
│  - Список результатов                                  │
└───────────────┬─────────────────────────────────────────┘
                │
    ┌───────────┼───────────┐
    │           │           │
┌───▼───┐  ┌───▼───┐  ┌───▼───┐
│Детали │  │ Карта │  │ Вход  │
│маршрута│  │маршрута│  │       │
└───┬───┘  └───────┘  └───┬───┘
    │                     │
    │                     │
┌───▼───┐            ┌───▼───┐
│Форма  │            │Регистр.│
│заказа │            │        │
└───┬───┘            └───────┘
    │
    │
┌───▼──────────┐
│Список заказов│
└───┬──────────┘
    │
┌───▼──────────┐
│Детали заказа │
└──────────────┘
```

---

## 4. Детальное описание экранов

### 4.1 Главная страница (`/`)

**Компоненты:**
- Форма поиска маршрутов
- Список результатов поиска
- Фильтры и сортировка
- Пагинация

**Состояния:**
- **Loading:** Индикатор загрузки
- **Empty:** "Маршруты не найдены"
- **Error:** Сообщение об ошибке + кнопка "Попробовать снова"
- **Success:** Список маршрутов

**Переходы:**
- Клик на маршрут → `/routes/:id`
- Клик на "Открыть карту" → `/routes/:id/map`
- Клик на "Выбрать маршрут" → `/orders/new?routeId=:id` (или `/login`)

---

### 4.2 Детали маршрута (`/routes/:id`)

**Компоненты:**
- Информация о маршруте
- Тип транспорта
- Время отправления/прибытия
- Цена и доступные места
- Кнопка "Выбрать маршрут"
- Кнопка "Открыть карту"
- Помощник (мамонтёнок)

**Состояния:**
- **Loading:** Скелетон загрузки
- **Error:** Сообщение об ошибке + кнопка "Назад"
- **Success:** Полная информация о маршруте

**Переходы:**
- "Выбрать маршрут" → `/orders/new?routeId=:id` (или `/login`)
- "Открыть карту" → `/routes/:id/map`
- "Назад" → `/`

---

### 4.3 Карта маршрута (`/routes/:id/map`)

**Компоненты:**
- Карта (Leaflet/Google Maps)
- Линия маршрута
- Точки отправления/назначения
- Достопримечательности (иконки)
- События (иконки)
- Легенда карты

**Состояния:**
- **Loading:** Индикатор загрузки карты
- **Error:** Сообщение об ошибке + кнопка "Назад"
- **Success:** Карта с данными

**Интерактивность:**
- Клик на достопримечательность → Popup с информацией
- Клик на событие → Popup с информацией
- Изменение масштаба
- Перемещение по карте

**Переходы:**
- "Назад" → `/routes/:id`
- Клик на достопримечательность → `/attractions/:id` (опционально)
- Клик на событие → `/events/:id` (опционально)

---

### 4.4 Форма заказа (`/orders/new?routeId=:id`)

**Компоненты:**
- Информация о маршруте (read-only)
- Форма данных пассажиров
- Выбор услуг (страховка, премиальная поддержка)
- Расчет итоговой стоимости
- Кнопка "Создать заказ"

**Состояния:**
- **Loading:** Загрузка вариантов услуг
- **Error:** Сообщение об ошибке
- **Success:** Форма готова к заполнению

**Валидация:**
- Обязательные поля: имя пассажира, номер документа
- Валидация в реальном времени
- Отображение ошибок валидации

**Переходы:**
- "Создать заказ" → `/orders/:id` (успех) или ошибка
- "Отмена" → `/routes/:id`
- "Назад" → `/routes/:id`

---

### 4.5 Список заказов (`/orders`)

**Компоненты:**
- Список заказов пользователя
- Фильтры (по статусу, дате)
- Сортировка
- Пагинация

**Состояния:**
- **Loading:** Индикатор загрузки
- **Empty:** "У вас пока нет заказов"
- **Error:** Сообщение об ошибке + кнопка "Попробовать снова"
- **Success:** Список заказов

**Переходы:**
- Клик на заказ → `/orders/:id`
- "Создать новый заказ" → `/`

---

### 4.6 Детали заказа (`/orders/:id`)

**Компоненты:**
- Информация о заказе
- Маршрут
- Пассажиры
- Услуги
- Статус заказа
- Кнопка "Отменить заказ" (если статус `pending`)
- Кнопка "Открыть карту" → `/routes/:id/map`

**Состояния:**
- **Loading:** Скелетон загрузки
- **Error:** Сообщение об ошибке + кнопка "Назад"
- **Success:** Полная информация о заказе

**Переходы:**
- "Отменить заказ" → Подтверждение → Обновление статуса
- "Открыть карту" → `/routes/:id/map`
- "Назад" → `/orders`

---

### 4.7 Профиль (`/profile`)

**Компоненты:**
- Информация о пользователе
- Аватар (с возможностью загрузки)
- Настройки
- История активности

**Состояния:**
- **Loading:** Индикатор загрузки
- **Error:** Сообщение об ошибке
- **Success:** Профиль пользователя

**Переходы:**
- "Редактировать" → Форма редактирования
- "Настройки" → `/settings`
- "Выход" → `/login`

---

### 4.8 Вход (`/login`)

**Компоненты:**
- Форма входа (email, пароль)
- Кнопка "Войти"
- Ссылка "Регистрация"
- Ссылка "Забыли пароль?" (будущее)

**Состояния:**
- **Loading:** Индикатор загрузки
- **Error:** Сообщение об ошибке
- **Success:** Перенаправление в ЛК

**Валидация:**
- Обязательные поля: email, пароль
- Валидация формата email
- Отображение ошибок валидации

**Переходы:**
- "Войти" → `/orders` (успех) или ошибка
- "Регистрация" → `/register`
- "Назад" → `/`

---

### 4.9 Регистрация (`/register`)

**Компоненты:**
- Форма регистрации (email, пароль, полное имя)
- Кнопка "Зарегистрироваться"
- Ссылка "Вход"

**Состояния:**
- **Loading:** Индикатор загрузки
- **Error:** Сообщение об ошибке
- **Success:** Перенаправление в ЛК

**Валидация:**
- Обязательные поля: email, пароль, полное имя
- Валидация формата email
- Валидация пароля (минимум 8 символов)
- Отображение ошибок валидации

**Переходы:**
- "Зарегистрироваться" → `/orders` (успех) или ошибка
- "Вход" → `/login`
- "Назад" → `/`

---

## 5. Компоненты

### 5.1 Карта маршрута

**Компонент:** `MapComponent`

**Пропсы:**
- `routeId` — ID маршрута
- `onAttractionClick` — обработчик клика на достопримечательность
- `onEventClick` — обработчик клика на событие

**Состояния:**
- Loading — загрузка данных карты
- Error — ошибка загрузки
- Success — карта с данными

---

### 5.2 Панель услуг

**Компонент:** `ServicesPanel`

**Пропсы:**
- `routeId` — ID маршрута (для расчета рисков)
- `selectedServices` — выбранные услуги
- `onServiceSelect` — обработчик выбора услуги

**Функциональность:**
- Отображение вариантов страховки
- Отображение вариантов премиальной поддержки
- Расчет итоговой стоимости
- Рекомендации от помощника

---

### 5.3 Карточка маршрута

**Компонент:** `RouteCard`

**Пропсы:**
- `route` — данные маршрута
- `onSelect` — обработчик выбора
- `onMapClick` — обработчик открытия карты

**Отображает:**
- Тип транспорта с иконкой
- Города отправления и назначения
- Время отправления/прибытия
- Длительность
- Цена
- Доступные места

---

### 5.4 Помощник (мамонтёнок)

**Компонент:** `AssistantChat`

**Пропсы:**
- `context` — контекст (routeId, currentPage)
- `onSuggestionClick` — обработчик клика на рекомендацию

**Функциональность:**
- Отправка сообщений
- Получение ответов от помощника
- Отображение погоды
- Отображение рисков
- Рекомендации

---

## 6. Поведение UI

### 6.1 Загрузка данных

**Индикаторы:**
- Skeleton screens для контента
- Spinner для кнопок
- Progress bar для загрузки файлов

**Правила:**
- Показывать индикатор сразу при загрузке
- Скрывать индикатор после загрузки
- Обрабатывать таймауты (30 секунд)

---

### 6.2 Обработка ошибок

**Отображение:**
- Toast уведомления для временных ошибок
- Модальные окна для критических ошибок
- Inline ошибки в формах

**Действия:**
- Кнопка "Попробовать снова" для сетевых ошибок
- Кнопка "Назад" для навигационных ошибок
- Автоматические повторы для временных ошибок

---

### 6.3 Валидация форм

**Правила:**
- Валидация в реальном времени
- Отображение ошибок под полями
- Блокировка кнопки отправки при ошибках
- Подсветка невалидных полей

---

### 6.4 Анимации

**Типы:**
- Плавные переходы между экранами
- Fade-in для контента
- Slide-in для модальных окон
- Loading animations

---

## 7. Адаптивность

### 7.1 Мобильные устройства

**Особенности:**
- Упрощенная навигация (hamburger menu)
- Увеличенные области клика
- Вертикальная компоновка
- Оптимизация для touch-жестов

---

### 7.2 Планшеты

**Особенности:**
- Горизонтальная компоновка
- Больше места для контента
- Поддержка жестов

---

### 7.3 Десктоп

**Особенности:**
- Полная навигация
- Боковая панель (опционально)
- Больше информации на экране

---

## 8. Будущие улучшения

### 8.1 Дополнительные экраны
- Страница достопримечательности
- Страница события
- История поисков
- Избранные маршруты

### 8.2 Улучшения UX
- Онбординг для новых пользователей
- Подсказки и туры
- Персонализация интерфейса
- Темная тема

