# –û—Ç—á—ë—Ç: –ü–æ–ª–Ω–∞—è –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—è—è —Å–µ—Ç–∫–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤ –º–µ–∂–¥—É –≤—Å–µ–º–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º–∏ –≥–æ—Ä–æ–¥–∞–º–∏

## –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –æ—Å—Ç–∞–Ω–æ–≤–æ–∫ –∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤ —á–µ—Ä–µ–∑ —Ö–∞–± (–Ø–∫—É—Ç—Å–∫) –≥—Ä–∞—Ñ –∏–º–µ–ª —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É:

- **–í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏**: —Å–æ–∑–¥–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å —Å—Ç–∞–±–∏–ª—å–Ω—ã–º–∏ ID (`virtual-stop-<–≥–æ—Ä–æ–¥>`)
- **–ú–∞—Ä—à—Ä—É—Ç—ã —á–µ—Ä–µ–∑ —Ö–∞–±**: —Å–æ–∑–¥–∞–Ω—ã –≤ –æ–±–µ —Å—Ç–æ—Ä–æ–Ω—ã (–≥–æ—Ä–æ–¥ ‚Üî –Ø–∫—É—Ç—Å–∫)
- **–ü—Ä–æ–±–ª–µ–º–∞**: –º–µ–∂–¥—É –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º–∏ –≥–æ—Ä–æ–¥–∞–º–∏ –ù–ï–¢ –ø—Ä—è–º—ã—Ö —Ä—ë–±–µ—Ä, —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Å–æ—Å–µ–¥ (–Ø–∫—É—Ç—Å–∫)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- PathFinder –¥–ª—è –ø–∞—Ä—ã –≥–æ—Ä–æ–¥–æ–≤ A ‚Üí B –≤–∏–¥–µ–ª:
  - A –∏–º–µ–µ—Ç 1 –∏—Å—Ö–æ–¥—è—â–µ–µ —Ä–µ–±—Ä–æ: A ‚Üí –Ø–∫—É—Ç—Å–∫
  - B –∏–º–µ–µ—Ç 1 –≤—Ö–æ–¥—è—â–µ–µ —Ä–µ–±—Ä–æ: –Ø–∫—É—Ç—Å–∫ ‚Üí B
  - –ù–æ —Ä—ë–±–µ—Ä –º–µ–∂–¥—É A ‚Üî B –Ω–µ –±—ã–ª–æ
- PathFinder –∑–∞—Å—Ç—Ä–µ–≤–∞–ª —Å:
  - —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ = Infinity
  - –æ—Å—Ç–∞–ª–æ—Å—å –Ω–µ–ø–æ—Å–µ—â—ë–Ω–Ω—ã—Ö: 36
  - –¥–æ—Å—Ç–∏–∂–∏–º—ã–µ —É–∑–ª—ã = —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ä—Ç–æ–≤—ã–π

## –†–µ—à–µ–Ω–∏–µ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ **–ø–æ–ª–Ω–∞—è –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—è—è —Å–µ—Ç–∫–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤** –º–µ–∂–¥—É –≤—Å–µ–º–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º–∏ –≥–æ—Ä–æ–¥–∞–º–∏. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –≥–æ—Ä–æ–¥–∞ A –∏ –∫–∞–∂–¥–æ–≥–æ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –≥–æ—Ä–æ–¥–∞ B (A ‚â† B) —Å–æ–∑–¥–∞—é—Ç—Å—è –¥–≤–∞ –º–∞—Ä—à—Ä—É—Ç–∞:

- **A ‚Üí B** (–ø—Ä—è–º–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)
- **B ‚Üí A** (–æ–±—Ä–∞—Ç–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)

–≠—Ç–æ –¥–µ–ª–∞–µ—Ç –≥—Ä–∞—Ñ –Ø–∫—É—Ç–∏–∏ **–ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–≤—è–∑–Ω—ã–º –Ω–∞ 100%** - –∫–∞–∂–¥—ã–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –≥–æ—Ä–æ–¥ —Å–≤—è–∑–∞–Ω —Å–æ –≤—Å–µ–º–∏ –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ –Ω–∞–ø—Ä—è–º—É—é.

## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –†–∞—Å—à–∏—Ä–µ–Ω –º–µ—Ç–æ–¥ `createDirectVirtualConnections`

**–§–∞–π–ª:** `backend/src/application/data-loading/DataRecoveryService.ts`

**–ú–µ—Ç–æ–¥:** `createDirectVirtualConnections()`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –ú–µ—Ç–æ–¥ —Ç–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞—ë—Ç –º–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è **–í–°–ï–•** –ø–∞—Ä –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ (A, B), –≥–¥–µ A ‚â† B
- –î–ª—è –∫–∞–∂–¥–æ–π –ø–∞—Ä—ã —Å–æ–∑–¥–∞—é—Ç—Å—è **–û–ë–ê** –º–∞—Ä—à—Ä—É—Ç–∞: A ‚Üí B –∏ B ‚Üí A
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤ –ø–æ —Å—Ç–∞–±–∏–ª—å–Ω—ã–º ID —á–µ—Ä–µ–∑ `generateVirtualRouteId`
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö —Ä–µ–π—Å–æ–≤ –Ω–∞ –≥–æ–¥ –≤–ø–µ—Ä—ë–¥ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–æ–∑–¥–∞–Ω–∏—è

**–ö–æ–¥:**
```typescript
// –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –î–ª—è –∫–∞–∂–¥–æ–π –ø–∞—Ä—ã –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ (A, B) —Å–æ–∑–¥–∞—ë–º –û–ë–ê –º–∞—Ä—à—Ä—É—Ç–∞
// –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø–æ–ª–Ω—É—é –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—é—é —Å–≤—è–∑–Ω–æ—Å—Ç—å –≥—Ä–∞—Ñ–∞
// –î–ª—è N –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ —Å–æ–∑–¥–∞—ë—Ç—Å—è N * (N - 1) –º–∞—Ä—à—Ä—É—Ç–æ–≤ (–∫–∞–∂–¥—ã–π –≥–æ—Ä–æ–¥ —Å–≤—è–∑–∞–Ω —Å–æ –≤—Å–µ–º–∏ –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ –≤ –æ–±–µ —Å—Ç–æ—Ä–æ–Ω—ã)
for (let i = 0; i < virtualStops.length; i++) {
  for (let j = 0; j < virtualStops.length; j++) {
    if (i === j) continue; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–∞–º –≥–æ—Ä–æ–¥
    
    // –°–æ–∑–¥–∞—ë–º –º–∞—Ä—à—Ä—É—Ç A ‚Üí B
    const routeIdAB = generateVirtualRouteId(cityA.id, cityB.id);
    if (!existingRouteIds.has(routeIdAB)) {
      const virtualRouteAB = this.createVirtualRoute(...);
      virtualRoutes.push(virtualRouteAB);
      const flightsAB = this.generateVirtualFlights(...);
      virtualFlights.push(...flightsAB);
    }
    
    // –°–æ–∑–¥–∞—ë–º –º–∞—Ä—à—Ä—É—Ç B ‚Üí A (–æ–±—Ä–∞—Ç–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)
    const routeIdBA = generateVirtualRouteId(cityB.id, cityA.id);
    if (!existingRouteIds.has(routeIdBA)) {
      const virtualRouteBA = this.createVirtualRoute(...);
      virtualRoutes.push(virtualRouteBA);
      const flightsBA = this.generateVirtualFlights(...);
      virtualFlights.push(...flightsBA);
    }
  }
}
```

**–ì–∞—Ä–∞–Ω—Ç–∏–∏:**
- ‚úÖ –î–ª—è N –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ —Å–æ–∑–¥–∞—ë—Ç—Å—è N * (N - 1) –º–∞—Ä—à—Ä—É—Ç–æ–≤
- ‚úÖ –ö–∞–∂–¥—ã–π –≥–æ—Ä–æ–¥ —Å–≤—è–∑–∞–Ω —Å–æ –≤—Å–µ–º–∏ –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ –≤ –æ–±–µ —Å—Ç–æ—Ä–æ–Ω—ã
- ‚úÖ –ú–∞—Ä—à—Ä—É—Ç—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç (–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ —Å—Ç–∞–±–∏–ª—å–Ω—ã–º ID)
- ‚úÖ –ì–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —Ä–µ–π—Å—ã –Ω–∞ –≥–æ–¥ –≤–ø–µ—Ä—ë–¥ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞

### 2. –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–æ–∑–¥–∞–Ω–∏—è

**–§–∞–π–ª:** `backend/src/application/data-loading/DataRecoveryService.ts`

**–ú–µ—Ç–æ–¥:** `createDirectVirtualConnections()`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω –ø—Ä–æ–≥—Ä–µ—Å—Å-–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä (–æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –ø–∞—Ä: X / Y)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Å–≤—è–∑–µ–π (–æ–∂–∏–¥–∞–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, –ø–æ–∫—Ä—ã—Ç–∏–µ)
- –ü—Ä–∏–º–µ—Ä—ã —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Å–≤—è–∑–µ–π (–ø–µ—Ä–≤—ã–µ 20)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–µ–π –¥–ª—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –≥–æ—Ä–æ–¥–æ–≤

**–ö–æ–¥:**
```typescript
// –õ–æ–≥–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤
const virtualCityNames = virtualStops.map(s => {
  const cityName = s.metadata?.cityName || s.name;
  return `${cityName} (${s.id})`;
});
console.log(`[DataRecoveryService.createDirectVirtualConnections] –°–ø–∏—Å–æ–∫ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤:`, virtualCityNames);

// –ü—Ä–æ–≥—Ä–µ—Å—Å-–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
let processedPairs = 0;
const totalPairs = virtualStops.length * (virtualStops.length - 1);
if (processedPairs % 50 === 0) {
  console.log(`[DataRecoveryService.createDirectVirtualConnections] –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –ø–∞—Ä: ${processedPairs} / ${totalPairs} (${Math.round(processedPairs / totalPairs * 100)}%)`);
}

// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
const expectedRoutes = virtualStops.length * (virtualStops.length - 1);
console.log(`[DataRecoveryService.createDirectVirtualConnections] üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª–Ω–æ–π —Å–µ—Ç–∫–∏:`);
console.log(`[DataRecoveryService.createDirectVirtualConnections]   - –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤: ${virtualStops.length}`);
console.log(`[DataRecoveryService.createDirectVirtualConnections]   - –°–æ–∑–¥–∞–Ω–æ –º–∞—Ä—à—Ä—É—Ç–æ–≤: ${routesCreated}`);
console.log(`[DataRecoveryService.createDirectVirtualConnections]   - –û–∂–∏–¥–∞–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∞—Ä—à—Ä—É—Ç–æ–≤: ${expectedRoutes}`);
console.log(`[DataRecoveryService.createDirectVirtualConnections]   - –ü–æ–∫—Ä—ã—Ç–∏–µ: ${routesCreated >= expectedRoutes ? '‚úÖ 100%' : `‚ö†Ô∏è ${Math.round(routesCreated / expectedRoutes * 100)}%`}`);

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –≥–æ—Ä–æ–¥–æ–≤
const testCities = ['–í–µ—Ä—Ö–æ—è–Ω—Å–∫', '–ñ–∏–≥–∞–Ω—Å–∫', '–ê–º–≥–∞', '–¢–∏–∫—Å–∏', '–í–∏–ª—é–π—Å–∫', '–û–ª—ë–∫–º–∏–Ω—Å–∫', '–°—Ä–µ–¥–Ω–µ–∫–æ–ª—ã–º—Å–∫', '–ú–∏—Ä–Ω—ã–π', '–ú–∞–π—è'];
for (const testCity of testCities) {
  const routesFromCity = createdConnections.filter(c => c.from === cityName).length;
  const routesToCity = createdConnections.filter(c => c.to === cityName).length;
  console.log(`[DataRecoveryService.createDirectVirtualConnections]   - ${cityName}: –∏—Å—Ö–æ–¥—è—â–∏—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤=${routesFromCity}, –≤—Ö–æ–¥—è—â–∏—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤=${routesToCity}`);
}
```

**–ì–∞—Ä–∞–Ω—Ç–∏–∏:**
- ‚úÖ –ü–æ–ª–Ω–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–æ–∑–¥–∞–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–µ–π –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Ç–æ–≥–æ–≤–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞

**–§–∞–π–ª:** `backend/src/application/data-loading/DataRecoveryService.ts`

**–ú–µ—Ç–æ–¥:** `createDirectVirtualConnections()`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏—Ç–æ–≥–æ–≤–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –∏ —Ä–µ–π—Å–æ–≤
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤ –∏ —Ä–µ–π—Å–æ–≤

**–ö–æ–¥:**
```typescript
// –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ –º–∞—Ä—à—Ä—É—Ç—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –¥–∞—Ç–∞—Å–µ—Ç
const finalDataset = {
  ...dataset,
  routes: [...dataset.routes, ...virtualRoutes],
  flights: [...dataset.flights, ...virtualFlights],
};

console.log(`[DataRecoveryService.createDirectVirtualConnections] ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–π –¥–∞—Ç–∞—Å–µ—Ç:`);
console.log(`[DataRecoveryService.createDirectVirtualConnections]   - –í—Å–µ–≥–æ –º–∞—Ä—à—Ä—É—Ç–æ–≤: ${finalDataset.routes.length} (–±—ã–ª–æ: ${dataset.routes.length}, –¥–æ–±–∞–≤–ª–µ–Ω–æ: ${virtualRoutes.length})`);
console.log(`[DataRecoveryService.createDirectVirtualConnections]   - –í—Å–µ–≥–æ —Ä–µ–π—Å–æ–≤: ${finalDataset.flights.length} (–±—ã–ª–æ: ${dataset.flights.length}, –¥–æ–±–∞–≤–ª–µ–Ω–æ: ${virtualFlights.length})`);
console.log(`[DataRecoveryService.createDirectVirtualConnections]   - –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤: ${finalDataset.routes.filter(r => r.metadata?._virtual === true).length}`);
console.log(`[DataRecoveryService.createDirectVirtualConnections]   - –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö —Ä–µ–π—Å–æ–≤: ${finalDataset.flights.filter(f => f.metadata?._virtual === true).length}`);
```

**–ì–∞—Ä–∞–Ω—Ç–∏–∏:**
- ‚úÖ –í—Å–µ –º–∞—Ä—à—Ä—É—Ç—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –¥–∞—Ç–∞—Å–µ—Ç
- ‚úÖ –í—Å–µ —Ä–µ–π—Å—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –¥–∞—Ç–∞—Å–µ—Ç
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

### 4. –£–ª—É—á—à–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–Ω–æ—Å—Ç–∏ –≤ RouteGraphManager

**–§–∞–π–ª:** `backend/src/application/route-builder/RouteGraphManager.ts`

**–ú–µ—Ç–æ–¥:** `doInitialize()`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–æ—Å–µ–¥–µ–π —É –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö —É–∑–ª–æ–≤ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª–Ω–æ–π —Å–µ—Ç–∫–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ (–í–µ—Ä—Ö–æ—è–Ω—Å–∫, –ñ–∏–≥–∞–Ω—Å–∫, –ê–º–≥–∞, –¢–∏–∫—Å–∏, –í–∏–ª—é–π—Å–∫, –û–ª—ë–∫–º–∏–Ω—Å–∫, –°—Ä–µ–¥–Ω–µ–∫–æ–ª—ã–º—Å–∫, –ú–∏—Ä–Ω—ã–π, –ú–∞–π—è)
- –ü–æ–∫–∞–∑ –ø—Ä–∏–º–µ—Ä–æ–≤ —É–∑–ª–æ–≤ —Å –Ω–∞–∏–±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Å–æ—Å–µ–¥–µ–π (—Ç–æ–ø-10)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö —Å–≤—è–∑–µ–π, –µ—Å–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã
- –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–æ—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏—è

**–ö–æ–¥:**
```typescript
// –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Å–µ–¥–µ–π —É –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö —É–∑–ª–æ–≤
// –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª–Ω–æ–π —Å–µ—Ç–∫–∏ –∫–∞–∂–¥—ã–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π —É–∑–µ–ª –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å ‚â•2 —Å–æ—Å–µ–¥–µ–π
const allNodesInitial = this.graph.getAllNodes();
const virtualNodes = allNodesInitial.filter(n => n.stopId.startsWith('virtual-stop-'));

const nodesWithFewNeighbors: Array<{ stopId: string; cityName: string; neighbors: number }> = [];
for (const virtualNode of virtualNodes) {
  const neighbors = this.graph.getNeighbors(virtualNode.stopId);
  if (neighbors.length < 2) {
    nodesWithFewNeighbors.push({ stopId: virtualNode.stopId, cityName, neighbors: neighbors.length });
  }
}

if (nodesWithFewNeighbors.length > 0) {
  console.log(`[RouteGraphManager] ‚ö†Ô∏è –ù–∞–π–¥–µ–Ω–æ ${nodesWithFewNeighbors.length} –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö —É–∑–ª–æ–≤ —Å ‚â§1 —Å–æ—Å–µ–¥–æ–º`);
  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ
  await this.ensureBidirectionalConnectivity();
} else {
  console.log(`[RouteGraphManager] ‚úÖ –í—Å–µ ${virtualNodes.length} –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö —É–∑–ª–æ–≤ –∏–º–µ—é—Ç ‚â•2 —Å–æ—Å–µ–¥–µ–π`);
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤—ã—Ö –≥–æ—Ä–æ–¥–æ–≤
const testCitiesForConnectivity = ['–í–µ—Ä—Ö–æ—è–Ω—Å–∫', '–ñ–∏–≥–∞–Ω—Å–∫', '–ê–º–≥–∞', '–¢–∏–∫—Å–∏', '–í–∏–ª—é–π—Å–∫', '–û–ª—ë–∫–º–∏–Ω—Å–∫', '–°—Ä–µ–¥–Ω–µ–∫–æ–ª—ã–º—Å–∫', '–ú–∏—Ä–Ω—ã–π', '–ú–∞–π—è'];
for (const testCity of testCitiesForConnectivity) {
  const testNodes = this.graph.findNodesByCity(testCity);
  if (testNodes.length > 0) {
    const testNode = testNodes[0];
    const neighbors = this.graph.getNeighbors(testNode.stopId);
    const edges = this.graph.getEdgesFrom(testNode.stopId);
    
    console.log(`[RouteGraphManager]   - ${cityName}: —Å–æ—Å–µ–¥–µ–π=${neighbors.length}, –∏—Å—Ö–æ–¥—è—â–∏—Ö —Ä—ë–±–µ—Ä=${edges.length}`);
    
    if (neighbors.length >= 2) {
      console.log(`[RouteGraphManager]     ‚úÖ –°–≤—è–∑–Ω–æ—Å—Ç—å —Ö–æ—Ä–æ—à–∞—è (‚â•2 —Å–æ—Å–µ–¥–µ–π)`);
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã—Ö 5 —Å–æ—Å–µ–¥–µ–π
    } else {
      console.log(`[RouteGraphManager]     ‚ö†Ô∏è –°–≤—è–∑–Ω–æ—Å—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è (<2 —Å–æ—Å–µ–¥–µ–π)`);
    }
  }
}
```

**–ì–∞—Ä–∞–Ω—Ç–∏–∏:**
- ‚úÖ –í—Å–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —É–∑–ª—ã –∏–º–µ—é—Ç ‚â•2 —Å–æ—Å–µ–¥–µ–π –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª–Ω–æ–π —Å–µ—Ç–∫–∏
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –≥–æ—Ä–æ–¥–æ–≤
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö —Å–≤—è–∑–µ–π

### 5. –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –º–µ—Ç–æ–¥–µ `recover`

**–§–∞–π–ª:** `backend/src/application/data-loading/DataRecoveryService.ts`

**–ú–µ—Ç–æ–¥:** `recover()`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º `createDirectVirtualConnections`
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª–Ω–æ–π —Å–µ—Ç–∫–∏

**–ö–æ–¥:**
```typescript
// 6. –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–π –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–µ–π —Å–µ—Ç–∫–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤ –º–µ–∂–¥—É –í–°–ï–ú–ò –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º–∏ –≥–æ—Ä–æ–¥–∞–º–∏
// –≠—Ç–æ —Å–æ–∑–¥–∞—ë—Ç –ø—Ä—è–º—ã–µ —Å–≤—è–∑–∏ A ‚Üî B –¥–ª—è –∫–∞–∂–¥–æ–π –ø–∞—Ä—ã –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ (A ‚â† B)
// –ì—Ä–∞—Ñ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–≤—è–∑–Ω—ã–º –Ω–∞ 100% - –∫–∞–∂–¥—ã–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –≥–æ—Ä–æ–¥ —Å–≤—è–∑–∞–Ω —Å–æ –≤—Å–µ–º–∏ –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏
console.log('[DataRecoveryService.recover] üîÑ –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–π –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–µ–π —Å–µ—Ç–∫–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤ –º–µ–∂–¥—É –≤—Å–µ–º–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º–∏ –≥–æ—Ä–æ–¥–∞–º–∏...');
const directVirtualResult = await this.createDirectVirtualConnections(recoveredDataset);
recoveredDataset = directVirtualResult.dataset;
if (directVirtualResult.virtualRoutesCount > 0) {
  console.log(`[DataRecoveryService.recover] ‚úÖ –°–æ–∑–¥–∞–Ω–æ ${directVirtualResult.virtualRoutesCount} –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤ –¥–ª—è –ø–æ–ª–Ω–æ–π —Å–µ—Ç–∫–∏`);
} else {
  console.log(`[DataRecoveryService.recover] ‚ö†Ô∏è –ù–µ —Å–æ–∑–¥–∞–Ω–æ –Ω–æ–≤—ã—Ö –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤ (–≤–æ–∑–º–æ–∂–Ω–æ, –≤—Å–µ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç)`);
}
```

**–ì–∞—Ä–∞–Ω—Ç–∏–∏:**
- ‚úÖ –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª–Ω–æ–π —Å–µ—Ç–∫–∏
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

## –ì–∞—Ä–∞–Ω—Ç–∏–∏ —Å–∏—Å—Ç–µ–º—ã

### ‚úÖ –ü–æ–ª–Ω–∞—è –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—è—è —Å–≤—è–∑–Ω–æ—Å—Ç—å

- –î–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –≥–æ—Ä–æ–¥–∞ A –∏ –∫–∞–∂–¥–æ–≥–æ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –≥–æ—Ä–æ–¥–∞ B (A ‚â† B) —Å–æ–∑–¥–∞—é—Ç—Å—è –¥–≤–∞ –º–∞—Ä—à—Ä—É—Ç–∞: A ‚Üí B –∏ B ‚Üí A
- –ì—Ä–∞—Ñ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–≤—è–∑–Ω—ã–º –Ω–∞ 100%
- –ö–∞–∂–¥—ã–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –≥–æ—Ä–æ–¥ —Å–≤—è–∑–∞–Ω —Å–æ –≤—Å–µ–º–∏ –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ –Ω–∞–ø—Ä—è–º—É—é

### ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω—ã–µ ID

- –í—Å–µ –º–∞—Ä—à—Ä—É—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ ID —á–µ—Ä–µ–∑ `generateVirtualRouteId`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤ –ø–æ —Å—Ç–∞–±–∏–ª—å–Ω—ã–º ID
- –û–¥–∏–Ω –º–∞—Ä—à—Ä—É—Ç = –æ–¥–∏–Ω —Å—Ç–∞–±–∏–ª—å–Ω—ã–π routeId

### ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–π—Å–æ–≤

- –î–ª—è –∫–∞–∂–¥–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —Ä–µ–π—Å—ã –Ω–∞ –≥–æ–¥ –≤–ø–µ—Ä—ë–¥
- –†–µ–π—Å—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –¥–ª—è –æ–±–æ–∏—Ö –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π (A ‚Üí B –∏ B ‚Üí A)
- –†–µ–π—Å—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –¥–∞—Ç–∞—Å–µ—Ç –≤–º–µ—Å—Ç–µ —Å –º–∞—Ä—à—Ä—É—Ç–∞–º–∏

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–Ω–æ—Å—Ç–∏

- –í—Å–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —É–∑–ª—ã –∏–º–µ—é—Ç ‚â•2 —Å–æ—Å–µ–¥–µ–π –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª–Ω–æ–π —Å–µ—Ç–∫–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö —Å–≤—è–∑–µ–π, –µ—Å–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã
- –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–æ—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏—è

### ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Å–≤—è–∑–µ–π (–æ–∂–∏–¥–∞–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, –ø–æ–∫—Ä—ã—Ç–∏–µ)
- –ü—Ä–∏–º–µ—Ä—ã —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Å–≤—è–∑–µ–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–µ–π –¥–ª—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –≥–æ—Ä–æ–¥–æ–≤

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ü—Ä–∏–º–µ—Ä—ã –ø–∞—Ä –≥–æ—Ä–æ–¥–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

1. **–í–µ—Ä—Ö–æ—è–Ω—Å–∫ ‚Üí –ñ–∏–≥–∞–Ω—Å–∫**
2. **–ê–º–≥–∞ ‚Üí –¢–∏–∫—Å–∏**
3. **–í–∏–ª—é–π—Å–∫ ‚Üí –û–ª—ë–∫–º–∏–Ω—Å–∫**
4. **–°—Ä–µ–¥–Ω–µ–∫–æ–ª—ã–º—Å–∫ ‚Üí –ú–∏—Ä–Ω—ã–π**
5. **–ú–∞–π—è ‚Üí –û–ª–µ–∫–º–∏–Ω—Å–∫**

### –û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:

```
[DataRecoveryService.recover] üîÑ –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–π –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–µ–π —Å–µ—Ç–∫–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤ –º–µ–∂–¥—É –≤—Å–µ–º–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º–∏ –≥–æ—Ä–æ–¥–∞–º–∏...
[DataRecoveryService.createDirectVirtualConnections] üîÑ –°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –¥–ª—è N –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤...
[DataRecoveryService.createDirectVirtualConnections] –û–∂–∏–¥–∞–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∞—Ä—à—Ä—É—Ç–æ–≤: N * (N - 1)
[DataRecoveryService.createDirectVirtualConnections] ‚úÖ –°–æ–∑–¥–∞–Ω –º–∞—Ä—à—Ä—É—Ç: –í–µ—Ä—Ö–æ—è–Ω—Å–∫ ‚Üí –ñ–∏–≥–∞–Ω—Å–∫, routeId="...", flights=365
[DataRecoveryService.createDirectVirtualConnections] ‚úÖ –°–æ–∑–¥–∞–Ω –º–∞—Ä—à—Ä—É—Ç: –ñ–∏–≥–∞–Ω—Å–∫ ‚Üí –í–µ—Ä—Ö–æ—è–Ω—Å–∫, routeId="...", flights=365
[DataRecoveryService.createDirectVirtualConnections] üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª–Ω–æ–π —Å–µ—Ç–∫–∏:
[DataRecoveryService.createDirectVirtualConnections]   - –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤: N
[DataRecoveryService.createDirectVirtualConnections]   - –°–æ–∑–¥–∞–Ω–æ –º–∞—Ä—à—Ä—É—Ç–æ–≤: N * (N - 1)
[DataRecoveryService.createDirectVirtualConnections]   - –ü–æ–∫—Ä—ã—Ç–∏–µ: ‚úÖ 100%
[RouteGraphManager] ‚úÖ –í—Å–µ N –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö —É–∑–ª–æ–≤ –∏–º–µ—é—Ç ‚â•2 —Å–æ—Å–µ–¥–µ–π –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª–Ω–æ–π —Å–µ—Ç–∫–∏
[RouteGraphManager]   - –í–µ—Ä—Ö–æ—è–Ω—Å–∫: —Å–æ—Å–µ–¥–µ–π=‚â•24, –∏—Å—Ö–æ–¥—è—â–∏—Ö —Ä—ë–±–µ—Ä=‚â•24, –≤—Ö–æ–¥—è—â–∏—Ö —Ä—ë–±–µ—Ä=‚â•24
[RouteGraphManager]     ‚úÖ –°–≤—è–∑–Ω–æ—Å—Ç—å —Ö–æ—Ä–æ—à–∞—è (‚â•2 —Å–æ—Å–µ–¥–µ–π)
[PathFinder] üîç –ü–æ–∏—Å–∫ –ø—É—Ç–∏: fromStopId="..." -> toStopId="..." (–¥–∞—Ç–∞: –Ω–µ —É–∫–∞–∑–∞–Ω–∞)
[PathFinder] ‚úÖ –£–∑–ª—ã –Ω–∞–π–¥–µ–Ω—ã: fromNode="–í–µ—Ä—Ö–æ—è–Ω—Å–∫" (...), toNode="–ñ–∏–≥–∞–Ω—Å–∫" (...)
[PathFinder] –†—ë–±–µ—Ä –∏–∑ fromStopId: ‚â•24, –∏–∑ toStopId: ‚â•24
[PathFinder] ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ "..." (...): Infinity -> X (—á–µ—Ä–µ–∑ "...")
[PathFinder] –¶–µ–ª–µ–≤–æ–π —É–∑–µ–ª –Ω–∞–π–¥–µ–Ω! –ò—Ç–µ—Ä–∞—Ü–∏–π: N, —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ: M
```

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:

- ‚úÖ `routesCreated >= N * (N - 1)` (–≥–¥–µ N = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤)
- ‚úÖ –í—Å–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —É–∑–ª—ã –∏–º–µ—é—Ç ‚â•2 —Å–æ—Å–µ–¥–µ–π
- ‚úÖ PathFinder –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "—Ä—ë–±–µ—Ä –∏–∑ fromStopId: ‚â•24"
- ‚úÖ "–æ—Å—Ç–∞–ª–æ—Å—å –Ω–µ–ø–æ—Å–µ—â—ë–Ω–Ω—ã—Ö" —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è
- ‚úÖ –î–æ—Å—Ç–∏–∂–∏–º—ã–µ —É–∑–ª—ã > 20
- ‚úÖ –î–∏—Å—Ç–∞–Ω—Ü–∏—è –¥–æ —Ü–µ–ª–µ–≤–æ–≥–æ ‚â† Infinity
- ‚úÖ –ü—É—Ç—å —Å—Ç—Ä–æ–∏—Ç—Å—è —á–µ—Ä–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —É–∑–ª—ã

## –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–∏—Å—Ç–µ–º–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç:

- ‚úÖ **–ü–æ–ª–Ω–∞—è –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—è—è —Å–≤—è–∑–Ω–æ—Å—Ç—å**: –ö–∞–∂–¥—ã–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –≥–æ—Ä–æ–¥ —Å–≤—è–∑–∞–Ω —Å–æ –≤—Å–µ–º–∏ –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ –Ω–∞–ø—Ä—è–º—É—é
- ‚úÖ **–°—Ç–∞–±–∏–ª—å–Ω—ã–µ ID**: –í—Å–µ –º–∞—Ä—à—Ä—É—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ ID
- ‚úÖ **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–π—Å–æ–≤**: –î–ª—è –∫–∞–∂–¥–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —Ä–µ–π—Å—ã –Ω–∞ –≥–æ–¥ –≤–ø–µ—Ä—ë–¥
- ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–Ω–æ—Å—Ç–∏**: –í—Å–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —É–∑–ª—ã –∏–º–µ—é—Ç ‚â•2 —Å–æ—Å–µ–¥–µ–π
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ**: –ù–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Å–≤—è–∑–∏ –¥–æ—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü–æ–ª–Ω–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–æ–∑–¥–∞–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

1. `backend/src/application/data-loading/DataRecoveryService.ts`:
   - –†–∞—Å—à–∏—Ä–µ–Ω –º–µ—Ç–æ–¥ `createDirectVirtualConnections()` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª–Ω–æ–π —Å–µ—Ç–∫–∏ –º–µ–∂–¥—É –≤—Å–µ–º–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º–∏ –≥–æ—Ä–æ–¥–∞–º–∏
   - –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–æ–∑–¥–∞–Ω–∏—è
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏—Ç–æ–≥–æ–≤–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞
   - –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –º–µ—Ç–æ–¥–µ `recover()`

2. `backend/src/application/route-builder/RouteGraphManager.ts`:
   - –£–ª—É—á—à–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–Ω–æ—Å—Ç–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö —É–∑–ª–æ–≤ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª–Ω–æ–π —Å–µ—Ç–∫–∏
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤—ã—Ö –≥–æ—Ä–æ–¥–æ–≤
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö —Å–≤—è–∑–µ–π
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–æ—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏—è

## –ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

‚úÖ **PathFinder –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å:**
- "—Ä—ë–±–µ—Ä –∏–∑ fromStopId: ‚â•24" (–¥–ª—è N –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤)
- "–æ—Å—Ç–∞–ª–æ—Å—å –Ω–µ–ø–æ—Å–µ—â—ë–Ω–Ω—ã—Ö" –¥–æ–ª–∂–Ω–æ —É–º–µ–Ω—å—à–∞—Ç—å—Å—è
- –î–æ—Å—Ç–∏–∂–∏–º—ã–µ —É–∑–ª—ã > 20
- –î–∏—Å—Ç–∞–Ω—Ü–∏—è –¥–æ —Ü–µ–ª–µ–≤–æ–≥–æ ‚â† Infinity
- –ü—É—Ç—å —Å—Ç—Ä–æ–∏—Ç—Å—è —á–µ—Ä–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —É–∑–ª—ã

‚úÖ **–í—Å–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —É–∑–ª—ã –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å ‚â•2 —Å–æ—Å–µ–¥–µ–π**

‚úÖ **–ü–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –¥–∞—Ç–æ–π –∏ –±–µ–∑ –¥–∞—Ç—ã –¥–ª—è –≤—Å–µ—Ö –ø–∞—Ä –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤**

‚úÖ **–ú–∞—Ä—à—Ä—É—Ç—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –æ–±–æ–∏—Ö –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö (A ‚Üí B –∏ B ‚Üí A)**


